<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" lang="en" xml:lang="en"><head>

<meta charset="utf-8">
<meta name="generator" content="quarto-1.1.189">

<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes">

<meta name="author" content="Eric Crandall 0000-0001-8580-3651">

<title>Metadata Wrangling Code for GEOME Metadatathon</title>
<style>
code{white-space: pre-wrap;}
span.smallcaps{font-variant: small-caps;}
div.columns{display: flex; gap: min(4vw, 1.5em);}
div.column{flex: auto; overflow-x: auto;}
div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
ul.task-list{list-style: none;}
ul.task-list li input[type="checkbox"] {
  width: 0.8em;
  margin: 0 0.8em 0.2em -1.6em;
  vertical-align: middle;
}
pre > code.sourceCode { white-space: pre; position: relative; }
pre > code.sourceCode > span { display: inline-block; line-height: 1.25; }
pre > code.sourceCode > span:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode > span { color: inherit; text-decoration: inherit; }
div.sourceCode { margin: 1em 0; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
pre > code.sourceCode { white-space: pre-wrap; }
pre > code.sourceCode > span { text-indent: -5em; padding-left: 5em; }
}
pre.numberSource code
  { counter-reset: source-line 0; }
pre.numberSource code > span
  { position: relative; left: -4em; counter-increment: source-line; }
pre.numberSource code > span > a:first-child::before
  { content: counter(source-line);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
    color: #aaaaaa;
  }
pre.numberSource { margin-left: 3em; border-left: 1px solid #aaaaaa;  padding-left: 4px; }
div.sourceCode
  {   }
@media screen {
pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
}
code span.al { color: #ff0000; font-weight: bold; } /* Alert */
code span.an { color: #60a0b0; font-weight: bold; font-style: italic; } /* Annotation */
code span.at { color: #7d9029; } /* Attribute */
code span.bn { color: #40a070; } /* BaseN */
code span.bu { color: #008000; } /* BuiltIn */
code span.cf { color: #007020; font-weight: bold; } /* ControlFlow */
code span.ch { color: #4070a0; } /* Char */
code span.cn { color: #880000; } /* Constant */
code span.co { color: #60a0b0; font-style: italic; } /* Comment */
code span.cv { color: #60a0b0; font-weight: bold; font-style: italic; } /* CommentVar */
code span.do { color: #ba2121; font-style: italic; } /* Documentation */
code span.dt { color: #902000; } /* DataType */
code span.dv { color: #40a070; } /* DecVal */
code span.er { color: #ff0000; font-weight: bold; } /* Error */
code span.ex { } /* Extension */
code span.fl { color: #40a070; } /* Float */
code span.fu { color: #06287e; } /* Function */
code span.im { color: #008000; font-weight: bold; } /* Import */
code span.in { color: #60a0b0; font-weight: bold; font-style: italic; } /* Information */
code span.kw { color: #007020; font-weight: bold; } /* Keyword */
code span.op { color: #666666; } /* Operator */
code span.ot { color: #007020; } /* Other */
code span.pp { color: #bc7a00; } /* Preprocessor */
code span.sc { color: #4070a0; } /* SpecialChar */
code span.ss { color: #bb6688; } /* SpecialString */
code span.st { color: #4070a0; } /* String */
code span.va { color: #19177c; } /* Variable */
code span.vs { color: #4070a0; } /* VerbatimString */
code span.wa { color: #60a0b0; font-weight: bold; font-style: italic; } /* Warning */
</style>


<script src="site_libs/quarto-nav/quarto-nav.js"></script>
<script src="site_libs/clipboard/clipboard.min.js"></script>
<script src="site_libs/quarto-search/autocomplete.umd.js"></script>
<script src="site_libs/quarto-search/fuse.min.js"></script>
<script src="site_libs/quarto-search/quarto-search.js"></script>
<meta name="quarto:offset" content="./">
<script src="site_libs/quarto-html/quarto.js"></script>
<script src="site_libs/quarto-html/popper.min.js"></script>
<script src="site_libs/quarto-html/tippy.umd.min.js"></script>
<script src="site_libs/quarto-html/anchor.min.js"></script>
<link href="site_libs/quarto-html/tippy.css" rel="stylesheet">
<link href="site_libs/quarto-html/quarto-syntax-highlighting.css" rel="stylesheet" id="quarto-text-highlighting-styles">
<script src="site_libs/bootstrap/bootstrap.min.js"></script>
<link href="site_libs/bootstrap/bootstrap-icons.css" rel="stylesheet">
<link href="site_libs/bootstrap/bootstrap.min.css" rel="stylesheet" id="quarto-bootstrap" data-mode="light">
<script id="quarto-search-options" type="application/json">{
  "location": "sidebar",
  "copy-button": false,
  "collapse-after": 3,
  "panel-placement": "start",
  "type": "textbox",
  "limit": 20,
  "language": {
    "search-no-results-text": "No results",
    "search-matching-documents-text": "matching documents",
    "search-copy-link-title": "Copy link to search",
    "search-hide-matches-text": "Hide additional matches",
    "search-more-match-text": "more match in this document",
    "search-more-matches-text": "more matches in this document",
    "search-clear-button-title": "Clear",
    "search-detached-cancel-button-title": "Cancel",
    "search-submit-button-title": "Submit"
  }
}</script>

<link href="site_libs/pagedtable-1.1/css/pagedtable.css" rel="stylesheet">
<script src="site_libs/pagedtable-1.1/js/pagedtable.js"></script>


</head>

<body>

<div id="quarto-search-results"></div>
<!-- content -->
<div id="quarto-content" class="quarto-container page-columns page-rows-contents page-layout-article">
<!-- sidebar -->
<!-- margin-sidebar -->
    <div id="quarto-margin-sidebar" class="sidebar margin-sidebar">
        <nav id="TOC" role="doc-toc" class="toc-active">
    <h2 id="toc-title">On this page</h2>
   
  <ul>
  <li><a href="#purpose" id="toc-purpose" class="nav-link active" data-scroll-target="#purpose">Purpose</a>
  <ul class="collapse">
  <li><a href="#from-rachels-email-of-june-24-2020" id="toc-from-rachels-email-of-june-24-2020" class="nav-link" data-scroll-target="#from-rachels-email-of-june-24-2020">From Rachel’s Email of June 24, 2020:</a></li>
  </ul></li>
  <li><a href="#read-in-the-lists" id="toc-read-in-the-lists" class="nav-link" data-scroll-target="#read-in-the-lists">Read In The Lists</a>
  <ul class="collapse">
  <li><a href="#pull-out-sra-metadata" id="toc-pull-out-sra-metadata" class="nav-link" data-scroll-target="#pull-out-sra-metadata">Pull Out SRA Metadata</a></li>
  <li><a href="#winnow-the-fields" id="toc-winnow-the-fields" class="nav-link" data-scroll-target="#winnow-the-fields">Winnow the Fields</a></li>
  </ul></li>
  <li><a href="#summarize-by-bioproject" id="toc-summarize-by-bioproject" class="nav-link" data-scroll-target="#summarize-by-bioproject">Summarize By BioProject</a></li>
  <li><a href="#write-to-google-sheets" id="toc-write-to-google-sheets" class="nav-link" data-scroll-target="#write-to-google-sheets">Write to Google Sheets</a>
  <ul class="collapse">
  <li><a href="#write-bioproject-summaries" id="toc-write-bioproject-summaries" class="nav-link" data-scroll-target="#write-bioproject-summaries">Write BioProject Summaries</a></li>
  <li><a href="#write-biosample-metadata" id="toc-write-biosample-metadata" class="nav-link" data-scroll-target="#write-biosample-metadata">Write BioSample metadata</a></li>
  <li><a href="#analyzing-failed-googlesheet-write-operations" id="toc-analyzing-failed-googlesheet-write-operations" class="nav-link" data-scroll-target="#analyzing-failed-googlesheet-write-operations">Analyzing Failed GoogleSheet Write Operations</a></li>
  <li><a href="#re-writing-difficult-bioprojects-as-excel-sheets" id="toc-re-writing-difficult-bioprojects-as-excel-sheets" class="nav-link" data-scroll-target="#re-writing-difficult-bioprojects-as-excel-sheets">Re-Writing Difficult BioProjects as Excel Sheets</a></li>
  </ul></li>
  <li><a href="#change-ownership-of-drive-files" id="toc-change-ownership-of-drive-files" class="nav-link" data-scroll-target="#change-ownership-of-drive-files">Change Ownership of Drive Files</a></li>
  <li><a href="#pull-out-author-lists-for-bioprojects-that-have-dois" id="toc-pull-out-author-lists-for-bioprojects-that-have-dois" class="nav-link" data-scroll-target="#pull-out-author-lists-for-bioprojects-that-have-dois">Pull out Author lists for BioProjects that have DOI’s</a></li>
  <li><a href="#create-mail-merge" id="toc-create-mail-merge" class="nav-link" data-scroll-target="#create-mail-merge">Create Mail Merge</a></li>
  <li><a href="#non-wild-species" id="toc-non-wild-species" class="nav-link" data-scroll-target="#non-wild-species">Non-Wild Species</a>
  <ul class="collapse">
  <li><a href="#species-identified-by-students" id="toc-species-identified-by-students" class="nav-link" data-scroll-target="#species-identified-by-students">Species identified by students</a></li>
  <li><a href="#human-pathogens" id="toc-human-pathogens" class="nav-link" data-scroll-target="#human-pathogens">Human Pathogens</a></li>
  <li><a href="#domesticated-species" id="toc-domesticated-species" class="nav-link" data-scroll-target="#domesticated-species">Domesticated Species</a>
  <ul class="collapse">
  <li><a href="#animals" id="toc-animals" class="nav-link" data-scroll-target="#animals">Animals</a></li>
  <li><a href="#plants" id="toc-plants" class="nav-link" data-scroll-target="#plants">Plants</a></li>
  </ul></li>
  <li><a href="#model-organisms" id="toc-model-organisms" class="nav-link" data-scroll-target="#model-organisms">Model Organisms</a></li>
  <li><a href="#combining-lists" id="toc-combining-lists" class="nav-link" data-scroll-target="#combining-lists">Combining Lists</a></li>
  <li><a href="#improving-sources" id="toc-improving-sources" class="nav-link" data-scroll-target="#improving-sources">Improving Sources</a></li>
  </ul></li>
  <li><a href="#discover-metadata-state-for-papers-that-didnt-need-author-contact" id="toc-discover-metadata-state-for-papers-that-didnt-need-author-contact" class="nav-link" data-scroll-target="#discover-metadata-state-for-papers-that-didnt-need-author-contact">Discover metadata state for papers that didn’t need author contact</a></li>
  <li><a href="#create-a-list-of-all-qcd-biosamples" id="toc-create-a-list-of-all-qcd-biosamples" class="nav-link" data-scroll-target="#create-a-list-of-all-qcd-biosamples">Create a list of all QCd biosamples</a>
  <ul class="collapse">
  <li><a href="#summarize" id="toc-summarize" class="nav-link" data-scroll-target="#summarize">Summarize</a></li>
  </ul></li>
  <li><a href="#interpreting-the-logistic-models" id="toc-interpreting-the-logistic-models" class="nav-link" data-scroll-target="#interpreting-the-logistic-models">Interpreting the logistic models</a>
  <ul class="collapse">
  <li><a href="#analysis-1" id="toc-analysis-1" class="nav-link" data-scroll-target="#analysis-1">Analysis 1</a></li>
  <li><a href="#analysis-2" id="toc-analysis-2" class="nav-link" data-scroll-target="#analysis-2">Analysis 2</a></li>
  <li><a href="#analysis-3" id="toc-analysis-3" class="nav-link" data-scroll-target="#analysis-3">Analysis 3</a></li>
  <li><a href="#analysis-4" id="toc-analysis-4" class="nav-link" data-scroll-target="#analysis-4">Analysis 4</a></li>
  </ul></li>
  <li><a href="#how-many-bioprojects-included-publication-information-and-for-how-many-could-we-find-papers" id="toc-how-many-bioprojects-included-publication-information-and-for-how-many-could-we-find-papers" class="nav-link" data-scroll-target="#how-many-bioprojects-included-publication-information-and-for-how-many-could-we-find-papers">How Many BioProjects included publication information, and for how many could we find papers?</a></li>
  <li><a href="#data-loading" id="toc-data-loading" class="nav-link" data-scroll-target="#data-loading">Data Loading</a></li>
  </ul>
</nav>
    </div>
<!-- main -->
<main class="content" id="quarto-document-content">

<header id="title-block-header" class="quarto-title-block default">
<div class="quarto-title">
<h1 class="title">Metadata Wrangling Code for GEOME Metadatathon</h1>
</div>



<div class="quarto-title-meta">

    <div>
    <div class="quarto-title-meta-heading">Author</div>
    <div class="quarto-title-meta-contents">
             <p>Eric Crandall 0000-0001-8580-3651 </p>
          </div>
  </div>
    
    
  </div>
  

</header>

<div class="cell">
<div class="sourceCode cell-code" id="cb1"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb1-1"><a href="#cb1-1" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(tidyverse)</span>
<span id="cb1-2"><a href="#cb1-2" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(googlesheets4)</span>
<span id="cb1-3"><a href="#cb1-3" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(googledrive)</span>
<span id="cb1-4"><a href="#cb1-4" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(taxize)</span>
<span id="cb1-5"><a href="#cb1-5" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(openxlsx)</span>
<span id="cb1-6"><a href="#cb1-6" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(readxl)</span>
<span id="cb1-7"><a href="#cb1-7" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(RefManageR)</span>
<span id="cb1-8"><a href="#cb1-8" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(rvest)</span>
<span id="cb1-9"><a href="#cb1-9" aria-hidden="true" tabindex="-1"></a><span class="fu">BibOptions</span>(<span class="at">max.names =</span> <span class="dv">100</span>, <span class="at">style =</span> <span class="st">"text"</span>)</span>
<span id="cb1-10"><a href="#cb1-10" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(ggalluvial)</span>
<span id="cb1-11"><a href="#cb1-11" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(lubridate)</span>
<span id="cb1-12"><a href="#cb1-12" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(clipr)</span>
<span id="cb1-13"><a href="#cb1-13" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(knitr)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<section id="purpose" class="level1">
<h1>Purpose</h1>
<p>This notebook documents the steps to go from raw csv’s pulled down from INSDC Sequence Read Archive by Rachel to the spreadsheets necessary for GEOME Datathon project management. I’m also going to try to learn to work better in the Tidyverse. The raw INSDC data and other datasets contain some sensitive information, and so are not available in this repository. The raw data that are available for reconstructing the Figure 4 results are in the <code>data</code> directory of this repository. Please contact me at eric.d.crandall ~A T~ gmail.com if you would like to examine other raw data files mentioned in this notebook.</p>
<p>Followed <a href="https://quarto.org/docs/publishing/github-pages.html">these instructions</a> for serving this Quarto notebook as a webpage.</p>
<section id="from-rachels-email-of-june-24-2020" class="level2">
<h2 class="anchored" data-anchor-id="from-rachels-email-of-june-24-2020">From Rachel’s Email of June 24, 2020:</h2>
<blockquote class="blockquote">
<p>I generated these four spreadsheets for now (note these are different than our previous list numbering):<br>
* list1 - divdiv datasets with lat/longs located outside of NCBI (n indivs per dataset &gt; 9)<br>
* list2 - divdiv datasets for which we haven’t yet searched for lat/long outside of NCBI (n indivs per dataset &gt; 9)<br>
* list3 - divdiv datasets where we looked for lat/long outside of NCBI and couldn’t find it (n indivs per dataset &gt; 9)<br>
(aka we know we need to contact author for if we want to try and get lat/long)<br>
* list4 - eukaryotes sans model organisms removed for which we haven’t yet &gt; assessed data relevance (n indivs per dataset &gt; 4)</p>
</blockquote>
<blockquote class="blockquote">
<p>The order of operations (I think also laid out in Cynthia’s flow chart in divdiv materials) as I see it is something like:<br>
1. Assess if dataset is relevant for popgen (natural populations, multiple populations, not hybrids?, etc.)<br>
2. For those passing #1, try to locate lat/long outside of NCBI and see if sample names can be matched to NCBI metadata we have<br>
3a. For those passing #2, gather the data from sources outside NCBI<br>
3b. For those not passing #2, contact authors.</p>
</blockquote>
<blockquote class="blockquote">
<p>list1 needs to enter the pipeline at step #3a.<br>
list2 needs to enter the pipeline at step #2.<br>
list3 needs to enter the pipeline at step #3b.<br>
list4 needs to enter the pipeline at step #1.</p>
</blockquote>
</section>
</section>
<section id="read-in-the-lists" class="level1">
<h1>Read In The Lists</h1>
<p>I first loaded all the lists with <code>read_csv()</code> in the readr package and then used <code>cols_condense(spec(list4))</code> to create a list of fields that depart from the default of <code>character</code> field type. Then wrote the following commands to read in the raw lists.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb2"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb2-1"><a href="#cb2-1" aria-hidden="true" tabindex="-1"></a>list1 <span class="ot">&lt;-</span> <span class="fu">read_csv</span>(<span class="st">"/Volumes/GoogleDrive/My Drive/GEOME_Datathon/SRA_Lists/list1-divdiv_with_latlong_located_outsideofNCBI-6-22-2020.csv"</span>, <span class="at">col_types =</span> <span class="fu">cols</span>(</span>
<span id="cb2-2"><a href="#cb2-2" aria-hidden="true" tabindex="-1"></a>  <span class="at">.default =</span> <span class="fu">col_character</span>(),</span>
<span id="cb2-3"><a href="#cb2-3" aria-hidden="true" tabindex="-1"></a>  <span class="at">X1 =</span> <span class="fu">col_double</span>(),</span>
<span id="cb2-4"><a href="#cb2-4" aria-hidden="true" tabindex="-1"></a>  <span class="at">taxid_sra =</span> <span class="fu">col_integer</span>(),</span>
<span id="cb2-5"><a href="#cb2-5" aria-hidden="true" tabindex="-1"></a>  <span class="at">uid_bioprj =</span> <span class="fu">col_integer</span>(),</span>
<span id="cb2-6"><a href="#cb2-6" aria-hidden="true" tabindex="-1"></a>  <span class="at">taxid_bioprj =</span> <span class="fu">col_integer</span>(),</span>
<span id="cb2-7"><a href="#cb2-7" aria-hidden="true" tabindex="-1"></a>  <span class="at">uid_sra =</span> <span class="fu">col_integer</span>(),</span>
<span id="cb2-8"><a href="#cb2-8" aria-hidden="true" tabindex="-1"></a>  <span class="at">total_number_reads_sra =</span> <span class="fu">col_number</span>(),</span>
<span id="cb2-9"><a href="#cb2-9" aria-hidden="true" tabindex="-1"></a>  <span class="at">total_number_base_pairs_sra =</span> <span class="fu">col_number</span>(),</span>
<span id="cb2-10"><a href="#cb2-10" aria-hidden="true" tabindex="-1"></a>  <span class="at">createdate_sra =</span> <span class="fu">col_date</span>(<span class="at">format =</span> <span class="st">""</span>),</span>
<span id="cb2-11"><a href="#cb2-11" aria-hidden="true" tabindex="-1"></a>  <span class="at">iteration_sra =</span> <span class="fu">col_integer</span>(),</span>
<span id="cb2-12"><a href="#cb2-12" aria-hidden="true" tabindex="-1"></a>  <span class="at">uid_biosamp =</span> <span class="fu">col_integer</span>(),</span>
<span id="cb2-13"><a href="#cb2-13" aria-hidden="true" tabindex="-1"></a>  <span class="at">date_biosamp =</span> <span class="fu">col_date</span>(<span class="at">format =</span> <span class="st">""</span>),</span>
<span id="cb2-14"><a href="#cb2-14" aria-hidden="true" tabindex="-1"></a>  <span class="at">publicationdate_biosamp =</span> <span class="fu">col_date</span>(<span class="at">format =</span> <span class="st">""</span>),</span>
<span id="cb2-15"><a href="#cb2-15" aria-hidden="true" tabindex="-1"></a>  <span class="at">modificationdate_biosamp =</span> <span class="fu">col_date</span>(<span class="at">format =</span> <span class="st">""</span>),</span>
<span id="cb2-16"><a href="#cb2-16" aria-hidden="true" tabindex="-1"></a>  <span class="at">taxonomy_biosamp =</span> <span class="fu">col_integer</span>(),</span>
<span id="cb2-17"><a href="#cb2-17" aria-hidden="true" tabindex="-1"></a>  <span class="at">taxid_taxonomy =</span> <span class="fu">col_integer</span>(),</span>
<span id="cb2-18"><a href="#cb2-18" aria-hidden="true" tabindex="-1"></a>  <span class="at">class_taxonomy =</span> <span class="fu">col_integer</span>(),</span>
<span id="cb2-19"><a href="#cb2-19" aria-hidden="true" tabindex="-1"></a>  <span class="at">family_taxonomy =</span> <span class="fu">col_integer</span>(),</span>
<span id="cb2-20"><a href="#cb2-20" aria-hidden="true" tabindex="-1"></a>  <span class="at">genus_taxonomy =</span> <span class="fu">col_integer</span>(),</span>
<span id="cb2-21"><a href="#cb2-21" aria-hidden="true" tabindex="-1"></a>  <span class="at">kingdom_taxonomy =</span> <span class="fu">col_integer</span>(),</span>
<span id="cb2-22"><a href="#cb2-22" aria-hidden="true" tabindex="-1"></a>  <span class="at">order_taxonomy =</span> <span class="fu">col_integer</span>(),</span>
<span id="cb2-23"><a href="#cb2-23" aria-hidden="true" tabindex="-1"></a>  <span class="at">phylum_taxonomy =</span> <span class="fu">col_double</span>(),</span>
<span id="cb2-24"><a href="#cb2-24" aria-hidden="true" tabindex="-1"></a>  <span class="at">class_taxid_taxonomy =</span> <span class="fu">col_integer</span>(),</span>
<span id="cb2-25"><a href="#cb2-25" aria-hidden="true" tabindex="-1"></a>  <span class="at">family_taxid_taxonomy =</span> <span class="fu">col_integer</span>(),</span>
<span id="cb2-26"><a href="#cb2-26" aria-hidden="true" tabindex="-1"></a>  <span class="at">genus_taxid_taxonomy =</span> <span class="fu">col_integer</span>(),</span>
<span id="cb2-27"><a href="#cb2-27" aria-hidden="true" tabindex="-1"></a>  <span class="at">kingdom_taxid_taxonomy =</span> <span class="fu">col_integer</span>(),</span>
<span id="cb2-28"><a href="#cb2-28" aria-hidden="true" tabindex="-1"></a>  <span class="at">order_taxid_taxonomy =</span> <span class="fu">col_integer</span>(),</span>
<span id="cb2-29"><a href="#cb2-29" aria-hidden="true" tabindex="-1"></a>  <span class="at">phylum_taxid_taxonomy =</span> <span class="fu">col_integer</span>(),</span>
<span id="cb2-30"><a href="#cb2-30" aria-hidden="true" tabindex="-1"></a>  <span class="at">publication_year_bioprj =</span> <span class="fu">col_integer</span>(),</span>
<span id="cb2-31"><a href="#cb2-31" aria-hidden="true" tabindex="-1"></a>  <span class="at">publication_volume_bioprj =</span> <span class="fu">col_integer</span>(),</span>
<span id="cb2-32"><a href="#cb2-32" aria-hidden="true" tabindex="-1"></a>  <span class="at">publication_issue_bioprj =</span> <span class="fu">col_integer</span>(),</span>
<span id="cb2-33"><a href="#cb2-33" aria-hidden="true" tabindex="-1"></a>  <span class="at">uid_pubmed =</span> <span class="fu">col_integer</span>(),</span>
<span id="cb2-34"><a href="#cb2-34" aria-hidden="true" tabindex="-1"></a>  <span class="at">volume_pubmed =</span> <span class="fu">col_integer</span>(),</span>
<span id="cb2-35"><a href="#cb2-35" aria-hidden="true" tabindex="-1"></a>  <span class="at">issue_pubmed =</span> <span class="fu">col_integer</span>(),</span>
<span id="cb2-36"><a href="#cb2-36" aria-hidden="true" tabindex="-1"></a>  <span class="at">nlmuniqueid_pubmed =</span> <span class="fu">col_integer</span>(),</span>
<span id="cb2-37"><a href="#cb2-37" aria-hidden="true" tabindex="-1"></a>  <span class="at">pmcrefcount_pubmed =</span> <span class="fu">col_integer</span>()</span>
<span id="cb2-38"><a href="#cb2-38" aria-hidden="true" tabindex="-1"></a>))</span>
<span id="cb2-39"><a href="#cb2-39" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb2-40"><a href="#cb2-40" aria-hidden="true" tabindex="-1"></a>list2 <span class="ot">&lt;-</span> <span class="fu">read_csv</span>(<span class="st">"/Volumes/GoogleDrive/My Drive/GEOME_Datathon/SRA_Lists/list2-divdiv_without_latlong_located_yet_outsideofNCBI-6-22-2020.csv"</span>, <span class="at">col_types =</span> <span class="fu">cols</span>(</span>
<span id="cb2-41"><a href="#cb2-41" aria-hidden="true" tabindex="-1"></a>  <span class="at">.default =</span> <span class="fu">col_character</span>(),</span>
<span id="cb2-42"><a href="#cb2-42" aria-hidden="true" tabindex="-1"></a>  <span class="at">X1 =</span> <span class="fu">col_double</span>(),</span>
<span id="cb2-43"><a href="#cb2-43" aria-hidden="true" tabindex="-1"></a>  <span class="at">taxid_sra =</span> <span class="fu">col_integer</span>(),</span>
<span id="cb2-44"><a href="#cb2-44" aria-hidden="true" tabindex="-1"></a>  <span class="at">uid_bioprj =</span> <span class="fu">col_integer</span>(),</span>
<span id="cb2-45"><a href="#cb2-45" aria-hidden="true" tabindex="-1"></a>  <span class="at">taxid_bioprj =</span> <span class="fu">col_integer</span>(),</span>
<span id="cb2-46"><a href="#cb2-46" aria-hidden="true" tabindex="-1"></a>  <span class="at">uid_sra =</span> <span class="fu">col_integer</span>(),</span>
<span id="cb2-47"><a href="#cb2-47" aria-hidden="true" tabindex="-1"></a>  <span class="at">total_number_reads_sra =</span> <span class="fu">col_number</span>(),</span>
<span id="cb2-48"><a href="#cb2-48" aria-hidden="true" tabindex="-1"></a>  <span class="at">total_number_base_pairs_sra =</span> <span class="fu">col_number</span>(),</span>
<span id="cb2-49"><a href="#cb2-49" aria-hidden="true" tabindex="-1"></a>  <span class="at">createdate_sra =</span> <span class="fu">col_date</span>(<span class="at">format =</span> <span class="st">""</span>),</span>
<span id="cb2-50"><a href="#cb2-50" aria-hidden="true" tabindex="-1"></a>  <span class="at">iteration_sra =</span> <span class="fu">col_integer</span>(),</span>
<span id="cb2-51"><a href="#cb2-51" aria-hidden="true" tabindex="-1"></a>  <span class="at">uid_biosamp =</span> <span class="fu">col_integer</span>(),</span>
<span id="cb2-52"><a href="#cb2-52" aria-hidden="true" tabindex="-1"></a>  <span class="at">date_biosamp =</span> <span class="fu">col_date</span>(<span class="at">format =</span> <span class="st">""</span>),</span>
<span id="cb2-53"><a href="#cb2-53" aria-hidden="true" tabindex="-1"></a>  <span class="at">publicationdate_biosamp =</span> <span class="fu">col_date</span>(<span class="at">format =</span> <span class="st">""</span>),</span>
<span id="cb2-54"><a href="#cb2-54" aria-hidden="true" tabindex="-1"></a>  <span class="at">modificationdate_biosamp =</span> <span class="fu">col_date</span>(<span class="at">format =</span> <span class="st">""</span>),</span>
<span id="cb2-55"><a href="#cb2-55" aria-hidden="true" tabindex="-1"></a>  <span class="at">taxonomy_biosamp =</span> <span class="fu">col_integer</span>(),</span>
<span id="cb2-56"><a href="#cb2-56" aria-hidden="true" tabindex="-1"></a>  <span class="at">taxid_taxonomy =</span> <span class="fu">col_integer</span>(),</span>
<span id="cb2-57"><a href="#cb2-57" aria-hidden="true" tabindex="-1"></a>  <span class="at">class_taxonomy =</span> <span class="fu">col_integer</span>(),</span>
<span id="cb2-58"><a href="#cb2-58" aria-hidden="true" tabindex="-1"></a>  <span class="at">family_taxonomy =</span> <span class="fu">col_integer</span>(),</span>
<span id="cb2-59"><a href="#cb2-59" aria-hidden="true" tabindex="-1"></a>  <span class="at">genus_taxonomy =</span> <span class="fu">col_integer</span>(),</span>
<span id="cb2-60"><a href="#cb2-60" aria-hidden="true" tabindex="-1"></a>  <span class="at">kingdom_taxonomy =</span> <span class="fu">col_integer</span>(),</span>
<span id="cb2-61"><a href="#cb2-61" aria-hidden="true" tabindex="-1"></a>  <span class="at">order_taxonomy =</span> <span class="fu">col_integer</span>(),</span>
<span id="cb2-62"><a href="#cb2-62" aria-hidden="true" tabindex="-1"></a>  <span class="at">phylum_taxonomy =</span> <span class="fu">col_double</span>(),</span>
<span id="cb2-63"><a href="#cb2-63" aria-hidden="true" tabindex="-1"></a>  <span class="at">class_taxid_taxonomy =</span> <span class="fu">col_integer</span>(),</span>
<span id="cb2-64"><a href="#cb2-64" aria-hidden="true" tabindex="-1"></a>  <span class="at">family_taxid_taxonomy =</span> <span class="fu">col_integer</span>(),</span>
<span id="cb2-65"><a href="#cb2-65" aria-hidden="true" tabindex="-1"></a>  <span class="at">genus_taxid_taxonomy =</span> <span class="fu">col_integer</span>(),</span>
<span id="cb2-66"><a href="#cb2-66" aria-hidden="true" tabindex="-1"></a>  <span class="at">kingdom_taxid_taxonomy =</span> <span class="fu">col_integer</span>(),</span>
<span id="cb2-67"><a href="#cb2-67" aria-hidden="true" tabindex="-1"></a>  <span class="at">order_taxid_taxonomy =</span> <span class="fu">col_integer</span>(),</span>
<span id="cb2-68"><a href="#cb2-68" aria-hidden="true" tabindex="-1"></a>  <span class="at">phylum_taxid_taxonomy =</span> <span class="fu">col_integer</span>(),</span>
<span id="cb2-69"><a href="#cb2-69" aria-hidden="true" tabindex="-1"></a>  <span class="at">publication_year_bioprj =</span> <span class="fu">col_integer</span>(),</span>
<span id="cb2-70"><a href="#cb2-70" aria-hidden="true" tabindex="-1"></a>  <span class="at">publication_volume_bioprj =</span> <span class="fu">col_integer</span>(),</span>
<span id="cb2-71"><a href="#cb2-71" aria-hidden="true" tabindex="-1"></a>  <span class="at">publication_issue_bioprj =</span> <span class="fu">col_integer</span>(),</span>
<span id="cb2-72"><a href="#cb2-72" aria-hidden="true" tabindex="-1"></a>  <span class="at">uid_pubmed =</span> <span class="fu">col_integer</span>(),</span>
<span id="cb2-73"><a href="#cb2-73" aria-hidden="true" tabindex="-1"></a>  <span class="at">volume_pubmed =</span> <span class="fu">col_integer</span>(),</span>
<span id="cb2-74"><a href="#cb2-74" aria-hidden="true" tabindex="-1"></a>  <span class="at">issue_pubmed =</span> <span class="fu">col_integer</span>(),</span>
<span id="cb2-75"><a href="#cb2-75" aria-hidden="true" tabindex="-1"></a>  <span class="at">nlmuniqueid_pubmed =</span> <span class="fu">col_integer</span>(),</span>
<span id="cb2-76"><a href="#cb2-76" aria-hidden="true" tabindex="-1"></a>  <span class="at">pmcrefcount_pubmed =</span> <span class="fu">col_integer</span>()</span>
<span id="cb2-77"><a href="#cb2-77" aria-hidden="true" tabindex="-1"></a>))</span>
<span id="cb2-78"><a href="#cb2-78" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb2-79"><a href="#cb2-79" aria-hidden="true" tabindex="-1"></a>list3 <span class="ot">&lt;-</span> <span class="fu">read_csv</span>(<span class="st">"/Volumes/GoogleDrive/My Drive/GEOME_Datathon/SRA_Lists/list3-divdiv_couldntfind_latlong_outsideofNCBI-6-22-2020.csv"</span>, <span class="at">col_types =</span> <span class="fu">cols</span>(</span>
<span id="cb2-80"><a href="#cb2-80" aria-hidden="true" tabindex="-1"></a>  <span class="at">.default =</span> <span class="fu">col_character</span>(),</span>
<span id="cb2-81"><a href="#cb2-81" aria-hidden="true" tabindex="-1"></a>  <span class="at">X1 =</span> <span class="fu">col_double</span>(),</span>
<span id="cb2-82"><a href="#cb2-82" aria-hidden="true" tabindex="-1"></a>  <span class="at">taxid_sra =</span> <span class="fu">col_integer</span>(),</span>
<span id="cb2-83"><a href="#cb2-83" aria-hidden="true" tabindex="-1"></a>  <span class="at">uid_bioprj =</span> <span class="fu">col_integer</span>(),</span>
<span id="cb2-84"><a href="#cb2-84" aria-hidden="true" tabindex="-1"></a>  <span class="at">taxid_bioprj =</span> <span class="fu">col_integer</span>(),</span>
<span id="cb2-85"><a href="#cb2-85" aria-hidden="true" tabindex="-1"></a>  <span class="at">uid_sra =</span> <span class="fu">col_integer</span>(),</span>
<span id="cb2-86"><a href="#cb2-86" aria-hidden="true" tabindex="-1"></a>  <span class="at">total_number_reads_sra =</span> <span class="fu">col_number</span>(),</span>
<span id="cb2-87"><a href="#cb2-87" aria-hidden="true" tabindex="-1"></a>  <span class="at">total_number_base_pairs_sra =</span> <span class="fu">col_number</span>(),</span>
<span id="cb2-88"><a href="#cb2-88" aria-hidden="true" tabindex="-1"></a>  <span class="at">createdate_sra =</span> <span class="fu">col_date</span>(<span class="at">format =</span> <span class="st">""</span>),</span>
<span id="cb2-89"><a href="#cb2-89" aria-hidden="true" tabindex="-1"></a>  <span class="at">iteration_sra =</span> <span class="fu">col_integer</span>(),</span>
<span id="cb2-90"><a href="#cb2-90" aria-hidden="true" tabindex="-1"></a>  <span class="at">uid_biosamp =</span> <span class="fu">col_integer</span>(),</span>
<span id="cb2-91"><a href="#cb2-91" aria-hidden="true" tabindex="-1"></a>  <span class="at">date_biosamp =</span> <span class="fu">col_date</span>(<span class="at">format =</span> <span class="st">""</span>),</span>
<span id="cb2-92"><a href="#cb2-92" aria-hidden="true" tabindex="-1"></a>  <span class="at">publicationdate_biosamp =</span> <span class="fu">col_date</span>(<span class="at">format =</span> <span class="st">""</span>),</span>
<span id="cb2-93"><a href="#cb2-93" aria-hidden="true" tabindex="-1"></a>  <span class="at">modificationdate_biosamp =</span> <span class="fu">col_date</span>(<span class="at">format =</span> <span class="st">""</span>),</span>
<span id="cb2-94"><a href="#cb2-94" aria-hidden="true" tabindex="-1"></a>  <span class="at">taxonomy_biosamp =</span> <span class="fu">col_integer</span>(),</span>
<span id="cb2-95"><a href="#cb2-95" aria-hidden="true" tabindex="-1"></a>  <span class="at">taxid_taxonomy =</span> <span class="fu">col_integer</span>(),</span>
<span id="cb2-96"><a href="#cb2-96" aria-hidden="true" tabindex="-1"></a>  <span class="at">class_taxonomy =</span> <span class="fu">col_integer</span>(),</span>
<span id="cb2-97"><a href="#cb2-97" aria-hidden="true" tabindex="-1"></a>  <span class="at">family_taxonomy =</span> <span class="fu">col_integer</span>(),</span>
<span id="cb2-98"><a href="#cb2-98" aria-hidden="true" tabindex="-1"></a>  <span class="at">genus_taxonomy =</span> <span class="fu">col_integer</span>(),</span>
<span id="cb2-99"><a href="#cb2-99" aria-hidden="true" tabindex="-1"></a>  <span class="at">kingdom_taxonomy =</span> <span class="fu">col_integer</span>(),</span>
<span id="cb2-100"><a href="#cb2-100" aria-hidden="true" tabindex="-1"></a>  <span class="at">order_taxonomy =</span> <span class="fu">col_integer</span>(),</span>
<span id="cb2-101"><a href="#cb2-101" aria-hidden="true" tabindex="-1"></a>  <span class="at">phylum_taxonomy =</span> <span class="fu">col_double</span>(),</span>
<span id="cb2-102"><a href="#cb2-102" aria-hidden="true" tabindex="-1"></a>  <span class="at">class_taxid_taxonomy =</span> <span class="fu">col_integer</span>(),</span>
<span id="cb2-103"><a href="#cb2-103" aria-hidden="true" tabindex="-1"></a>  <span class="at">family_taxid_taxonomy =</span> <span class="fu">col_integer</span>(),</span>
<span id="cb2-104"><a href="#cb2-104" aria-hidden="true" tabindex="-1"></a>  <span class="at">genus_taxid_taxonomy =</span> <span class="fu">col_integer</span>(),</span>
<span id="cb2-105"><a href="#cb2-105" aria-hidden="true" tabindex="-1"></a>  <span class="at">kingdom_taxid_taxonomy =</span> <span class="fu">col_integer</span>(),</span>
<span id="cb2-106"><a href="#cb2-106" aria-hidden="true" tabindex="-1"></a>  <span class="at">order_taxid_taxonomy =</span> <span class="fu">col_integer</span>(),</span>
<span id="cb2-107"><a href="#cb2-107" aria-hidden="true" tabindex="-1"></a>  <span class="at">phylum_taxid_taxonomy =</span> <span class="fu">col_integer</span>(),</span>
<span id="cb2-108"><a href="#cb2-108" aria-hidden="true" tabindex="-1"></a>  <span class="at">publication_year_bioprj =</span> <span class="fu">col_integer</span>(),</span>
<span id="cb2-109"><a href="#cb2-109" aria-hidden="true" tabindex="-1"></a>  <span class="at">publication_volume_bioprj =</span> <span class="fu">col_integer</span>(),</span>
<span id="cb2-110"><a href="#cb2-110" aria-hidden="true" tabindex="-1"></a>  <span class="at">publication_issue_bioprj =</span> <span class="fu">col_integer</span>(),</span>
<span id="cb2-111"><a href="#cb2-111" aria-hidden="true" tabindex="-1"></a>  <span class="at">uid_pubmed =</span> <span class="fu">col_integer</span>(),</span>
<span id="cb2-112"><a href="#cb2-112" aria-hidden="true" tabindex="-1"></a>  <span class="at">volume_pubmed =</span> <span class="fu">col_integer</span>(),</span>
<span id="cb2-113"><a href="#cb2-113" aria-hidden="true" tabindex="-1"></a>  <span class="at">issue_pubmed =</span> <span class="fu">col_integer</span>(),</span>
<span id="cb2-114"><a href="#cb2-114" aria-hidden="true" tabindex="-1"></a>  <span class="at">nlmuniqueid_pubmed =</span> <span class="fu">col_integer</span>(),</span>
<span id="cb2-115"><a href="#cb2-115" aria-hidden="true" tabindex="-1"></a>  <span class="at">pmcrefcount_pubmed =</span> <span class="fu">col_integer</span>()</span>
<span id="cb2-116"><a href="#cb2-116" aria-hidden="true" tabindex="-1"></a>))</span>
<span id="cb2-117"><a href="#cb2-117" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb2-118"><a href="#cb2-118" aria-hidden="true" tabindex="-1"></a>list4 <span class="ot">&lt;-</span> <span class="fu">read_csv</span>(<span class="st">"/Volumes/GoogleDrive/My Drive/GEOME_Datathon/SRA_Lists/list4-eukaryotes-min5indivs-_without_latlong_located_yet_outsideofNCBI-6-22-2020.csv"</span>, <span class="at">na =</span> <span class="fu">c</span>(<span class="st">"NA"</span>,<span class="st">"na"</span>,<span class="st">"?"</span>), <span class="at">col_types =</span> <span class="fu">cols</span>(</span>
<span id="cb2-119"><a href="#cb2-119" aria-hidden="true" tabindex="-1"></a>  <span class="at">.default =</span> <span class="fu">col_character</span>(),</span>
<span id="cb2-120"><a href="#cb2-120" aria-hidden="true" tabindex="-1"></a>  <span class="at">X1 =</span> <span class="fu">col_double</span>(),</span>
<span id="cb2-121"><a href="#cb2-121" aria-hidden="true" tabindex="-1"></a>  <span class="at">taxid_sra =</span> <span class="fu">col_integer</span>(),</span>
<span id="cb2-122"><a href="#cb2-122" aria-hidden="true" tabindex="-1"></a>  <span class="at">uid_bioprj =</span> <span class="fu">col_integer</span>(),</span>
<span id="cb2-123"><a href="#cb2-123" aria-hidden="true" tabindex="-1"></a>  <span class="at">taxid_bioprj =</span> <span class="fu">col_integer</span>(),</span>
<span id="cb2-124"><a href="#cb2-124" aria-hidden="true" tabindex="-1"></a>  <span class="at">uid_sra =</span> <span class="fu">col_integer</span>(),</span>
<span id="cb2-125"><a href="#cb2-125" aria-hidden="true" tabindex="-1"></a>  <span class="at">total_number_reads_sra =</span> <span class="fu">col_number</span>(),</span>
<span id="cb2-126"><a href="#cb2-126" aria-hidden="true" tabindex="-1"></a>  <span class="at">total_number_base_pairs_sra =</span> <span class="fu">col_number</span>(),</span>
<span id="cb2-127"><a href="#cb2-127" aria-hidden="true" tabindex="-1"></a>  <span class="at">createdate_sra =</span> <span class="fu">col_date</span>(<span class="at">format =</span> <span class="st">""</span>),</span>
<span id="cb2-128"><a href="#cb2-128" aria-hidden="true" tabindex="-1"></a>  <span class="at">iteration_sra =</span> <span class="fu">col_integer</span>(),</span>
<span id="cb2-129"><a href="#cb2-129" aria-hidden="true" tabindex="-1"></a>  <span class="at">uid_biosamp =</span> <span class="fu">col_integer</span>(),</span>
<span id="cb2-130"><a href="#cb2-130" aria-hidden="true" tabindex="-1"></a>  <span class="at">date_biosamp =</span> <span class="fu">col_date</span>(<span class="at">format =</span> <span class="st">""</span>),</span>
<span id="cb2-131"><a href="#cb2-131" aria-hidden="true" tabindex="-1"></a>  <span class="at">publicationdate_biosamp =</span> <span class="fu">col_date</span>(<span class="at">format =</span> <span class="st">""</span>),</span>
<span id="cb2-132"><a href="#cb2-132" aria-hidden="true" tabindex="-1"></a>  <span class="at">modificationdate_biosamp =</span> <span class="fu">col_date</span>(<span class="at">format =</span> <span class="st">""</span>),</span>
<span id="cb2-133"><a href="#cb2-133" aria-hidden="true" tabindex="-1"></a>  <span class="at">taxonomy_biosamp =</span> <span class="fu">col_integer</span>(),</span>
<span id="cb2-134"><a href="#cb2-134" aria-hidden="true" tabindex="-1"></a>  <span class="at">taxid_taxonomy =</span> <span class="fu">col_integer</span>(),</span>
<span id="cb2-135"><a href="#cb2-135" aria-hidden="true" tabindex="-1"></a>  <span class="at">class_taxonomy =</span> <span class="fu">col_integer</span>(),</span>
<span id="cb2-136"><a href="#cb2-136" aria-hidden="true" tabindex="-1"></a>  <span class="at">family_taxonomy =</span> <span class="fu">col_integer</span>(),</span>
<span id="cb2-137"><a href="#cb2-137" aria-hidden="true" tabindex="-1"></a>  <span class="at">genus_taxonomy =</span> <span class="fu">col_integer</span>(),</span>
<span id="cb2-138"><a href="#cb2-138" aria-hidden="true" tabindex="-1"></a>  <span class="at">kingdom_taxonomy =</span> <span class="fu">col_integer</span>(),</span>
<span id="cb2-139"><a href="#cb2-139" aria-hidden="true" tabindex="-1"></a>  <span class="at">order_taxonomy =</span> <span class="fu">col_integer</span>(),</span>
<span id="cb2-140"><a href="#cb2-140" aria-hidden="true" tabindex="-1"></a>  <span class="at">phylum_taxonomy =</span> <span class="fu">col_double</span>(),</span>
<span id="cb2-141"><a href="#cb2-141" aria-hidden="true" tabindex="-1"></a>  <span class="at">class_taxid_taxonomy =</span> <span class="fu">col_integer</span>(),</span>
<span id="cb2-142"><a href="#cb2-142" aria-hidden="true" tabindex="-1"></a>  <span class="at">family_taxid_taxonomy =</span> <span class="fu">col_integer</span>(),</span>
<span id="cb2-143"><a href="#cb2-143" aria-hidden="true" tabindex="-1"></a>  <span class="at">genus_taxid_taxonomy =</span> <span class="fu">col_integer</span>(),</span>
<span id="cb2-144"><a href="#cb2-144" aria-hidden="true" tabindex="-1"></a>  <span class="at">kingdom_taxid_taxonomy =</span> <span class="fu">col_integer</span>(),</span>
<span id="cb2-145"><a href="#cb2-145" aria-hidden="true" tabindex="-1"></a>  <span class="at">order_taxid_taxonomy =</span> <span class="fu">col_integer</span>(),</span>
<span id="cb2-146"><a href="#cb2-146" aria-hidden="true" tabindex="-1"></a>  <span class="at">phylum_taxid_taxonomy =</span> <span class="fu">col_integer</span>(),</span>
<span id="cb2-147"><a href="#cb2-147" aria-hidden="true" tabindex="-1"></a>  <span class="at">publication_year_bioprj =</span> <span class="fu">col_integer</span>(),</span>
<span id="cb2-148"><a href="#cb2-148" aria-hidden="true" tabindex="-1"></a>  <span class="at">publication_volume_bioprj =</span> <span class="fu">col_integer</span>(),</span>
<span id="cb2-149"><a href="#cb2-149" aria-hidden="true" tabindex="-1"></a>  <span class="at">publication_issue_bioprj =</span> <span class="fu">col_integer</span>(),</span>
<span id="cb2-150"><a href="#cb2-150" aria-hidden="true" tabindex="-1"></a>  <span class="at">uid_pubmed =</span> <span class="fu">col_integer</span>(),</span>
<span id="cb2-151"><a href="#cb2-151" aria-hidden="true" tabindex="-1"></a>  <span class="at">volume_pubmed =</span> <span class="fu">col_integer</span>(),</span>
<span id="cb2-152"><a href="#cb2-152" aria-hidden="true" tabindex="-1"></a>  <span class="at">pmcrefcount_pubmed =</span> <span class="fu">col_integer</span>()</span>
<span id="cb2-153"><a href="#cb2-153" aria-hidden="true" tabindex="-1"></a>))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<section id="pull-out-sra-metadata" class="level2">
<h2 class="anchored" data-anchor-id="pull-out-sra-metadata">Pull Out SRA Metadata</h2>
<p>Rachel pulled out some of the metadata that describe the sequencing experiment (why <em>do</em> they call them sequencing “experiments”?) in the mega-field <code>expxml_sra</code>. However, we need to pull out a few more, specifically <code>library_source</code>, <code>platform</code>, <code>instrument_model</code> and <code>protocol_citation</code>. Looks like that field doesn’t contain <code>protocol_citation</code>. That’s OK.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb3"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb3-1"><a href="#cb3-1" aria-hidden="true" tabindex="-1"></a>pull_sra <span class="ot">&lt;-</span> <span class="cf">function</span>(listx){</span>
<span id="cb3-2"><a href="#cb3-2" aria-hidden="true" tabindex="-1"></a>      plat_inst <span class="ot">&lt;-</span> <span class="fu">str_match</span>(listx<span class="sc">$</span>expxml_sra, <span class="at">pattern =</span> <span class="st">";Platform instrument_model=</span><span class="sc">\"</span><span class="st">(.+)</span><span class="sc">\"</span><span class="st">&amp;gt;(</span><span class="sc">\\</span><span class="st">w+)&amp;lt;"</span>)</span>
<span id="cb3-3"><a href="#cb3-3" aria-hidden="true" tabindex="-1"></a>      library_source <span class="ot">&lt;-</span> <span class="fu">str_match</span>(listx<span class="sc">$</span>expxml_sra, <span class="at">pattern =</span> <span class="st">"LIBRARY_SOURCE&amp;gt;(</span><span class="sc">\\</span><span class="st">w+)&amp;lt;"</span>)[,<span class="dv">2</span>]</span>
<span id="cb3-4"><a href="#cb3-4" aria-hidden="true" tabindex="-1"></a>      library_name <span class="ot">&lt;-</span> <span class="fu">str_match</span>(listx<span class="sc">$</span>expxml_sra, <span class="at">pattern =</span> <span class="st">"LIBRARY_NAME&amp;gt;(</span><span class="sc">\\</span><span class="st">w+)&amp;lt;"</span>)[,<span class="dv">2</span>]</span>
<span id="cb3-5"><a href="#cb3-5" aria-hidden="true" tabindex="-1"></a>      </span>
<span id="cb3-6"><a href="#cb3-6" aria-hidden="true" tabindex="-1"></a>      </span>
<span id="cb3-7"><a href="#cb3-7" aria-hidden="true" tabindex="-1"></a>      listx <span class="ot">&lt;-</span> <span class="fu">cbind</span>(listx, <span class="at">platform =</span> plat_inst[,<span class="dv">3</span>])</span>
<span id="cb3-8"><a href="#cb3-8" aria-hidden="true" tabindex="-1"></a>      listx <span class="ot">&lt;-</span> <span class="fu">cbind</span>(listx, <span class="at">instrument =</span> plat_inst[,<span class="dv">2</span>])</span>
<span id="cb3-9"><a href="#cb3-9" aria-hidden="true" tabindex="-1"></a>      listx <span class="ot">&lt;-</span> <span class="fu">cbind</span>(listx, <span class="at">library_source =</span> library_source)</span>
<span id="cb3-10"><a href="#cb3-10" aria-hidden="true" tabindex="-1"></a>      listx <span class="ot">&lt;-</span> <span class="fu">cbind</span>(listx, <span class="at">library_name =</span> library_name)</span>
<span id="cb3-11"><a href="#cb3-11" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb3-12"><a href="#cb3-12" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb3-13"><a href="#cb3-13" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb3-14"><a href="#cb3-14" aria-hidden="true" tabindex="-1"></a>list1 <span class="ot">&lt;-</span> <span class="fu">pull_sra</span>(list1)</span>
<span id="cb3-15"><a href="#cb3-15" aria-hidden="true" tabindex="-1"></a>list2 <span class="ot">&lt;-</span> <span class="fu">pull_sra</span>(list2)</span>
<span id="cb3-16"><a href="#cb3-16" aria-hidden="true" tabindex="-1"></a>list3 <span class="ot">&lt;-</span> <span class="fu">pull_sra</span>(list3)</span>
<span id="cb3-17"><a href="#cb3-17" aria-hidden="true" tabindex="-1"></a>list4 <span class="ot">&lt;-</span> <span class="fu">pull_sra</span>(list4)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</section>
<section id="winnow-the-fields" class="level2">
<h2 class="anchored" data-anchor-id="winnow-the-fields">Winnow the Fields</h2>
<p>(sounds very pastoral)</p>
<p>I went through each of 139 fields and deleted fields that seemed useless in terms of finding metadata. Remaining fields are in <code>keeps</code>. Fields to delete can now be found below in <code>drops</code> (found with <code>setdiff()</code> and <code>dput()</code>).</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb4"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb4-1"><a href="#cb4-1" aria-hidden="true" tabindex="-1"></a>keeps <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="st">"X1"</span>,<span class="st">"link"</span>,<span class="st">"Comments_about_spatial_data_location"</span>,<span class="st">"link_to_published_paper"</span>,<span class="st">"project_acc_bioprj"</span>,<span class="st">"organism_biosamp"</span>,<span class="st">"run_acc_sra"</span>,<span class="st">"taxid_sra"</span>,<span class="st">"biosample_acc_sra"</span>,<span class="st">"X_bioprj"</span>,<span class="st">"project_data_type_bioprj"</span>,<span class="st">"project_target_scope_bioprj"</span>,<span class="st">"project_target_material_bioprj"</span>,<span class="st">"project_target_capture_bioprj"</span>,<span class="st">"registration_date_bioprj"</span>,<span class="st">"project_name_bioprj"</span>,<span class="st">"project_title_bioprj"</span>,<span class="st">"project_description_bioprj"</span>,<span class="st">"relevance_environmental_bioprj"</span>,<span class="st">"relevance_evolution_bioprj"</span>,<span class="st">"sequencing_status_bioprj"</span>,<span class="st">"supergroup_bioprj"</span>,<span class="st">"lab_name_sra"</span>,<span class="st">"contact_name_sra"</span>,<span class="st">"center_name_sra"</span>,<span class="st">"read_type_sra"</span>,<span class="st">"library_selection_sra"</span>,<span class="st">"experiment_acc_sra"</span>,<span class="st">"sample_acc_sra"</span>,<span class="st">"study_acc_sra"</span>,<span class="st">"library_strat_sra"</span>,<span class="st">"total_number_reads_sra"</span>,<span class="st">"total_number_base_pairs_sra"</span>,<span class="st">"createdate_sra"</span>,<span class="st">"title_biosamp"</span>,<span class="st">"date_biosamp"</span>,<span class="st">"modificationdate_biosamp"</span>,<span class="st">"organization_biosamp"</span>,<span class="st">"taxonomy_biosamp"</span>,<span class="st">"sourcesample_biosamp"</span>,<span class="st">"collectors_info_biosamp"</span>,<span class="st">"contact_last_name_biosamp"</span>,<span class="st">"contact_first_name_biosamp"</span>,<span class="st">"contact_email_biosamp"</span>,<span class="st">"organization_name_messy_biosamp"</span>,<span class="st">"collection_date_biosamp"</span>,<span class="st">"samplename_sampledata_biosamp"</span>,<span class="st">"lat_long_biosamp"</span>,<span class="st">"identifiers_biosamp"</span>,<span class="st">"samplename_identifiers_biosamp"</span>,<span class="st">"infraspecies_biosamp"</span>,<span class="st">"ecotype_biosamp"</span>,<span class="st">"package_biosamp"</span>,<span class="st">"taxid_taxonomy"</span>,<span class="st">"scientific_name_taxonomy"</span>,<span class="st">"myrank_taxonomy"</span>,<span class="st">"division_taxonomy"</span>,<span class="st">"full_lineage_taxonomy"</span>,<span class="st">"publication_ID_bioprj"</span>,<span class="st">"publication_firstauthor_bioprj"</span>,<span class="st">"publication_title_bioprj"</span>,<span class="st">"publication_journalname_bioprj"</span>,<span class="st">"publication_year_bioprj"</span>,<span class="st">"publication_volume_bioprj"</span>,<span class="st">"publication_issue_bioprj"</span>,<span class="st">"DOI_pubmed"</span>,<span class="st">"uid_pubmed"</span>,<span class="st">"pubdate_pubmed"</span>,<span class="st">"epubdate_pubmed"</span>,<span class="st">"source_pubmed"</span>,<span class="st">"lastauthor_pubmed"</span>,<span class="st">"title_pubmed"</span>,<span class="st">"sorttitle_pubmed"</span>,<span class="st">"volume_pubmed"</span>,<span class="st">"issue_pubmed"</span>,<span class="st">"pages_pubmed"</span>,<span class="st">"lang_pubmed"</span>,<span class="st">"nlmuniqueid_pubmed"</span>,<span class="st">"issn_pubmed"</span>,<span class="st">"essn_pubmed"</span>,<span class="st">"pubtype_pubmed"</span>,<span class="st">"recordstatus_pubmed"</span>,<span class="st">"pubstatus_pubmed"</span>,<span class="st">"fulljournalname_pubmed"</span>,<span class="st">"elocationid_pubmed"</span>,<span class="st">"availablefromurl_pubmed"</span>,<span class="st">"platform"</span>,<span class="st">"instrument"</span>,<span class="st">"library_source"</span>, <span class="st">"biosamp_country"</span>, <span class="st">"biosamp_locality"</span>)</span>
<span id="cb4-2"><a href="#cb4-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb4-3"><a href="#cb4-3" aria-hidden="true" tabindex="-1"></a>drops <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="st">"uid_bioprj"</span>, <span class="st">"taxid_bioprj"</span>, <span class="st">"project_type_bioprj"</span>, </span>
<span id="cb4-4"><a href="#cb4-4" aria-hidden="true" tabindex="-1"></a><span class="st">"project_methodtype_bioprj"</span>, <span class="st">"relevance_agricultural_bioprj"</span>, </span>
<span id="cb4-5"><a href="#cb4-5" aria-hidden="true" tabindex="-1"></a><span class="st">"relevance_medical_bioprj"</span>, <span class="st">"relevance_industrial_bioprj"</span>, <span class="st">"relevance_model_bioprj"</span>, </span>
<span id="cb4-6"><a href="#cb4-6" aria-hidden="true" tabindex="-1"></a><span class="st">"relevance_other_bioprj"</span>, <span class="st">"organism_name_bioprj"</span>, <span class="st">"organism_strain_bioprj"</span>, </span>
<span id="cb4-7"><a href="#cb4-7" aria-hidden="true" tabindex="-1"></a><span class="st">"organism_label_bioprj"</span>, <span class="st">"uid_sra"</span>, <span class="st">"expxml_sra"</span>, <span class="st">"scientific_name_sra"</span>, </span>
<span id="cb4-8"><a href="#cb4-8" aria-hidden="true" tabindex="-1"></a><span class="st">"runs_sra"</span>, <span class="st">"extlinks_sra"</span>, <span class="st">"iteration_sra"</span>, <span class="st">"uid_biosamp"</span>, <span class="st">"accession_biosamp"</span>,</span>
<span id="cb4-9"><a href="#cb4-9" aria-hidden="true" tabindex="-1"></a><span class="st">"publicationdate_biosamp"</span>, <span class="st">"sampledata_biosamp"</span>, <span class="st">"class_taxonomy"</span>, </span>
<span id="cb4-10"><a href="#cb4-10" aria-hidden="true" tabindex="-1"></a><span class="st">"family_taxonomy"</span>, <span class="st">"genus_taxonomy"</span>, <span class="st">"kingdom_taxonomy"</span>, <span class="st">"order_taxonomy"</span>, </span>
<span id="cb4-11"><a href="#cb4-11" aria-hidden="true" tabindex="-1"></a><span class="st">"phylum_taxonomy"</span>, <span class="st">"class_taxid_taxonomy"</span>, <span class="st">"family_taxid_taxonomy"</span>, </span>
<span id="cb4-12"><a href="#cb4-12" aria-hidden="true" tabindex="-1"></a><span class="st">"genus_taxid_taxonomy"</span>, <span class="st">"kingdom_taxid_taxonomy"</span>, <span class="st">"order_taxid_taxonomy"</span>, </span>
<span id="cb4-13"><a href="#cb4-13" aria-hidden="true" tabindex="-1"></a><span class="st">"phylum_taxid_taxonomy"</span>, <span class="st">"full_fetched_record_bioprj"</span>, <span class="st">"publication_pages_bioprj"</span>, </span>
<span id="cb4-14"><a href="#cb4-14" aria-hidden="true" tabindex="-1"></a><span class="st">"attributes_pubmed"</span>, <span class="st">"pmcrefcount_pubmed"</span>, <span class="st">"doctype_pubmed"</span>, </span>
<span id="cb4-15"><a href="#cb4-15" aria-hidden="true" tabindex="-1"></a><span class="st">"booktitle_pubmed"</span>, <span class="st">"medium_pubmed"</span>, <span class="st">"edition_pubmed"</span>, <span class="st">"publisherlocation_pubmed"</span>, </span>
<span id="cb4-16"><a href="#cb4-16" aria-hidden="true" tabindex="-1"></a><span class="st">"publishername_pubmed"</span>, <span class="st">"srcdate_pubmed"</span>, <span class="st">"reportnumber_pubmed"</span>, </span>
<span id="cb4-17"><a href="#cb4-17" aria-hidden="true" tabindex="-1"></a><span class="st">"locationlabel_pubmed"</span>, <span class="st">"docdate_pubmed"</span>, <span class="st">"bookname_pubmed"</span>, </span>
<span id="cb4-18"><a href="#cb4-18" aria-hidden="true" tabindex="-1"></a><span class="st">"chapter_pubmed"</span>, <span class="st">"sortpubdate_pubmed"</span>, <span class="st">"sortfirstauthor_pubmed"</span>, </span>
<span id="cb4-19"><a href="#cb4-19" aria-hidden="true" tabindex="-1"></a><span class="st">"vernaculartitle_pubmed, issue_pubmed"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>Now I’m going to try a new way to drop columns in <code>dplyr</code>. Using all_of removes potential ambiguity from <code>drops</code> being also a column name. I am then adding in columns for student notations using <code>add_column()</code>. For the marine dataset, some of this work has already been done, so I need to add these columns with appropriate T/F values to the original lists, before summarizing.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb5"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb5-1"><a href="#cb5-1" aria-hidden="true" tabindex="-1"></a>list1 <span class="ot">&lt;-</span> <span class="fu">select</span>(list1,<span class="sc">-</span><span class="fu">all_of</span>(drops)) <span class="sc">%&gt;%</span> <span class="fu">add_column</span>(<span class="at">.after =</span> <span class="st">"link"</span>, <span class="at">Metadata_Curator =</span> <span class="st">""</span>,</span>
<span id="cb5-2"><a href="#cb5-2" aria-hidden="true" tabindex="-1"></a>                                                     <span class="at">Relevant =</span> <span class="st">"TRUE"</span>, </span>
<span id="cb5-3"><a href="#cb5-3" aria-hidden="true" tabindex="-1"></a>                                                     <span class="at">Relevance_Comments =</span> <span class="st">""</span>,</span>
<span id="cb5-4"><a href="#cb5-4" aria-hidden="true" tabindex="-1"></a>                                                     <span class="at">Paper_Available =</span> <span class="st">"TRUE"</span>,</span>
<span id="cb5-5"><a href="#cb5-5" aria-hidden="true" tabindex="-1"></a>                                                     <span class="at">Paper_Comments =</span> <span class="st">""</span>,</span>
<span id="cb5-6"><a href="#cb5-6" aria-hidden="true" tabindex="-1"></a>                                                     <span class="at">Authors_Contacted =</span> <span class="st">"FALSE"</span>,</span>
<span id="cb5-7"><a href="#cb5-7" aria-hidden="true" tabindex="-1"></a>                                                     <span class="at">Who_Will_Contact =</span> <span class="st">""</span>,</span>
<span id="cb5-8"><a href="#cb5-8" aria-hidden="true" tabindex="-1"></a>                                                     <span class="at">Email_Date=</span> <span class="st">""</span>,</span>
<span id="cb5-9"><a href="#cb5-9" aria-hidden="true" tabindex="-1"></a>                                                     <span class="at">Author_Contact_Comments =</span> <span class="st">""</span>,</span>
<span id="cb5-10"><a href="#cb5-10" aria-hidden="true" tabindex="-1"></a>                                                     <span class="at">Metadata_Gathered =</span> <span class="st">"FALSE"</span>,</span>
<span id="cb5-11"><a href="#cb5-11" aria-hidden="true" tabindex="-1"></a>                                                     <span class="at">Metadata_Gathered_Comments =</span> <span class="st">""</span>,</span>
<span id="cb5-12"><a href="#cb5-12" aria-hidden="true" tabindex="-1"></a>                                                     <span class="at">Metadata_Entered =</span> <span class="st">"FALSE"</span>,</span>
<span id="cb5-13"><a href="#cb5-13" aria-hidden="true" tabindex="-1"></a>                                                     <span class="at">Metadata_Entered_Comments=</span> <span class="st">""</span>,</span>
<span id="cb5-14"><a href="#cb5-14" aria-hidden="true" tabindex="-1"></a>                                                     <span class="at">Validated =</span> <span class="st">""</span>,</span>
<span id="cb5-15"><a href="#cb5-15" aria-hidden="true" tabindex="-1"></a>                                                     <span class="at">Validation_Comments =</span> <span class="st">""</span>,</span>
<span id="cb5-16"><a href="#cb5-16" aria-hidden="true" tabindex="-1"></a>                                                     <span class="at">Total_Minutes_Spent=</span> <span class="st">""</span>,</span>
<span id="cb5-17"><a href="#cb5-17" aria-hidden="true" tabindex="-1"></a>                                                     <span class="at">Quality_Controlled =</span> <span class="st">"FALSE"</span>,</span>
<span id="cb5-18"><a href="#cb5-18" aria-hidden="true" tabindex="-1"></a>                                                     <span class="at">Quality_Controller =</span> <span class="st">""</span>,</span>
<span id="cb5-19"><a href="#cb5-19" aria-hidden="true" tabindex="-1"></a>                                                     <span class="at">Quality_Control_Comments =</span> <span class="st">""</span>)</span>
<span id="cb5-20"><a href="#cb5-20" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb5-21"><a href="#cb5-21" aria-hidden="true" tabindex="-1"></a>list2 <span class="ot">&lt;-</span> <span class="fu">select</span>(list2,<span class="sc">-</span><span class="fu">all_of</span>(drops))  <span class="sc">%&gt;%</span> <span class="fu">add_column</span>(<span class="at">.after =</span> <span class="st">"link"</span>, <span class="at">Metadata_Curator =</span> <span class="st">""</span>,</span>
<span id="cb5-22"><a href="#cb5-22" aria-hidden="true" tabindex="-1"></a>                                                     <span class="at">Relevant =</span> <span class="st">"TRUE"</span>, </span>
<span id="cb5-23"><a href="#cb5-23" aria-hidden="true" tabindex="-1"></a>                                                     <span class="at">Relevance_Comments =</span> <span class="st">""</span>,</span>
<span id="cb5-24"><a href="#cb5-24" aria-hidden="true" tabindex="-1"></a>                                                     <span class="at">Paper_Available =</span> <span class="st">"NA"</span>,</span>
<span id="cb5-25"><a href="#cb5-25" aria-hidden="true" tabindex="-1"></a>                                                     <span class="at">Paper_Comments =</span> <span class="st">""</span>,</span>
<span id="cb5-26"><a href="#cb5-26" aria-hidden="true" tabindex="-1"></a>                                                     <span class="at">Authors_Contacted =</span> <span class="st">"FALSE"</span>,</span>
<span id="cb5-27"><a href="#cb5-27" aria-hidden="true" tabindex="-1"></a>                                                     <span class="at">Who_Will_Contact =</span> <span class="st">""</span>,</span>
<span id="cb5-28"><a href="#cb5-28" aria-hidden="true" tabindex="-1"></a>                                                     <span class="at">Email_Date =</span> <span class="st">""</span>,</span>
<span id="cb5-29"><a href="#cb5-29" aria-hidden="true" tabindex="-1"></a>                                                     <span class="at">Author_Contact_Comments =</span> <span class="st">""</span>,</span>
<span id="cb5-30"><a href="#cb5-30" aria-hidden="true" tabindex="-1"></a>                                                     <span class="at">Metadata_Gathered =</span> <span class="st">"FALSE"</span>,</span>
<span id="cb5-31"><a href="#cb5-31" aria-hidden="true" tabindex="-1"></a>                                                     <span class="at">Metadata_Gathered_Comments =</span> <span class="st">""</span>,</span>
<span id="cb5-32"><a href="#cb5-32" aria-hidden="true" tabindex="-1"></a>                                                     <span class="at">Metadata_Entered =</span> <span class="st">"FALSE"</span>,</span>
<span id="cb5-33"><a href="#cb5-33" aria-hidden="true" tabindex="-1"></a>                                                     <span class="at">Metadata_Entered_Comments =</span> <span class="st">""</span>,</span>
<span id="cb5-34"><a href="#cb5-34" aria-hidden="true" tabindex="-1"></a>                                                     <span class="at">Validated =</span> <span class="st">""</span>,</span>
<span id="cb5-35"><a href="#cb5-35" aria-hidden="true" tabindex="-1"></a>                                                     <span class="at">Validation_Comments =</span> <span class="st">""</span>,</span>
<span id="cb5-36"><a href="#cb5-36" aria-hidden="true" tabindex="-1"></a>                                                     <span class="at">Total_Minutes_Spent=</span> <span class="st">""</span>,</span>
<span id="cb5-37"><a href="#cb5-37" aria-hidden="true" tabindex="-1"></a>                                                     <span class="at">Quality_Controlled =</span> <span class="st">"FALSE"</span>,</span>
<span id="cb5-38"><a href="#cb5-38" aria-hidden="true" tabindex="-1"></a>                                                     <span class="at">Quality_Controller =</span> <span class="st">""</span>,</span>
<span id="cb5-39"><a href="#cb5-39" aria-hidden="true" tabindex="-1"></a>                                                     <span class="at">Quality_Control_Comments =</span> <span class="st">""</span>)</span>
<span id="cb5-40"><a href="#cb5-40" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb5-41"><a href="#cb5-41" aria-hidden="true" tabindex="-1"></a>list3 <span class="ot">&lt;-</span> <span class="fu">select</span>(list3,<span class="sc">-</span><span class="fu">all_of</span>(drops)) <span class="sc">%&gt;%</span> <span class="fu">add_column</span>(<span class="at">.after =</span> <span class="st">"link"</span>, <span class="at">Metadata_Curator =</span> <span class="st">""</span>,</span>
<span id="cb5-42"><a href="#cb5-42" aria-hidden="true" tabindex="-1"></a>                                                     <span class="at">Relevant =</span> <span class="st">"TRUE"</span>, </span>
<span id="cb5-43"><a href="#cb5-43" aria-hidden="true" tabindex="-1"></a>                                                     <span class="at">Relevance_Comments =</span> <span class="st">""</span>,</span>
<span id="cb5-44"><a href="#cb5-44" aria-hidden="true" tabindex="-1"></a>                                                     <span class="at">Paper_Available =</span> <span class="st">"FALSE"</span>,</span>
<span id="cb5-45"><a href="#cb5-45" aria-hidden="true" tabindex="-1"></a>                                                     <span class="at">Paper_Comments =</span> <span class="st">""</span>,</span>
<span id="cb5-46"><a href="#cb5-46" aria-hidden="true" tabindex="-1"></a>                                                     <span class="at">Authors_Contacted =</span> <span class="st">"FALSE"</span>,</span>
<span id="cb5-47"><a href="#cb5-47" aria-hidden="true" tabindex="-1"></a>                                                     <span class="at">Who_Will_Contact =</span> <span class="st">""</span>,</span>
<span id="cb5-48"><a href="#cb5-48" aria-hidden="true" tabindex="-1"></a>                                                     <span class="at">Email_Date =</span> <span class="st">""</span>,</span>
<span id="cb5-49"><a href="#cb5-49" aria-hidden="true" tabindex="-1"></a>                                                     <span class="at">Author_Contact_Comments =</span> <span class="st">""</span>,</span>
<span id="cb5-50"><a href="#cb5-50" aria-hidden="true" tabindex="-1"></a>                                                     <span class="at">Metadata_Gathered =</span> <span class="st">"FALSE"</span>,</span>
<span id="cb5-51"><a href="#cb5-51" aria-hidden="true" tabindex="-1"></a>                                                     <span class="at">Metadata_Gathered_Comments =</span> <span class="st">""</span>,</span>
<span id="cb5-52"><a href="#cb5-52" aria-hidden="true" tabindex="-1"></a>                                                     <span class="at">Metadata_Entered =</span> <span class="st">"FALSE"</span>,</span>
<span id="cb5-53"><a href="#cb5-53" aria-hidden="true" tabindex="-1"></a>                                                     <span class="at">Metadata_Entered_Comments =</span> <span class="st">""</span>,</span>
<span id="cb5-54"><a href="#cb5-54" aria-hidden="true" tabindex="-1"></a>                                                     <span class="at">Validated =</span> <span class="st">""</span>,</span>
<span id="cb5-55"><a href="#cb5-55" aria-hidden="true" tabindex="-1"></a>                                                     <span class="at">Validation_Comments =</span> <span class="st">""</span>,</span>
<span id="cb5-56"><a href="#cb5-56" aria-hidden="true" tabindex="-1"></a>                                                     <span class="at">Total_Minutes_Spent=</span> <span class="st">""</span>,</span>
<span id="cb5-57"><a href="#cb5-57" aria-hidden="true" tabindex="-1"></a>                                                     <span class="at">Quality_Controlled =</span> <span class="st">"FALSE"</span>,</span>
<span id="cb5-58"><a href="#cb5-58" aria-hidden="true" tabindex="-1"></a>                                                     <span class="at">Quality_Controller =</span> <span class="st">""</span>,</span>
<span id="cb5-59"><a href="#cb5-59" aria-hidden="true" tabindex="-1"></a>                                                     <span class="at">Quality_Control_Comments =</span> <span class="st">""</span>)</span>
<span id="cb5-60"><a href="#cb5-60" aria-hidden="true" tabindex="-1"></a>nonmarinelist <span class="ot">&lt;-</span> <span class="fu">select</span>(list4,<span class="sc">-</span><span class="fu">all_of</span>(drops))</span>
<span id="cb5-61"><a href="#cb5-61" aria-hidden="true" tabindex="-1"></a><span class="fu">rm</span>(list4)</span>
<span id="cb5-62"><a href="#cb5-62" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb5-63"><a href="#cb5-63" aria-hidden="true" tabindex="-1"></a>marinelist <span class="ot">&lt;-</span> <span class="fu">bind_rows</span>(list1,list3,list2)</span>
<span id="cb5-64"><a href="#cb5-64" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb5-65"><a href="#cb5-65" aria-hidden="true" tabindex="-1"></a><span class="co">#write_csv(marinelist, "../GEOME_Datathon_Dataset_Lists/marinelist_winnowed.csv")</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</section>
</section>
<section id="summarize-by-bioproject" class="level1">
<h1>Summarize By BioProject</h1>
<p>Summarize all of these data by BioProject, counting the number of BioSamples and Runs and Species, and adding a <code>project_index</code> that will be easier to refer to verbally.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb6"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb6-1"><a href="#cb6-1" aria-hidden="true" tabindex="-1"></a>Marine_BioProjects <span class="ot">&lt;-</span> <span class="fu">group_by</span>(marinelist, project_acc_bioprj) <span class="sc">%&gt;%</span> </span>
<span id="cb6-2"><a href="#cb6-2" aria-hidden="true" tabindex="-1"></a>                      <span class="fu">summarize</span>(</span>
<span id="cb6-3"><a href="#cb6-3" aria-hidden="true" tabindex="-1"></a>                              <span class="at">BioSamples =</span> <span class="fu">n_distinct</span>(biosample_acc_sra),</span>
<span id="cb6-4"><a href="#cb6-4" aria-hidden="true" tabindex="-1"></a>                              <span class="at">Runs =</span> <span class="fu">n_distinct</span>(run_acc_sra),</span>
<span id="cb6-5"><a href="#cb6-5" aria-hidden="true" tabindex="-1"></a>                              <span class="at">N_Species =</span> <span class="fu">n_distinct</span>(organism_biosamp),</span>
<span id="cb6-6"><a href="#cb6-6" aria-hidden="true" tabindex="-1"></a>                              <span class="at">Species_all =</span> <span class="fu">paste</span>(<span class="fu">unique</span>(organism_biosamp),</span>
<span id="cb6-7"><a href="#cb6-7" aria-hidden="true" tabindex="-1"></a>                                              <span class="at">collapse =</span> <span class="st">"|"</span>),</span>
<span id="cb6-8"><a href="#cb6-8" aria-hidden="true" tabindex="-1"></a>                              <span class="at">DivDiv_Links =</span> <span class="fu">paste</span>(<span class="fu">unique</span>(link),</span>
<span id="cb6-9"><a href="#cb6-9" aria-hidden="true" tabindex="-1"></a>                                              <span class="at">collapse =</span> <span class="st">"|"</span>),</span>
<span id="cb6-10"><a href="#cb6-10" aria-hidden="true" tabindex="-1"></a>                              <span class="at">Metadata_Curator =</span> <span class="fu">first</span>(Metadata_Curator),</span>
<span id="cb6-11"><a href="#cb6-11" aria-hidden="true" tabindex="-1"></a>                              <span class="at">Relevant =</span> <span class="fu">first</span>(Relevant),</span>
<span id="cb6-12"><a href="#cb6-12" aria-hidden="true" tabindex="-1"></a>                              <span class="at">Relevance_Comments =</span> <span class="fu">first</span>(Relevance_Comments),</span>
<span id="cb6-13"><a href="#cb6-13" aria-hidden="true" tabindex="-1"></a>                              <span class="at">Paper_Available =</span> <span class="fu">first</span>(Paper_Available),</span>
<span id="cb6-14"><a href="#cb6-14" aria-hidden="true" tabindex="-1"></a>                              <span class="at">Paper_Comments =</span> <span class="fu">paste</span>(<span class="fu">unique</span>(Comments_about_spatial_data_location),</span>
<span id="cb6-15"><a href="#cb6-15" aria-hidden="true" tabindex="-1"></a>                                              <span class="at">collapse =</span> <span class="st">"|"</span>),</span>
<span id="cb6-16"><a href="#cb6-16" aria-hidden="true" tabindex="-1"></a>                              <span class="at">Paper_Link =</span> <span class="fu">paste</span>(<span class="fu">unique</span>(link_to_published_paper),</span>
<span id="cb6-17"><a href="#cb6-17" aria-hidden="true" tabindex="-1"></a>                                              <span class="at">collapse =</span> <span class="st">"|"</span>),</span>
<span id="cb6-18"><a href="#cb6-18" aria-hidden="true" tabindex="-1"></a>                              <span class="at">Authors_Contacted =</span> <span class="fu">first</span>(Authors_Contacted),</span>
<span id="cb6-19"><a href="#cb6-19" aria-hidden="true" tabindex="-1"></a>                              <span class="at">Who_Will_Contact =</span> <span class="fu">first</span>(Who_Will_Contact),</span>
<span id="cb6-20"><a href="#cb6-20" aria-hidden="true" tabindex="-1"></a>                              <span class="at">Email_Date =</span> <span class="fu">first</span>(Email_Date),</span>
<span id="cb6-21"><a href="#cb6-21" aria-hidden="true" tabindex="-1"></a>                              <span class="at">Author_Contact_Comments =</span> <span class="fu">first</span>(Author_Contact_Comments),</span>
<span id="cb6-22"><a href="#cb6-22" aria-hidden="true" tabindex="-1"></a>                              <span class="at">Metadata_Gathered =</span> <span class="fu">first</span>(Metadata_Gathered),</span>
<span id="cb6-23"><a href="#cb6-23" aria-hidden="true" tabindex="-1"></a>                              <span class="at">Metadata_Gathered_Comments =</span> <span class="fu">first</span>(Metadata_Gathered_Comments),</span>
<span id="cb6-24"><a href="#cb6-24" aria-hidden="true" tabindex="-1"></a>                              <span class="at">Metadata_Entered =</span> <span class="fu">first</span>(Metadata_Entered),</span>
<span id="cb6-25"><a href="#cb6-25" aria-hidden="true" tabindex="-1"></a>                              <span class="at">Metadata_Entered_Comments =</span> <span class="fu">first</span>(Metadata_Entered_Comments),</span>
<span id="cb6-26"><a href="#cb6-26" aria-hidden="true" tabindex="-1"></a>                              <span class="at">Validated =</span> <span class="fu">first</span>(Validated),</span>
<span id="cb6-27"><a href="#cb6-27" aria-hidden="true" tabindex="-1"></a>                              <span class="at">Validation_Comments =</span> <span class="fu">first</span>(Validation_Comments),</span>
<span id="cb6-28"><a href="#cb6-28" aria-hidden="true" tabindex="-1"></a>                              <span class="at">Total_Minutes_Spent =</span> <span class="fu">first</span>(Total_Minutes_Spent),</span>
<span id="cb6-29"><a href="#cb6-29" aria-hidden="true" tabindex="-1"></a>                              <span class="at">Quality_Controlled =</span> <span class="fu">first</span>(Quality_Controlled),</span>
<span id="cb6-30"><a href="#cb6-30" aria-hidden="true" tabindex="-1"></a>                              <span class="at">Quality_Controller =</span> <span class="fu">first</span>(Quality_Controller),</span>
<span id="cb6-31"><a href="#cb6-31" aria-hidden="true" tabindex="-1"></a>                              <span class="at">Quality_Control_Comments =</span> <span class="fu">first</span>(Quality_Control_Comments),</span>
<span id="cb6-32"><a href="#cb6-32" aria-hidden="true" tabindex="-1"></a>                              <span class="at">project_target_scope_bioprj =</span> <span class="fu">first</span>(project_target_scope_bioprj),</span>
<span id="cb6-33"><a href="#cb6-33" aria-hidden="true" tabindex="-1"></a>                              <span class="at">project_target_capture_bioprj =</span> <span class="fu">first</span>(project_target_capture_bioprj),</span>
<span id="cb6-34"><a href="#cb6-34" aria-hidden="true" tabindex="-1"></a>                              <span class="at">registration_date_bioprj =</span> <span class="fu">first</span>(registration_date_bioprj),</span>
<span id="cb6-35"><a href="#cb6-35" aria-hidden="true" tabindex="-1"></a>                              <span class="at">project_name_bioprj =</span> <span class="fu">first</span>(project_name_bioprj),</span>
<span id="cb6-36"><a href="#cb6-36" aria-hidden="true" tabindex="-1"></a>                              <span class="at">project_title_bioprj =</span> <span class="fu">first</span>(project_title_bioprj),</span>
<span id="cb6-37"><a href="#cb6-37" aria-hidden="true" tabindex="-1"></a>                              <span class="at">project_description_bioprj =</span> <span class="fu">first</span>(project_description_bioprj),</span>
<span id="cb6-38"><a href="#cb6-38" aria-hidden="true" tabindex="-1"></a>                              <span class="at">relevance_environmental_bioprj =</span> <span class="fu">first</span>(relevance_environmental_bioprj),</span>
<span id="cb6-39"><a href="#cb6-39" aria-hidden="true" tabindex="-1"></a>                              <span class="at">relevance_evolution_bioprj =</span> <span class="fu">first</span>(relevance_evolution_bioprj),</span>
<span id="cb6-40"><a href="#cb6-40" aria-hidden="true" tabindex="-1"></a>                              <span class="at">sequencing_status_bioprj =</span> <span class="fu">first</span>(sequencing_status_bioprj),</span>
<span id="cb6-41"><a href="#cb6-41" aria-hidden="true" tabindex="-1"></a>                              <span class="at">supergroup_bioprj =</span> <span class="fu">first</span>(supergroup_bioprj),</span>
<span id="cb6-42"><a href="#cb6-42" aria-hidden="true" tabindex="-1"></a>                              <span class="at">lab_name_sra_all =</span> <span class="fu">paste</span>(<span class="fu">unique</span>(lab_name_sra),</span>
<span id="cb6-43"><a href="#cb6-43" aria-hidden="true" tabindex="-1"></a>                                                              <span class="at">collapse =</span> <span class="st">"|"</span>),</span>
<span id="cb6-44"><a href="#cb6-44" aria-hidden="true" tabindex="-1"></a>                              <span class="at">contact_name_sra_all =</span> <span class="fu">paste</span>(<span class="fu">unique</span>(contact_name_sra),</span>
<span id="cb6-45"><a href="#cb6-45" aria-hidden="true" tabindex="-1"></a>                                                              <span class="at">collapse =</span> <span class="st">"|"</span>),</span>
<span id="cb6-46"><a href="#cb6-46" aria-hidden="true" tabindex="-1"></a>                              <span class="at">center_name_sra_all =</span> <span class="fu">paste</span>(<span class="fu">unique</span>(center_name_sra ),</span>
<span id="cb6-47"><a href="#cb6-47" aria-hidden="true" tabindex="-1"></a>                                                              <span class="at">collapse =</span> <span class="st">"|"</span>),</span>
<span id="cb6-48"><a href="#cb6-48" aria-hidden="true" tabindex="-1"></a>                              <span class="at">read_type_sra_all =</span> <span class="fu">paste</span>(<span class="fu">unique</span>(read_type_sra ),</span>
<span id="cb6-49"><a href="#cb6-49" aria-hidden="true" tabindex="-1"></a>                                                              <span class="at">collapse =</span> <span class="st">"|"</span>),</span>
<span id="cb6-50"><a href="#cb6-50" aria-hidden="true" tabindex="-1"></a>                              <span class="at">library_selection_sra_all =</span> <span class="fu">paste</span>(<span class="fu">unique</span>(library_selection_sra ),</span>
<span id="cb6-51"><a href="#cb6-51" aria-hidden="true" tabindex="-1"></a>                                                              <span class="at">collapse =</span> <span class="st">"|"</span>),</span>
<span id="cb6-52"><a href="#cb6-52" aria-hidden="true" tabindex="-1"></a>                              <span class="at">library_names =</span> <span class="fu">paste</span>(<span class="fu">unique</span>(library_name),</span>
<span id="cb6-53"><a href="#cb6-53" aria-hidden="true" tabindex="-1"></a>                                                              <span class="at">collapse =</span> <span class="st">"|"</span>),</span>
<span id="cb6-54"><a href="#cb6-54" aria-hidden="true" tabindex="-1"></a>                              <span class="at">experiment_acc_sra =</span> <span class="fu">first</span>(experiment_acc_sra),</span>
<span id="cb6-55"><a href="#cb6-55" aria-hidden="true" tabindex="-1"></a>                              <span class="at">sample_acc_sra =</span> <span class="fu">first</span>(sample_acc_sra),</span>
<span id="cb6-56"><a href="#cb6-56" aria-hidden="true" tabindex="-1"></a>                              <span class="at">study_acc_sra =</span> <span class="fu">first</span>(study_acc_sra),</span>
<span id="cb6-57"><a href="#cb6-57" aria-hidden="true" tabindex="-1"></a>                              <span class="at">library_strat_sra_all =</span> <span class="fu">paste</span>(<span class="fu">unique</span>(library_strat_sra ),</span>
<span id="cb6-58"><a href="#cb6-58" aria-hidden="true" tabindex="-1"></a>                                                              <span class="at">collapse =</span> <span class="st">"|"</span>),</span>
<span id="cb6-59"><a href="#cb6-59" aria-hidden="true" tabindex="-1"></a>                              <span class="at">total_number_reads_sra_sum =</span> <span class="fu">sum</span>(total_number_reads_sra),</span>
<span id="cb6-60"><a href="#cb6-60" aria-hidden="true" tabindex="-1"></a>                              <span class="at">total_number_base_pairs_sra_sum =</span> <span class="fu">sum</span>(total_number_base_pairs_sra),</span>
<span id="cb6-61"><a href="#cb6-61" aria-hidden="true" tabindex="-1"></a>                              <span class="at">organization_biosamp_all =</span> <span class="fu">paste</span>(<span class="fu">unique</span>(organization_biosamp ),</span>
<span id="cb6-62"><a href="#cb6-62" aria-hidden="true" tabindex="-1"></a>                                                              <span class="at">collapse =</span> <span class="st">"|"</span>),</span>
<span id="cb6-63"><a href="#cb6-63" aria-hidden="true" tabindex="-1"></a>                              <span class="at">collectors_info_biosamp_all =</span> <span class="fu">paste</span>(<span class="fu">unique</span>(collectors_info_biosamp),</span>
<span id="cb6-64"><a href="#cb6-64" aria-hidden="true" tabindex="-1"></a>                                                              <span class="at">collapse =</span> <span class="st">"|"</span>),</span>
<span id="cb6-65"><a href="#cb6-65" aria-hidden="true" tabindex="-1"></a>                              <span class="at">contact_first_name_biosamp_all =</span> <span class="fu">paste</span>(<span class="fu">unique</span>(contact_first_name_biosamp),</span>
<span id="cb6-66"><a href="#cb6-66" aria-hidden="true" tabindex="-1"></a>                                                              <span class="at">collapse =</span> <span class="st">"|"</span>),</span>
<span id="cb6-67"><a href="#cb6-67" aria-hidden="true" tabindex="-1"></a>                              <span class="at">contact_last_name_biosamp_all =</span> <span class="fu">paste</span>(<span class="fu">unique</span>(contact_last_name_biosamp),</span>
<span id="cb6-68"><a href="#cb6-68" aria-hidden="true" tabindex="-1"></a>                                                              <span class="at">collapse =</span> <span class="st">"|"</span>),</span>
<span id="cb6-69"><a href="#cb6-69" aria-hidden="true" tabindex="-1"></a>                              <span class="at">contact_email_biosamp_all =</span> <span class="fu">paste</span>(<span class="fu">unique</span>(contact_email_biosamp),</span>
<span id="cb6-70"><a href="#cb6-70" aria-hidden="true" tabindex="-1"></a>                                                              <span class="at">collapse =</span> <span class="st">"|"</span>),</span>
<span id="cb6-71"><a href="#cb6-71" aria-hidden="true" tabindex="-1"></a>                              <span class="at">package_biosamp_all =</span> <span class="fu">paste</span>(<span class="fu">unique</span>(package_biosamp),</span>
<span id="cb6-72"><a href="#cb6-72" aria-hidden="true" tabindex="-1"></a>                                                              <span class="at">collapse =</span> <span class="st">"|"</span>),</span>
<span id="cb6-73"><a href="#cb6-73" aria-hidden="true" tabindex="-1"></a>                              <span class="at">division_taxonomy_all =</span> <span class="fu">paste</span>(<span class="fu">unique</span>(division_taxonomy),</span>
<span id="cb6-74"><a href="#cb6-74" aria-hidden="true" tabindex="-1"></a>                                                              <span class="at">collapse =</span> <span class="st">"|"</span>),</span>
<span id="cb6-75"><a href="#cb6-75" aria-hidden="true" tabindex="-1"></a>                              <span class="at">publication_ID_bioprj =</span> <span class="fu">first</span>(publication_ID_bioprj),</span>
<span id="cb6-76"><a href="#cb6-76" aria-hidden="true" tabindex="-1"></a>                              <span class="at">publication_firstauthor_bioprj =</span> <span class="fu">first</span>(publication_firstauthor_bioprj),</span>
<span id="cb6-77"><a href="#cb6-77" aria-hidden="true" tabindex="-1"></a>                              <span class="at">publication_title_bioprj =</span> <span class="fu">first</span>(publication_title_bioprj),</span>
<span id="cb6-78"><a href="#cb6-78" aria-hidden="true" tabindex="-1"></a>                              <span class="at">publication_journalname_bioprj =</span> <span class="fu">first</span>(publication_journalname_bioprj),</span>
<span id="cb6-79"><a href="#cb6-79" aria-hidden="true" tabindex="-1"></a>                              <span class="at">publication_year_bioprj =</span> <span class="fu">first</span>(publication_year_bioprj),</span>
<span id="cb6-80"><a href="#cb6-80" aria-hidden="true" tabindex="-1"></a>                              <span class="at">publication_volume_bioprj =</span> <span class="fu">first</span>(publication_volume_bioprj),</span>
<span id="cb6-81"><a href="#cb6-81" aria-hidden="true" tabindex="-1"></a>                              <span class="at">publication_issue_bioprj =</span> <span class="fu">first</span>(publication_issue_bioprj),</span>
<span id="cb6-82"><a href="#cb6-82" aria-hidden="true" tabindex="-1"></a>                              <span class="at">DOI_pubmed =</span> <span class="fu">first</span>(DOI_pubmed),</span>
<span id="cb6-83"><a href="#cb6-83" aria-hidden="true" tabindex="-1"></a>                              <span class="at">uid_pubmed =</span> <span class="fu">first</span>(uid_pubmed),</span>
<span id="cb6-84"><a href="#cb6-84" aria-hidden="true" tabindex="-1"></a>                              <span class="at">pubdate_pubmed =</span> <span class="fu">first</span>(pubdate_pubmed),</span>
<span id="cb6-85"><a href="#cb6-85" aria-hidden="true" tabindex="-1"></a>                              <span class="at">epubdate_pubmed =</span> <span class="fu">first</span>(epubdate_pubmed),</span>
<span id="cb6-86"><a href="#cb6-86" aria-hidden="true" tabindex="-1"></a>                              <span class="at">source_pubmed =</span> <span class="fu">first</span>(source_pubmed),</span>
<span id="cb6-87"><a href="#cb6-87" aria-hidden="true" tabindex="-1"></a>                              <span class="at">lastauthor_pubmed =</span> <span class="fu">first</span>(lastauthor_pubmed),</span>
<span id="cb6-88"><a href="#cb6-88" aria-hidden="true" tabindex="-1"></a>                              <span class="at">title_pubmed =</span> <span class="fu">first</span>(title_pubmed),</span>
<span id="cb6-89"><a href="#cb6-89" aria-hidden="true" tabindex="-1"></a>                              <span class="at">sorttitle_pubmed =</span> <span class="fu">first</span>(sorttitle_pubmed),</span>
<span id="cb6-90"><a href="#cb6-90" aria-hidden="true" tabindex="-1"></a>                              <span class="at">volume_pubmed =</span> <span class="fu">first</span>(volume_pubmed),</span>
<span id="cb6-91"><a href="#cb6-91" aria-hidden="true" tabindex="-1"></a>                              <span class="at">issue_pubmed =</span> <span class="fu">first</span>(issue_pubmed),</span>
<span id="cb6-92"><a href="#cb6-92" aria-hidden="true" tabindex="-1"></a>                              <span class="at">pages_pubmed =</span> <span class="fu">first</span>(pages_pubmed),</span>
<span id="cb6-93"><a href="#cb6-93" aria-hidden="true" tabindex="-1"></a>                              <span class="at">lang_pubmed =</span> <span class="fu">first</span>(lang_pubmed),</span>
<span id="cb6-94"><a href="#cb6-94" aria-hidden="true" tabindex="-1"></a>                              <span class="at">nlmuniqueid_pubmed =</span> <span class="fu">first</span>(nlmuniqueid_pubmed),</span>
<span id="cb6-95"><a href="#cb6-95" aria-hidden="true" tabindex="-1"></a>                              <span class="at">issn_pubmed =</span> <span class="fu">first</span>(issn_pubmed),</span>
<span id="cb6-96"><a href="#cb6-96" aria-hidden="true" tabindex="-1"></a>                              <span class="at">essn_pubmed =</span> <span class="fu">first</span>(essn_pubmed),</span>
<span id="cb6-97"><a href="#cb6-97" aria-hidden="true" tabindex="-1"></a>                              <span class="at">pubtype_pubmed =</span> <span class="fu">first</span>(pubtype_pubmed),</span>
<span id="cb6-98"><a href="#cb6-98" aria-hidden="true" tabindex="-1"></a>                              <span class="at">recordstatus_pubmed =</span> <span class="fu">first</span>(recordstatus_pubmed),</span>
<span id="cb6-99"><a href="#cb6-99" aria-hidden="true" tabindex="-1"></a>                              <span class="at">pubstatus_pubmed =</span> <span class="fu">first</span>(pubstatus_pubmed),</span>
<span id="cb6-100"><a href="#cb6-100" aria-hidden="true" tabindex="-1"></a>                              <span class="at">fulljournalname_pubmed =</span> <span class="fu">first</span>(fulljournalname_pubmed),</span>
<span id="cb6-101"><a href="#cb6-101" aria-hidden="true" tabindex="-1"></a>                              <span class="at">elocationid_pubmed =</span> <span class="fu">first</span>(elocationid_pubmed),</span>
<span id="cb6-102"><a href="#cb6-102" aria-hidden="true" tabindex="-1"></a>                              <span class="at">availablefromurl_pubmed =</span> <span class="fu">first</span>(availablefromurl_pubmed)</span>
<span id="cb6-103"><a href="#cb6-103" aria-hidden="true" tabindex="-1"></a>                              ) </span>
<span id="cb6-104"><a href="#cb6-104" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb6-105"><a href="#cb6-105" aria-hidden="true" tabindex="-1"></a>Marine_BioProjects <span class="ot">&lt;-</span> <span class="fu">add_column</span>(Marine_BioProjects,<span class="at">.before =</span> <span class="st">"project_acc_bioprj"</span>,</span>
<span id="cb6-106"><a href="#cb6-106" aria-hidden="true" tabindex="-1"></a>                                 <span class="at">project_index =</span> <span class="fu">paste0</span>(<span class="st">"M"</span>,<span class="fu">str_pad</span>(<span class="fu">row.names</span>(Marine_BioProjects),</span>
<span id="cb6-107"><a href="#cb6-107" aria-hidden="true" tabindex="-1"></a>                                                                    <span class="at">width=</span><span class="dv">4</span>,<span class="at">pad=</span><span class="st">"0"</span>)))</span>
<span id="cb6-108"><a href="#cb6-108" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb6-109"><a href="#cb6-109" aria-hidden="true" tabindex="-1"></a>nonMarine_BioProjects <span class="ot">&lt;-</span> <span class="fu">group_by</span>(nonmarinelist, project_acc_bioprj) <span class="sc">%&gt;%</span> </span>
<span id="cb6-110"><a href="#cb6-110" aria-hidden="true" tabindex="-1"></a>                    <span class="fu">summarize</span>(</span>
<span id="cb6-111"><a href="#cb6-111" aria-hidden="true" tabindex="-1"></a>                              <span class="at">BioSamples =</span> <span class="fu">n_distinct</span>(biosample_acc_sra),</span>
<span id="cb6-112"><a href="#cb6-112" aria-hidden="true" tabindex="-1"></a>                              <span class="at">Runs =</span> <span class="fu">n_distinct</span>(run_acc_sra),</span>
<span id="cb6-113"><a href="#cb6-113" aria-hidden="true" tabindex="-1"></a>                              <span class="at">N_Species =</span> <span class="fu">n_distinct</span>(organism_biosamp),</span>
<span id="cb6-114"><a href="#cb6-114" aria-hidden="true" tabindex="-1"></a>                              <span class="at">Species_all =</span> <span class="fu">paste</span>(<span class="fu">unique</span>(organism_biosamp),</span>
<span id="cb6-115"><a href="#cb6-115" aria-hidden="true" tabindex="-1"></a>                                              <span class="at">collapse =</span> <span class="st">"|"</span>),</span>
<span id="cb6-116"><a href="#cb6-116" aria-hidden="true" tabindex="-1"></a>                              <span class="at">DivDiv_Links =</span> <span class="fu">paste</span>(<span class="fu">unique</span>(link),</span>
<span id="cb6-117"><a href="#cb6-117" aria-hidden="true" tabindex="-1"></a>                                              <span class="at">collapse =</span> <span class="st">";"</span>),</span>
<span id="cb6-118"><a href="#cb6-118" aria-hidden="true" tabindex="-1"></a>                              <span class="at">project_target_scope_bioprj =</span> <span class="fu">first</span>(project_target_scope_bioprj),</span>
<span id="cb6-119"><a href="#cb6-119" aria-hidden="true" tabindex="-1"></a>                              <span class="at">project_target_capture_bioprj =</span> <span class="fu">first</span>(project_target_capture_bioprj),</span>
<span id="cb6-120"><a href="#cb6-120" aria-hidden="true" tabindex="-1"></a>                              <span class="at">registration_date_bioprj =</span> <span class="fu">first</span>(registration_date_bioprj),</span>
<span id="cb6-121"><a href="#cb6-121" aria-hidden="true" tabindex="-1"></a>                              <span class="at">project_name_bioprj =</span> <span class="fu">first</span>(project_name_bioprj),</span>
<span id="cb6-122"><a href="#cb6-122" aria-hidden="true" tabindex="-1"></a>                              <span class="at">project_title_bioprj =</span> <span class="fu">first</span>(project_title_bioprj),</span>
<span id="cb6-123"><a href="#cb6-123" aria-hidden="true" tabindex="-1"></a>                              <span class="at">project_description_bioprj =</span> <span class="fu">first</span>(project_description_bioprj),</span>
<span id="cb6-124"><a href="#cb6-124" aria-hidden="true" tabindex="-1"></a>                              <span class="at">relevance_environmental_bioprj =</span> <span class="fu">first</span>(relevance_environmental_bioprj),</span>
<span id="cb6-125"><a href="#cb6-125" aria-hidden="true" tabindex="-1"></a>                              <span class="at">relevance_evolution_bioprj =</span> <span class="fu">first</span>(relevance_evolution_bioprj),</span>
<span id="cb6-126"><a href="#cb6-126" aria-hidden="true" tabindex="-1"></a>                              <span class="at">sequencing_status_bioprj =</span> <span class="fu">first</span>(sequencing_status_bioprj),</span>
<span id="cb6-127"><a href="#cb6-127" aria-hidden="true" tabindex="-1"></a>                              <span class="at">supergroup_bioprj =</span> <span class="fu">first</span>(supergroup_bioprj),</span>
<span id="cb6-128"><a href="#cb6-128" aria-hidden="true" tabindex="-1"></a>                              <span class="at">lab_name_sra_all =</span> <span class="fu">paste</span>(<span class="fu">unique</span>(lab_name_sra),</span>
<span id="cb6-129"><a href="#cb6-129" aria-hidden="true" tabindex="-1"></a>                                                              <span class="at">collapse =</span> <span class="st">"|"</span>),</span>
<span id="cb6-130"><a href="#cb6-130" aria-hidden="true" tabindex="-1"></a>                              <span class="at">contact_name_sra_all =</span> <span class="fu">paste</span>(<span class="fu">unique</span>(contact_name_sra),</span>
<span id="cb6-131"><a href="#cb6-131" aria-hidden="true" tabindex="-1"></a>                                                              <span class="at">collapse =</span> <span class="st">"|"</span>),</span>
<span id="cb6-132"><a href="#cb6-132" aria-hidden="true" tabindex="-1"></a>                              <span class="at">center_name_sra_all =</span> <span class="fu">paste</span>(<span class="fu">unique</span>(center_name_sra ),</span>
<span id="cb6-133"><a href="#cb6-133" aria-hidden="true" tabindex="-1"></a>                                                              <span class="at">collapse =</span> <span class="st">"|"</span>),</span>
<span id="cb6-134"><a href="#cb6-134" aria-hidden="true" tabindex="-1"></a>                              <span class="at">read_type_sra_all =</span> <span class="fu">paste</span>(<span class="fu">unique</span>(read_type_sra ),</span>
<span id="cb6-135"><a href="#cb6-135" aria-hidden="true" tabindex="-1"></a>                                                              <span class="at">collapse =</span> <span class="st">"|"</span>),</span>
<span id="cb6-136"><a href="#cb6-136" aria-hidden="true" tabindex="-1"></a>                              <span class="at">library_selection_sra_all =</span> <span class="fu">paste</span>(<span class="fu">unique</span>(library_selection_sra ),</span>
<span id="cb6-137"><a href="#cb6-137" aria-hidden="true" tabindex="-1"></a>                                                              <span class="at">collapse =</span> <span class="st">"|"</span>),</span>
<span id="cb6-138"><a href="#cb6-138" aria-hidden="true" tabindex="-1"></a>                              <span class="at">library_names =</span> <span class="fu">paste</span>(<span class="fu">unique</span>(library_name),</span>
<span id="cb6-139"><a href="#cb6-139" aria-hidden="true" tabindex="-1"></a>                                                              <span class="at">collapse =</span> <span class="st">"|"</span>),</span>
<span id="cb6-140"><a href="#cb6-140" aria-hidden="true" tabindex="-1"></a>                              <span class="at">experiment_acc_sra =</span> <span class="fu">first</span>(experiment_acc_sra),</span>
<span id="cb6-141"><a href="#cb6-141" aria-hidden="true" tabindex="-1"></a>                              <span class="at">sample_acc_sra =</span> <span class="fu">first</span>(sample_acc_sra),</span>
<span id="cb6-142"><a href="#cb6-142" aria-hidden="true" tabindex="-1"></a>                              <span class="at">study_acc_sra =</span> <span class="fu">first</span>(study_acc_sra),</span>
<span id="cb6-143"><a href="#cb6-143" aria-hidden="true" tabindex="-1"></a>                              <span class="at">library_strat_sra_all =</span> <span class="fu">paste</span>(<span class="fu">unique</span>(library_strat_sra ),</span>
<span id="cb6-144"><a href="#cb6-144" aria-hidden="true" tabindex="-1"></a>                                                              <span class="at">collapse =</span> <span class="st">"|"</span>),</span>
<span id="cb6-145"><a href="#cb6-145" aria-hidden="true" tabindex="-1"></a>                              <span class="at">total_number_reads_sra_sum =</span> <span class="fu">sum</span>(total_number_reads_sra),</span>
<span id="cb6-146"><a href="#cb6-146" aria-hidden="true" tabindex="-1"></a>                              <span class="at">total_number_base_pairs_sra_sum =</span> <span class="fu">sum</span>(total_number_base_pairs_sra),</span>
<span id="cb6-147"><a href="#cb6-147" aria-hidden="true" tabindex="-1"></a>                              <span class="at">organization_biosamp_all =</span> <span class="fu">paste</span>(<span class="fu">unique</span>(organization_biosamp ),</span>
<span id="cb6-148"><a href="#cb6-148" aria-hidden="true" tabindex="-1"></a>                                                              <span class="at">collapse =</span> <span class="st">"|"</span>),</span>
<span id="cb6-149"><a href="#cb6-149" aria-hidden="true" tabindex="-1"></a>                              <span class="at">collectors_info_biosamp_all =</span> <span class="fu">paste</span>(<span class="fu">unique</span>(collectors_info_biosamp),</span>
<span id="cb6-150"><a href="#cb6-150" aria-hidden="true" tabindex="-1"></a>                                                              <span class="at">collapse =</span> <span class="st">"|"</span>),</span>
<span id="cb6-151"><a href="#cb6-151" aria-hidden="true" tabindex="-1"></a>                              <span class="at">contact_first_name_biosamp_all =</span> <span class="fu">paste</span>(<span class="fu">unique</span>(contact_first_name_biosamp),</span>
<span id="cb6-152"><a href="#cb6-152" aria-hidden="true" tabindex="-1"></a>                                                              <span class="at">collapse =</span> <span class="st">"|"</span>),</span>
<span id="cb6-153"><a href="#cb6-153" aria-hidden="true" tabindex="-1"></a>                              <span class="at">contact_last_name_biosamp_all =</span> <span class="fu">paste</span>(<span class="fu">unique</span>(contact_last_name_biosamp),</span>
<span id="cb6-154"><a href="#cb6-154" aria-hidden="true" tabindex="-1"></a>                                                              <span class="at">collapse =</span> <span class="st">"|"</span>),</span>
<span id="cb6-155"><a href="#cb6-155" aria-hidden="true" tabindex="-1"></a>                              <span class="at">contact_email_biosamp_all =</span> <span class="fu">paste</span>(<span class="fu">unique</span>(contact_email_biosamp),</span>
<span id="cb6-156"><a href="#cb6-156" aria-hidden="true" tabindex="-1"></a>                                                              <span class="at">collapse =</span> <span class="st">"|"</span>),</span>
<span id="cb6-157"><a href="#cb6-157" aria-hidden="true" tabindex="-1"></a>                              <span class="at">package_biosamp_all =</span> <span class="fu">paste</span>(<span class="fu">unique</span>(package_biosamp),</span>
<span id="cb6-158"><a href="#cb6-158" aria-hidden="true" tabindex="-1"></a>                                                              <span class="at">collapse =</span> <span class="st">"|"</span>),</span>
<span id="cb6-159"><a href="#cb6-159" aria-hidden="true" tabindex="-1"></a>                              <span class="at">division_taxonomy_all =</span> <span class="fu">paste</span>(<span class="fu">unique</span>(division_taxonomy),</span>
<span id="cb6-160"><a href="#cb6-160" aria-hidden="true" tabindex="-1"></a>                                                              <span class="at">collapse =</span> <span class="st">"|"</span>),</span>
<span id="cb6-161"><a href="#cb6-161" aria-hidden="true" tabindex="-1"></a>                              <span class="at">publication_ID_bioprj =</span> <span class="fu">first</span>(publication_ID_bioprj),</span>
<span id="cb6-162"><a href="#cb6-162" aria-hidden="true" tabindex="-1"></a>                              <span class="at">publication_firstauthor_bioprj =</span> <span class="fu">first</span>(publication_firstauthor_bioprj),</span>
<span id="cb6-163"><a href="#cb6-163" aria-hidden="true" tabindex="-1"></a>                              <span class="at">publication_title_bioprj =</span> <span class="fu">first</span>(publication_title_bioprj),</span>
<span id="cb6-164"><a href="#cb6-164" aria-hidden="true" tabindex="-1"></a>                              <span class="at">publication_journalname_bioprj =</span> <span class="fu">first</span>(publication_journalname_bioprj),</span>
<span id="cb6-165"><a href="#cb6-165" aria-hidden="true" tabindex="-1"></a>                              <span class="at">publication_year_bioprj =</span> <span class="fu">first</span>(publication_year_bioprj),</span>
<span id="cb6-166"><a href="#cb6-166" aria-hidden="true" tabindex="-1"></a>                              <span class="at">publication_volume_bioprj =</span> <span class="fu">first</span>(publication_volume_bioprj),</span>
<span id="cb6-167"><a href="#cb6-167" aria-hidden="true" tabindex="-1"></a>                              <span class="at">publication_issue_bioprj =</span> <span class="fu">first</span>(publication_issue_bioprj),</span>
<span id="cb6-168"><a href="#cb6-168" aria-hidden="true" tabindex="-1"></a>                              <span class="at">DOI_pubmed =</span> <span class="fu">first</span>(DOI_pubmed),</span>
<span id="cb6-169"><a href="#cb6-169" aria-hidden="true" tabindex="-1"></a>                              <span class="at">uid_pubmed =</span> <span class="fu">first</span>(uid_pubmed),</span>
<span id="cb6-170"><a href="#cb6-170" aria-hidden="true" tabindex="-1"></a>                              <span class="at">pubdate_pubmed =</span> <span class="fu">first</span>(pubdate_pubmed),</span>
<span id="cb6-171"><a href="#cb6-171" aria-hidden="true" tabindex="-1"></a>                              <span class="at">epubdate_pubmed =</span> <span class="fu">first</span>(epubdate_pubmed),</span>
<span id="cb6-172"><a href="#cb6-172" aria-hidden="true" tabindex="-1"></a>                              <span class="at">source_pubmed =</span> <span class="fu">first</span>(source_pubmed),</span>
<span id="cb6-173"><a href="#cb6-173" aria-hidden="true" tabindex="-1"></a>                              <span class="at">lastauthor_pubmed =</span> <span class="fu">first</span>(lastauthor_pubmed),</span>
<span id="cb6-174"><a href="#cb6-174" aria-hidden="true" tabindex="-1"></a>                              <span class="at">title_pubmed =</span> <span class="fu">first</span>(title_pubmed),</span>
<span id="cb6-175"><a href="#cb6-175" aria-hidden="true" tabindex="-1"></a>                              <span class="at">sorttitle_pubmed =</span> <span class="fu">first</span>(sorttitle_pubmed),</span>
<span id="cb6-176"><a href="#cb6-176" aria-hidden="true" tabindex="-1"></a>                              <span class="at">volume_pubmed =</span> <span class="fu">first</span>(volume_pubmed),</span>
<span id="cb6-177"><a href="#cb6-177" aria-hidden="true" tabindex="-1"></a>                              <span class="at">issue_pubmed =</span> <span class="fu">first</span>(issue_pubmed),</span>
<span id="cb6-178"><a href="#cb6-178" aria-hidden="true" tabindex="-1"></a>                              <span class="at">pages_pubmed =</span> <span class="fu">first</span>(pages_pubmed),</span>
<span id="cb6-179"><a href="#cb6-179" aria-hidden="true" tabindex="-1"></a>                              <span class="at">lang_pubmed =</span> <span class="fu">first</span>(lang_pubmed),</span>
<span id="cb6-180"><a href="#cb6-180" aria-hidden="true" tabindex="-1"></a>                              <span class="at">nlmuniqueid_pubmed =</span> <span class="fu">first</span>(nlmuniqueid_pubmed),</span>
<span id="cb6-181"><a href="#cb6-181" aria-hidden="true" tabindex="-1"></a>                              <span class="at">issn_pubmed =</span> <span class="fu">first</span>(issn_pubmed),</span>
<span id="cb6-182"><a href="#cb6-182" aria-hidden="true" tabindex="-1"></a>                              <span class="at">essn_pubmed =</span> <span class="fu">first</span>(essn_pubmed),</span>
<span id="cb6-183"><a href="#cb6-183" aria-hidden="true" tabindex="-1"></a>                              <span class="at">pubtype_pubmed =</span> <span class="fu">first</span>(pubtype_pubmed),</span>
<span id="cb6-184"><a href="#cb6-184" aria-hidden="true" tabindex="-1"></a>                              <span class="at">recordstatus_pubmed =</span> <span class="fu">first</span>(recordstatus_pubmed),</span>
<span id="cb6-185"><a href="#cb6-185" aria-hidden="true" tabindex="-1"></a>                              <span class="at">pubstatus_pubmed =</span> <span class="fu">first</span>(pubstatus_pubmed),</span>
<span id="cb6-186"><a href="#cb6-186" aria-hidden="true" tabindex="-1"></a>                              <span class="at">fulljournalname_pubmed =</span> <span class="fu">first</span>(fulljournalname_pubmed),</span>
<span id="cb6-187"><a href="#cb6-187" aria-hidden="true" tabindex="-1"></a>                              <span class="at">elocationid_pubmed =</span> <span class="fu">first</span>(elocationid_pubmed),</span>
<span id="cb6-188"><a href="#cb6-188" aria-hidden="true" tabindex="-1"></a>                              <span class="at">availablefromurl_pubmed =</span> <span class="fu">first</span>(availablefromurl_pubmed)</span>
<span id="cb6-189"><a href="#cb6-189" aria-hidden="true" tabindex="-1"></a>                              )  <span class="sc">%&gt;%</span> <span class="fu">add_column</span>(<span class="at">.after =</span> <span class="st">"Species_all"</span>, </span>
<span id="cb6-190"><a href="#cb6-190" aria-hidden="true" tabindex="-1"></a>                                                     <span class="at">Metadata_Curator =</span> <span class="st">""</span>,     </span>
<span id="cb6-191"><a href="#cb6-191" aria-hidden="true" tabindex="-1"></a>                                                     <span class="at">Relevant =</span> <span class="st">""</span>, </span>
<span id="cb6-192"><a href="#cb6-192" aria-hidden="true" tabindex="-1"></a>                                                     <span class="at">Relevance_Comments =</span> <span class="st">""</span>,</span>
<span id="cb6-193"><a href="#cb6-193" aria-hidden="true" tabindex="-1"></a>                                                     <span class="at">Paper_Available =</span> <span class="st">""</span>,</span>
<span id="cb6-194"><a href="#cb6-194" aria-hidden="true" tabindex="-1"></a>                                                     <span class="at">Paper_Comments =</span> <span class="st">""</span>,</span>
<span id="cb6-195"><a href="#cb6-195" aria-hidden="true" tabindex="-1"></a>                                                     <span class="at">Paper_Link =</span> <span class="st">""</span>,</span>
<span id="cb6-196"><a href="#cb6-196" aria-hidden="true" tabindex="-1"></a>                                                     <span class="at">Authors_Contacted =</span> <span class="st">""</span>,</span>
<span id="cb6-197"><a href="#cb6-197" aria-hidden="true" tabindex="-1"></a>                                                     <span class="at">Who_Will_Contact =</span> <span class="st">""</span>,</span>
<span id="cb6-198"><a href="#cb6-198" aria-hidden="true" tabindex="-1"></a>                                                     <span class="at">Email_Date =</span> <span class="st">""</span>,</span>
<span id="cb6-199"><a href="#cb6-199" aria-hidden="true" tabindex="-1"></a>                                                     <span class="at">Author_Contact_Comments =</span> <span class="st">""</span>,</span>
<span id="cb6-200"><a href="#cb6-200" aria-hidden="true" tabindex="-1"></a>                                                     <span class="at">Metadata_Gathered =</span> <span class="st">""</span>,</span>
<span id="cb6-201"><a href="#cb6-201" aria-hidden="true" tabindex="-1"></a>                                                     <span class="at">Metadata_Gathered_Comments =</span> <span class="st">""</span>,</span>
<span id="cb6-202"><a href="#cb6-202" aria-hidden="true" tabindex="-1"></a>                                                     <span class="at">Metadata_Entered =</span> <span class="st">""</span>,</span>
<span id="cb6-203"><a href="#cb6-203" aria-hidden="true" tabindex="-1"></a>                                                     <span class="at">Metadata_Entered_Comments =</span> <span class="st">""</span>,</span>
<span id="cb6-204"><a href="#cb6-204" aria-hidden="true" tabindex="-1"></a>                                                     <span class="at">Validated =</span> <span class="st">""</span>,</span>
<span id="cb6-205"><a href="#cb6-205" aria-hidden="true" tabindex="-1"></a>                                                     <span class="at">Validation_Comments =</span> <span class="st">""</span>,</span>
<span id="cb6-206"><a href="#cb6-206" aria-hidden="true" tabindex="-1"></a>                                                     <span class="at">Total_Minutes_Spent=</span> <span class="st">""</span>,</span>
<span id="cb6-207"><a href="#cb6-207" aria-hidden="true" tabindex="-1"></a>                                                     <span class="at">Quality_Controlled =</span> <span class="st">"FALSE"</span>,</span>
<span id="cb6-208"><a href="#cb6-208" aria-hidden="true" tabindex="-1"></a>                                                     <span class="at">Quality_Controller =</span> <span class="st">""</span>,</span>
<span id="cb6-209"><a href="#cb6-209" aria-hidden="true" tabindex="-1"></a>                                                     <span class="at">Quality_Control_Comments =</span> <span class="st">""</span></span>
<span id="cb6-210"><a href="#cb6-210" aria-hidden="true" tabindex="-1"></a>                             ) </span>
<span id="cb6-211"><a href="#cb6-211" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb6-212"><a href="#cb6-212" aria-hidden="true" tabindex="-1"></a>nonMarine_BioProjects <span class="ot">&lt;-</span> <span class="fu">add_column</span>(nonMarine_BioProjects,<span class="at">.before =</span> <span class="st">"project_acc_bioprj"</span>,<span class="at">project_index =</span> <span class="fu">paste0</span>(<span class="st">"E"</span>,<span class="fu">str_pad</span>(<span class="fu">row.names</span>(nonMarine_BioProjects),<span class="at">width=</span><span class="dv">4</span>,<span class="at">pad=</span><span class="st">"0"</span>)))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</section>
<section id="write-to-google-sheets" class="level1">
<h1>Write to Google Sheets</h1>
<section id="write-bioproject-summaries" class="level2">
<h2 class="anchored" data-anchor-id="write-bioproject-summaries">Write BioProject Summaries</h2>
<p>I’m going to write these summaries to google sheets, and then manually move them into the working directory for the datathon. Commenting them and turning off eval to ensure they don’t get overwritten.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb7"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb7-1"><a href="#cb7-1" aria-hidden="true" tabindex="-1"></a>Marine_bioproject_sheet <span class="ot">&lt;-</span> <span class="fu">gs4_create</span>(<span class="at">name =</span> <span class="st">"Marine_SRA_BioProjects2"</span>)</span>
<span id="cb7-2"><a href="#cb7-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb7-3"><a href="#cb7-3" aria-hidden="true" tabindex="-1"></a><span class="fu">sheet_write</span>(Marine_BioProjects, <span class="at">ss =</span> Marine_bioproject_sheet)</span>
<span id="cb7-4"><a href="#cb7-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb7-5"><a href="#cb7-5" aria-hidden="true" tabindex="-1"></a>nonMarine_bioproject_sheet <span class="ot">&lt;-</span> <span class="fu">gs4_create</span>(<span class="at">name =</span> <span class="st">"NonMarine_SRA_BioProjects"</span>)</span>
<span id="cb7-6"><a href="#cb7-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb7-7"><a href="#cb7-7" aria-hidden="true" tabindex="-1"></a><span class="fu">sheet_write</span>(nonMarine_BioProjects, <span class="at">ss =</span> nonMarine_bioproject_sheet)</span>
<span id="cb7-8"><a href="#cb7-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb7-9"><a href="#cb7-9" aria-hidden="true" tabindex="-1"></a><span class="fu">write_csv</span>(Marine_BioProjects, <span class="st">"Marine_BioProjects_20200714.csv"</span>)</span>
<span id="cb7-10"><a href="#cb7-10" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb7-11"><a href="#cb7-11" aria-hidden="true" tabindex="-1"></a><span class="fu">write_csv</span>(nonMarine_BioProjects, <span class="st">"nonMarine_BioProjects_20200714.csv"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>After writing these sheets:</p>
<ol type="1">
<li>Move sheets to <code>/GEOME_Datathon/Datathon_Working_Directory/BioProject/Table</code></li>
<li>Protect Columns A:E, X:CA. Color columns in between.</li>
<li>Format <code>email_date</code> as <code>Date</code></li>
<li>Set up validation on Boolean columns</li>
<li>Freeze up to column F</li>
<li>Set up <code>Metadata_Gathered</code>validation: (From Author, From Paper)</li>
</ol>
</section>
<section id="write-biosample-metadata" class="level2">
<h2 class="anchored" data-anchor-id="write-biosample-metadata">Write BioSample metadata</h2>
<p>Now I will loop through all of the BioProjects, using the <code>googledrive</code> package to make a copy of the template googlesheet per BioProject, (itself created from a GEOME template), and fill it with relevant SRA metadata for that BioProject. Found hints about dealing with the Google Sheets API <a href="https://gargle.r-lib.org/articles/get-api-credentials.html">here</a> and <a href="https://github.com/tidyverse/googlesheets4/issues/170">here</a>. Basically, I had to get a Google Cloud Platform <a href="https://console.cloud.google.com">project</a>, and create a project (called GEOME) and then enable the Google Drive and Google Sheets APIs. Then I created a service account and create a key for the service account, which I downloaded as a JSON. I also had to edit grant access to the Datathon project for the service account (took me awhile to figure this one out). Then below, I just load in the key to authorize the service account to write to the folder for me. Information about <code>trycatch()</code> is <a href="https://stringr.tidyverse.org/reference/str_trim.html">here</a></p>
<div class="cell">
<div class="sourceCode cell-code" id="cb8"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb8-1"><a href="#cb8-1" aria-hidden="true" tabindex="-1"></a>workingList <span class="ot">&lt;-</span> nonmarinelist</span>
<span id="cb8-2"><a href="#cb8-2" aria-hidden="true" tabindex="-1"></a>workingBioProjects <span class="ot">&lt;-</span> nonMarine_BioProjects</span>
<span id="cb8-3"><a href="#cb8-3" aria-hidden="true" tabindex="-1"></a>path <span class="ot">&lt;-</span> <span class="st">"GEOME_Datathon/Datathon_Working_Directory/BioProject_Tables/NonMarine_BioSample_Metadata/"</span></span>
<span id="cb8-4"><a href="#cb8-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb8-5"><a href="#cb8-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb8-6"><a href="#cb8-6" aria-hidden="true" tabindex="-1"></a><span class="co">#c(310,318,348)</span></span>
<span id="cb8-7"><a href="#cb8-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb8-8"><a href="#cb8-8" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span>(prj <span class="cf">in</span> workingBioProjects<span class="sc">$</span>project_acc_bioprj[<span class="dv">55</span>]){</span>
<span id="cb8-9"><a href="#cb8-9" aria-hidden="true" tabindex="-1"></a>    <span class="co">#prj &lt;- "PRJNA170681"</span></span>
<span id="cb8-10"><a href="#cb8-10" aria-hidden="true" tabindex="-1"></a>    <span class="co">#prj &lt;- "PRJDB7819" multispecies</span></span>
<span id="cb8-11"><a href="#cb8-11" aria-hidden="true" tabindex="-1"></a>    <span class="co">#prj &lt;- "PRJNA254780" working</span></span>
<span id="cb8-12"><a href="#cb8-12" aria-hidden="true" tabindex="-1"></a>    <span class="co">#prj &lt;- "PRJNA256006" not working</span></span>
<span id="cb8-13"><a href="#cb8-13" aria-hidden="true" tabindex="-1"></a>    <span class="co">#prj &lt;- "PRJNA369456" tricky taxonomy example</span></span>
<span id="cb8-14"><a href="#cb8-14" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb8-15"><a href="#cb8-15" aria-hidden="true" tabindex="-1"></a>    <span class="co">#grab the index</span></span>
<span id="cb8-16"><a href="#cb8-16" aria-hidden="true" tabindex="-1"></a>    index <span class="ot">&lt;-</span> workingBioProjects<span class="sc">$</span>project_index[<span class="fu">which</span>(workingBioProjects<span class="sc">$</span>project_acc_bioprj<span class="sc">==</span>prj)]</span>
<span id="cb8-17"><a href="#cb8-17" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb8-18"><a href="#cb8-18" aria-hidden="true" tabindex="-1"></a>    <span class="co">#prj &lt;- workingBioProjects$project_acc_bioprj[55]</span></span>
<span id="cb8-19"><a href="#cb8-19" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb8-20"><a href="#cb8-20" aria-hidden="true" tabindex="-1"></a>    <span class="fu">print</span>(<span class="fu">paste</span>(<span class="st">"Now Starting"</span>,prj,index,<span class="at">sep=</span><span class="st">" "</span>))</span>
<span id="cb8-21"><a href="#cb8-21" aria-hidden="true" tabindex="-1"></a>    <span class="co">#copy the template to a new file name after the BioProject</span></span>
<span id="cb8-22"><a href="#cb8-22" aria-hidden="true" tabindex="-1"></a>    <span class="fu">print</span>(<span class="st">"Copying Template"</span>)</span>
<span id="cb8-23"><a href="#cb8-23" aria-hidden="true" tabindex="-1"></a>    <span class="fu">drive_cp</span>(<span class="at">file =</span> <span class="st">"GEOME_Datathon/Code/Datathon_BioSample_Template"</span>, <span class="at">path =</span> <span class="fu">paste0</span>(path, index,<span class="st">"_"</span>,prj))</span>
<span id="cb8-24"><a href="#cb8-24" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb8-25"><a href="#cb8-25" aria-hidden="true" tabindex="-1"></a>    <span class="co"># get the `Dribble` (google drive locator) for this new Google sheet</span></span>
<span id="cb8-26"><a href="#cb8-26" aria-hidden="true" tabindex="-1"></a>    gdprj <span class="ot">&lt;-</span> <span class="fu">drive_get</span>(<span class="at">path =</span> <span class="fu">paste0</span>(path, index,<span class="st">"_"</span>,prj))</span>
<span id="cb8-27"><a href="#cb8-27" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb8-28"><a href="#cb8-28" aria-hidden="true" tabindex="-1"></a>    <span class="co"># grab the various SRA accession IDs and write them to the sheet</span></span>
<span id="cb8-29"><a href="#cb8-29" aria-hidden="true" tabindex="-1"></a>    prjIDs <span class="ot">&lt;-</span> workingList[<span class="fu">which</span>(workingList<span class="sc">$</span>project_acc_bioprj <span class="sc">==</span> prj), <span class="fu">c</span>(<span class="st">"project_acc_bioprj"</span>,</span>
<span id="cb8-30"><a href="#cb8-30" aria-hidden="true" tabindex="-1"></a>                                                                        <span class="st">"biosample_acc_sra"</span>,<span class="st">"run_acc_sra"</span>)]</span>
<span id="cb8-31"><a href="#cb8-31" aria-hidden="true" tabindex="-1"></a>    prjIDs <span class="ot">&lt;-</span> <span class="fu">cbind</span>(<span class="at">project_index=</span>index,prjIDs)</span>
<span id="cb8-32"><a href="#cb8-32" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb8-33"><a href="#cb8-33" aria-hidden="true" tabindex="-1"></a>    <span class="co"># grab more metadata, collapse first and last names, split the genus and species names and </span></span>
<span id="cb8-34"><a href="#cb8-34" aria-hidden="true" tabindex="-1"></a>    <span class="co">#write into the sheet</span></span>
<span id="cb8-35"><a href="#cb8-35" aria-hidden="true" tabindex="-1"></a>    namestax <span class="ot">&lt;-</span> workingList[<span class="fu">which</span>(workingList<span class="sc">$</span>project_acc_bioprj <span class="sc">==</span> prj), <span class="fu">c</span>(<span class="st">"contact_first_name_biosamp"</span>,</span>
<span id="cb8-36"><a href="#cb8-36" aria-hidden="true" tabindex="-1"></a>   <span class="st">"contact_last_name_biosamp"</span>,</span>
<span id="cb8-37"><a href="#cb8-37" aria-hidden="true" tabindex="-1"></a>   <span class="st">"samplename_identifiers_biosamp"</span>,</span>
<span id="cb8-38"><a href="#cb8-38" aria-hidden="true" tabindex="-1"></a>   <span class="st">"organism_biosamp"</span>, </span>
<span id="cb8-39"><a href="#cb8-39" aria-hidden="true" tabindex="-1"></a>   <span class="st">"taxonomy_biosamp"</span>, </span>
<span id="cb8-40"><a href="#cb8-40" aria-hidden="true" tabindex="-1"></a>   <span class="st">"infraspecies_biosamp"</span>)]  <span class="sc">%&gt;%</span> </span>
<span id="cb8-41"><a href="#cb8-41" aria-hidden="true" tabindex="-1"></a>    <span class="fu">unite</span>(<span class="st">"contact_first_name_biosamp"</span>, <span class="st">"contact_last_name_biosamp"</span>, </span>
<span id="cb8-42"><a href="#cb8-42" aria-hidden="true" tabindex="-1"></a>                                    <span class="at">sep =</span> <span class="st">" "</span>, <span class="at">col =</span> <span class="st">"collectorList"</span>, <span class="at">remove =</span> T) </span>
<span id="cb8-43"><a href="#cb8-43" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb8-44"><a href="#cb8-44" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Taxize - Create a lookup table</span></span>
<span id="cb8-45"><a href="#cb8-45" aria-hidden="true" tabindex="-1"></a>    <span class="fu">print</span>(<span class="st">"Querying Taxonomy"</span>)</span>
<span id="cb8-46"><a href="#cb8-46" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb8-47"><a href="#cb8-47" aria-hidden="true" tabindex="-1"></a>    <span class="co"># my first try using tax_name() required a separate lookup for every sample!</span></span>
<span id="cb8-48"><a href="#cb8-48" aria-hidden="true" tabindex="-1"></a>    <span class="co">#taxonomy &lt;- tax_name(sci=namestax$organism_biosamp, get = c("Phylum","Class","Order","Family"))</span></span>
<span id="cb8-49"><a href="#cb8-49" aria-hidden="true" tabindex="-1"></a>    <span class="co">#common_name &lt;- sci2comm(sci = namestax$organism_biosamp)</span></span>
<span id="cb8-50"><a href="#cb8-50" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb8-51"><a href="#cb8-51" aria-hidden="true" tabindex="-1"></a>    <span class="co">#get all unique uids</span></span>
<span id="cb8-52"><a href="#cb8-52" aria-hidden="true" tabindex="-1"></a>    uids <span class="ot">&lt;-</span> <span class="fu">as.uid</span>(<span class="fu">unique</span>(namestax<span class="sc">$</span>taxonomy_biosamp), <span class="at">check =</span> F)</span>
<span id="cb8-53"><a href="#cb8-53" aria-hidden="true" tabindex="-1"></a>    <span class="co"># this produces a list of data frames, one df per uid</span></span>
<span id="cb8-54"><a href="#cb8-54" aria-hidden="true" tabindex="-1"></a>    taxonomy <span class="ot">&lt;-</span> <span class="fu">as.list</span>(<span class="fu">classification</span>(<span class="at">id =</span> uids, <span class="at">db=</span><span class="st">"ncbi"</span>))</span>
<span id="cb8-55"><a href="#cb8-55" aria-hidden="true" tabindex="-1"></a>    <span class="co"># this produces a list of common names. If it can't find a common name though, it assigns `character(0)`</span></span>
<span id="cb8-56"><a href="#cb8-56" aria-hidden="true" tabindex="-1"></a>    <span class="co"># so we overwrite these with NA</span></span>
<span id="cb8-57"><a href="#cb8-57" aria-hidden="true" tabindex="-1"></a>    common_name <span class="ot">&lt;-</span> <span class="fu">sci2comm</span>(<span class="at">id=</span>uids)</span>
<span id="cb8-58"><a href="#cb8-58" aria-hidden="true" tabindex="-1"></a>    common_name[<span class="fu">which</span>(common_name<span class="sc">==</span><span class="st">"character(0)"</span>)]<span class="ot">&lt;-</span><span class="cn">NA</span></span>
<span id="cb8-59"><a href="#cb8-59" aria-hidden="true" tabindex="-1"></a>    <span class="co"># classification gives a class called "classification", change it back to a list</span></span>
<span id="cb8-60"><a href="#cb8-60" aria-hidden="true" tabindex="-1"></a>    <span class="fu">class</span>(taxonomy) <span class="ot">&lt;-</span> <span class="st">"list"</span></span>
<span id="cb8-61"><a href="#cb8-61" aria-hidden="true" tabindex="-1"></a>    <span class="co"># this will write the common name into each table as a taxonomic rank</span></span>
<span id="cb8-62"><a href="#cb8-62" aria-hidden="true" tabindex="-1"></a>    taxonomy <span class="ot">&lt;-</span> <span class="fu">Map</span>(<span class="cf">function</span>(x,y) {<span class="fu">rbind</span>(x,<span class="fu">c</span>(y,<span class="st">"common_name"</span>,<span class="dv">0</span>))}, taxonomy, common_name)</span>
<span id="cb8-63"><a href="#cb8-63" aria-hidden="true" tabindex="-1"></a>    <span class="co"># put this into a tibble, then unnest it, so that the name of each list is now a column called `uid`</span></span>
<span id="cb8-64"><a href="#cb8-64" aria-hidden="true" tabindex="-1"></a>    <span class="co"># add some dummy rows so that we always have these particular ranks in our taxonomy lookup</span></span>
<span id="cb8-65"><a href="#cb8-65" aria-hidden="true" tabindex="-1"></a>    <span class="co"># drop the id field, and spread it out (pivot_wider replaces spread) so we have the complete </span></span>
<span id="cb8-66"><a href="#cb8-66" aria-hidden="true" tabindex="-1"></a>    <span class="co"># taxonomy for each uid</span></span>
<span id="cb8-67"><a href="#cb8-67" aria-hidden="true" tabindex="-1"></a>    <span class="co"># now we have a lookup table!</span></span>
<span id="cb8-68"><a href="#cb8-68" aria-hidden="true" tabindex="-1"></a>    taxonomy_lookup <span class="ot">&lt;-</span> <span class="fu">tibble</span>(<span class="at">uid =</span> <span class="fu">as.numeric</span>(<span class="fu">names</span>(taxonomy)), <span class="at">taxonomy =</span> taxonomy) <span class="sc">%&gt;%</span></span>
<span id="cb8-69"><a href="#cb8-69" aria-hidden="true" tabindex="-1"></a>                              <span class="fu">unnest</span>(<span class="at">cols =</span> taxonomy) <span class="sc">%&gt;%</span> </span>
<span id="cb8-70"><a href="#cb8-70" aria-hidden="true" tabindex="-1"></a>                              <span class="fu">add_row</span>(<span class="at">uid=</span><span class="dv">0</span>,<span class="at">name =</span> <span class="cn">NA</span>, <span class="at">rank =</span> <span class="fu">c</span>(<span class="st">"phylum"</span>,<span class="st">"class"</span>,<span class="st">"order"</span>,<span class="st">"family"</span>, <span class="st">"genus"</span>, <span class="st">"species"</span>, <span class="st">"subspecies"</span>), </span>
<span id="cb8-71"><a href="#cb8-71" aria-hidden="true" tabindex="-1"></a>                                          <span class="at">id =</span> <span class="st">"0"</span>) <span class="sc">%&gt;%</span></span>
<span id="cb8-72"><a href="#cb8-72" aria-hidden="true" tabindex="-1"></a>                              <span class="fu">select</span>(<span class="sc">-</span>id) <span class="sc">%&gt;%</span> </span>
<span id="cb8-73"><a href="#cb8-73" aria-hidden="true" tabindex="-1"></a>                              <span class="fu">pivot_wider</span>(<span class="at">names_from=</span>rank, <span class="at">values_from =</span> name,</span>
<span id="cb8-74"><a href="#cb8-74" aria-hidden="true" tabindex="-1"></a>                                          <span class="at">values_fn =</span> <span class="fu">list</span>(<span class="at">name =</span> list)) <span class="sc">%&gt;%</span></span>
<span id="cb8-75"><a href="#cb8-75" aria-hidden="true" tabindex="-1"></a>                              <span class="fu">unnest</span>(<span class="at">cols =</span> <span class="fu">c</span>(phylum, class,  order, family,</span>
<span id="cb8-76"><a href="#cb8-76" aria-hidden="true" tabindex="-1"></a>                                              genus, species, subspecies, common_name))</span>
<span id="cb8-77"><a href="#cb8-77" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb8-78"><a href="#cb8-78" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb8-79"><a href="#cb8-79" aria-hidden="true" tabindex="-1"></a>    taxonomized <span class="ot">&lt;-</span> <span class="fu">left_join</span>(<span class="fu">tibble</span>(<span class="at">uid=</span>namestax<span class="sc">$</span>taxonomy_biosamp), taxonomy_lookup, </span>
<span id="cb8-80"><a href="#cb8-80" aria-hidden="true" tabindex="-1"></a>                             <span class="at">by =</span> <span class="st">"uid"</span>) <span class="sc">%&gt;%</span></span>
<span id="cb8-81"><a href="#cb8-81" aria-hidden="true" tabindex="-1"></a>                <span class="fu">select</span>(genus, species,subspecies,phylum,class,order,family,common_name) <span class="sc">%&gt;%</span></span>
<span id="cb8-82"><a href="#cb8-82" aria-hidden="true" tabindex="-1"></a>                <span class="fu">replace_na</span>(<span class="at">replace =</span> <span class="fu">list</span>(<span class="at">subspecies=</span><span class="st">""</span>))</span>
<span id="cb8-83"><a href="#cb8-83" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb8-84"><a href="#cb8-84" aria-hidden="true" tabindex="-1"></a>    <span class="co">#have to write and overwrite here so I can paste subspecies into infraspecies...</span></span>
<span id="cb8-85"><a href="#cb8-85" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb8-86"><a href="#cb8-86" aria-hidden="true" tabindex="-1"></a>    taxonomized <span class="ot">&lt;-</span>  <span class="fu">add_column</span>(taxonomized, <span class="at">nomenclaturalCode =</span> <span class="fu">paste</span>(<span class="st">"NCBI queried:"</span>,<span class="fu">date</span>(),</span>
<span id="cb8-87"><a href="#cb8-87" aria-hidden="true" tabindex="-1"></a>                                                                      <span class="at">sep =</span> <span class="st">" "</span>), </span>
<span id="cb8-88"><a href="#cb8-88" aria-hidden="true" tabindex="-1"></a>                    <span class="at">scientificNameID =</span> namestax<span class="sc">$</span>taxonomy_biosamp, </span>
<span id="cb8-89"><a href="#cb8-89" aria-hidden="true" tabindex="-1"></a>                    <span class="at">infraspecies =</span> <span class="fu">paste</span>(taxonomized<span class="sc">$</span>subspecies,namestax<span class="sc">$</span>infraspecies_biosamp,</span>
<span id="cb8-90"><a href="#cb8-90" aria-hidden="true" tabindex="-1"></a>                                         <span class="at">sep =</span> <span class="st">" "</span>)) <span class="sc">%&gt;%</span></span>
<span id="cb8-91"><a href="#cb8-91" aria-hidden="true" tabindex="-1"></a>                    <span class="fu">mutate_all</span>(<span class="sc">~</span><span class="fu">na_if</span>(.,<span class="st">"character(0)"</span>)) <span class="sc">%&gt;%</span> <span class="fu">mutate_all</span>(<span class="sc">~</span><span class="fu">na_if</span>(.,<span class="st">"NULL"</span>)) <span class="sc">%&gt;%</span> </span>
<span id="cb8-92"><a href="#cb8-92" aria-hidden="true" tabindex="-1"></a>                    <span class="fu">mutate</span>(<span class="at">infraspecies =</span> <span class="fu">str_trim</span>(infraspecies,<span class="at">side =</span> <span class="st">"both"</span>)) <span class="sc">%&gt;%</span></span>
<span id="cb8-93"><a href="#cb8-93" aria-hidden="true" tabindex="-1"></a>                    <span class="fu">select</span>(<span class="sc">-</span>subspecies)</span>
<span id="cb8-94"><a href="#cb8-94" aria-hidden="true" tabindex="-1"></a>                    </span>
<span id="cb8-95"><a href="#cb8-95" aria-hidden="true" tabindex="-1"></a>    otherSRA <span class="ot">&lt;-</span> workingList[<span class="fu">which</span>(workingList<span class="sc">$</span>project_acc_bioprj <span class="sc">==</span> prj), </span>
<span id="cb8-96"><a href="#cb8-96" aria-hidden="true" tabindex="-1"></a>                           <span class="fu">c</span>(<span class="st">"library_selection_sra"</span>,   <span class="st">"library_strat_sra"</span>,<span class="st">"read_type_sra"</span>, </span>
<span id="cb8-97"><a href="#cb8-97" aria-hidden="true" tabindex="-1"></a>                             <span class="st">"platform"</span>, <span class="st">"instrument"</span>, <span class="st">"study_acc_sra"</span>, <span class="st">"experiment_acc_sra"</span>,</span>
<span id="cb8-98"><a href="#cb8-98" aria-hidden="true" tabindex="-1"></a>                             <span class="st">"package_biosamp"</span>,<span class="st">"link"</span>)]</span>
<span id="cb8-99"><a href="#cb8-99" aria-hidden="true" tabindex="-1"></a>   </span>
<span id="cb8-100"><a href="#cb8-100" aria-hidden="true" tabindex="-1"></a>   <span class="co"># Bind it all together to make a single data frame together with blank columns. </span></span>
<span id="cb8-101"><a href="#cb8-101" aria-hidden="true" tabindex="-1"></a>   <span class="co"># Going to try writing this all at once to reduce the calls to the API</span></span>
<span id="cb8-102"><a href="#cb8-102" aria-hidden="true" tabindex="-1"></a>   metadata<span class="ot">&lt;-</span> <span class="fu">bind_cols</span>(prjIDs, namestax[,<span class="dv">1</span><span class="sc">:</span><span class="dv">2</span>], taxonomized, otherSRA) <span class="sc">%&gt;%</span> </span>
<span id="cb8-103"><a href="#cb8-103" aria-hidden="true" tabindex="-1"></a>          <span class="fu">add_column</span>(<span class="at">.after =</span> <span class="dv">4</span>,<span class="at">sampleEnteredBy =</span> <span class="st">""</span>) <span class="sc">%&gt;%</span> </span>
<span id="cb8-104"><a href="#cb8-104" aria-hidden="true" tabindex="-1"></a>          <span class="fu">add_column</span>(<span class="at">.after =</span> <span class="dv">9</span>, <span class="at">locality =</span> <span class="st">""</span>, <span class="at">decimalLatitude =</span> <span class="st">""</span>, <span class="at">decimalLongitude =</span> <span class="st">""</span>,</span>
<span id="cb8-105"><a href="#cb8-105" aria-hidden="true" tabindex="-1"></a>                    <span class="at">coordinateUncertaintyInMeters =</span> <span class="st">""</span>, <span class="at">country =</span> <span class="st">""</span>,</span>
<span id="cb8-106"><a href="#cb8-106" aria-hidden="true" tabindex="-1"></a>                    <span class="at">georeferenceProtocol =</span> <span class="st">""</span>,</span>
<span id="cb8-107"><a href="#cb8-107" aria-hidden="true" tabindex="-1"></a>                    <span class="at">habitat =</span> <span class="st">""</span>, <span class="at">microHabitat =</span> <span class="st">""</span>, <span class="at">environmental_medium =</span> <span class="st">""</span>,</span>
<span id="cb8-108"><a href="#cb8-108" aria-hidden="true" tabindex="-1"></a>                    <span class="at">yearCollected =</span> <span class="st">""</span>, <span class="at">monthCollected =</span> <span class="st">""</span>, <span class="at">dayCollected =</span> <span class="st">""</span>,</span>
<span id="cb8-109"><a href="#cb8-109" aria-hidden="true" tabindex="-1"></a>                    <span class="at">establishmentMeans =</span> <span class="st">""</span>,<span class="at">permitInformation =</span> <span class="st">""</span>, <span class="at">associatedReferences =</span> <span class="st">""</span>,</span>
<span id="cb8-110"><a href="#cb8-110" aria-hidden="true" tabindex="-1"></a>                    <span class="at">preservative =</span> <span class="st">""</span>, <span class="at">derivedGeneticDataType =</span> <span class="st">""</span>, </span>
<span id="cb8-111"><a href="#cb8-111" aria-hidden="true" tabindex="-1"></a>                    <span class="at">derivedGeneticDataURI =</span> <span class="st">""</span>, </span>
<span id="cb8-112"><a href="#cb8-112" aria-hidden="true" tabindex="-1"></a>                    <span class="at">derivedDataGeneticDataFormat =</span> <span class="st">""</span>, </span>
<span id="cb8-113"><a href="#cb8-113" aria-hidden="true" tabindex="-1"></a>                    <span class="at">derivedDataGeneticFilename =</span> <span class="st">""</span>, <span class="at">derivedGeneticDataRemarks =</span> <span class="st">""</span>) <span class="sc">%&gt;%</span></span>
<span id="cb8-114"><a href="#cb8-114" aria-hidden="true" tabindex="-1"></a>          <span class="fu">add_column</span>(<span class="at">.after =</span> <span class="dv">38</span>, <span class="at">lifeStage =</span> <span class="st">""</span>, <span class="at">sex =</span> <span class="st">""</span>, <span class="at">otherCatalogNumbers =</span> <span class="st">""</span>,</span>
<span id="cb8-115"><a href="#cb8-115" aria-hidden="true" tabindex="-1"></a>                      <span class="at">associatedMedia =</span> <span class="st">""</span>, <span class="at">samplingProtocol =</span> <span class="st">""</span>,  <span class="at">tissueType =</span> <span class="st">""</span>,</span>
<span id="cb8-116"><a href="#cb8-116" aria-hidden="true" tabindex="-1"></a>                      <span class="at">continentOcean =</span> <span class="st">""</span>, <span class="at">island =</span> <span class="st">""</span>, <span class="at">maximumDepthInMeters =</span> <span class="st">""</span>,</span>
<span id="cb8-117"><a href="#cb8-117" aria-hidden="true" tabindex="-1"></a>                      <span class="at">maximumElevationInMeters =</span> <span class="st">""</span>, <span class="at">minimumDepthInMeters =</span> <span class="st">""</span>, </span>
<span id="cb8-118"><a href="#cb8-118" aria-hidden="true" tabindex="-1"></a>                      <span class="at">minimumElevationInMeters =</span> <span class="st">""</span>,    <span class="at">stateProvince =</span> <span class="st">""</span>, <span class="at">landOwner =</span> <span class="st">""</span></span>
<span id="cb8-119"><a href="#cb8-119" aria-hidden="true" tabindex="-1"></a>                      )</span>
<span id="cb8-120"><a href="#cb8-120" aria-hidden="true" tabindex="-1"></a>     </span>
<span id="cb8-121"><a href="#cb8-121" aria-hidden="true" tabindex="-1"></a>          metadata <span class="ot">&lt;-</span> <span class="fu">add_column</span>(metadata,<span class="at">.before =</span> <span class="dv">1</span>,</span>
<span id="cb8-122"><a href="#cb8-122" aria-hidden="true" tabindex="-1"></a>                                 <span class="at">sheet_index =</span> <span class="fu">str_pad</span>(<span class="fu">row.names</span>(metadata),<span class="at">width=</span><span class="dv">4</span>,<span class="at">pad=</span><span class="st">"0"</span>))</span>
<span id="cb8-123"><a href="#cb8-123" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb8-124"><a href="#cb8-124" aria-hidden="true" tabindex="-1"></a>  skip_to_next <span class="ot">&lt;-</span> <span class="cn">FALSE</span></span>
<span id="cb8-125"><a href="#cb8-125" aria-hidden="true" tabindex="-1"></a>  try_try_again <span class="ot">&lt;-</span> <span class="cn">FALSE</span></span>
<span id="cb8-126"><a href="#cb8-126" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb8-127"><a href="#cb8-127" aria-hidden="true" tabindex="-1"></a>  <span class="fu">print</span>(<span class="st">"Writing Metadata"</span>)</span>
<span id="cb8-128"><a href="#cb8-128" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb8-129"><a href="#cb8-129" aria-hidden="true" tabindex="-1"></a>  <span class="fu">tryCatch</span>(<span class="fu">range_write</span>(<span class="at">ss =</span> gdprj, metadata, <span class="at">sheet =</span> <span class="st">"Samples"</span>, <span class="at">range =</span> <span class="st">"A2:BJ4000"</span>, </span>
<span id="cb8-130"><a href="#cb8-130" aria-hidden="true" tabindex="-1"></a>                       <span class="at">col_names =</span> F), </span>
<span id="cb8-131"><a href="#cb8-131" aria-hidden="true" tabindex="-1"></a>            <span class="at">error =</span> <span class="cf">function</span>(e) { msg <span class="ot">&lt;-</span> <span class="fu">conditionMessage</span>(e)</span>
<span id="cb8-132"><a href="#cb8-132" aria-hidden="true" tabindex="-1"></a>                                  <span class="fu">write_csv</span>(<span class="fu">tibble</span>(index,<span class="st">"attempt_1"</span>,msg),</span>
<span id="cb8-133"><a href="#cb8-133" aria-hidden="true" tabindex="-1"></a>                                            <span class="st">"failed.txt"</span>, <span class="at">append =</span> T)</span>
<span id="cb8-134"><a href="#cb8-134" aria-hidden="true" tabindex="-1"></a>                                  try_try_again <span class="ot">&lt;&lt;-</span> <span class="cn">TRUE</span></span>
<span id="cb8-135"><a href="#cb8-135" aria-hidden="true" tabindex="-1"></a>                                  }</span>
<span id="cb8-136"><a href="#cb8-136" aria-hidden="true" tabindex="-1"></a>            )</span>
<span id="cb8-137"><a href="#cb8-137" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb8-138"><a href="#cb8-138" aria-hidden="true" tabindex="-1"></a>  <span class="co">#apparently it works if you try it a second time....</span></span>
<span id="cb8-139"><a href="#cb8-139" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb8-140"><a href="#cb8-140" aria-hidden="true" tabindex="-1"></a>  <span class="cf">if</span>(try_try_again) { <span class="fu">print</span>(<span class="st">"Sleeping for 100 seconds to deal with API quota"</span>)</span>
<span id="cb8-141"><a href="#cb8-141" aria-hidden="true" tabindex="-1"></a>                      <span class="fu">Sys.sleep</span>(<span class="at">time=</span><span class="dv">100</span>)</span>
<span id="cb8-142"><a href="#cb8-142" aria-hidden="true" tabindex="-1"></a>                      <span class="fu">tryCatch</span>(<span class="fu">range_write</span>(<span class="at">ss =</span> gdprj, metadata, </span>
<span id="cb8-143"><a href="#cb8-143" aria-hidden="true" tabindex="-1"></a>                                           <span class="at">sheet =</span> <span class="st">"Samples"</span>, </span>
<span id="cb8-144"><a href="#cb8-144" aria-hidden="true" tabindex="-1"></a>                                           <span class="at">range =</span> <span class="st">"A2:BJ4000"</span>, <span class="at">col_names =</span> F), </span>
<span id="cb8-145"><a href="#cb8-145" aria-hidden="true" tabindex="-1"></a>                                <span class="at">error =</span> <span class="cf">function</span>(e) { msg <span class="ot">&lt;-</span> <span class="fu">conditionMessage</span>(e)</span>
<span id="cb8-146"><a href="#cb8-146" aria-hidden="true" tabindex="-1"></a>                                  <span class="fu">write_csv</span>(<span class="fu">tibble</span>(index,<span class="st">"attempt_2"</span>,msg),<span class="st">"failed.txt"</span>, </span>
<span id="cb8-147"><a href="#cb8-147" aria-hidden="true" tabindex="-1"></a>                                            <span class="at">append =</span> T)</span>
<span id="cb8-148"><a href="#cb8-148" aria-hidden="true" tabindex="-1"></a>                                  skip_to_next <span class="ot">&lt;&lt;-</span> <span class="cn">TRUE</span></span>
<span id="cb8-149"><a href="#cb8-149" aria-hidden="true" tabindex="-1"></a>                                  }</span>
<span id="cb8-150"><a href="#cb8-150" aria-hidden="true" tabindex="-1"></a>            ) </span>
<span id="cb8-151"><a href="#cb8-151" aria-hidden="true" tabindex="-1"></a>  }</span>
<span id="cb8-152"><a href="#cb8-152" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb8-153"><a href="#cb8-153" aria-hidden="true" tabindex="-1"></a>  <span class="cf">if</span>(skip_to_next) { <span class="cf">next</span> } </span>
<span id="cb8-154"><a href="#cb8-154" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb8-155"><a href="#cb8-155" aria-hidden="true" tabindex="-1"></a>   <span class="fu">print</span>(<span class="st">"Sleeping for 15 seconds to deal with API quota"</span>)</span>
<span id="cb8-156"><a href="#cb8-156" aria-hidden="true" tabindex="-1"></a>    <span class="fu">Sys.sleep</span>(<span class="at">time=</span><span class="dv">15</span>)</span>
<span id="cb8-157"><a href="#cb8-157" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb8-158"><a href="#cb8-158" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb8-159"><a href="#cb8-159" aria-hidden="true" tabindex="-1"></a><span class="co">#write_csv(metadata,"E0318.csv")</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</section>
<section id="analyzing-failed-googlesheet-write-operations" class="level2">
<h2 class="anchored" data-anchor-id="analyzing-failed-googlesheet-write-operations">Analyzing Failed GoogleSheet Write Operations</h2>
<p>Whenever it fails to write, it seems to have something to do with the sample size of the BioProject (# of lines). Also, I can determine which BioProjects have already been found irrelevant.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb9"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb9-1"><a href="#cb9-1" aria-hidden="true" tabindex="-1"></a>marineSRA <span class="ot">&lt;-</span> <span class="fu">drive_get</span>(<span class="at">path =</span></span>
<span id="cb9-2"><a href="#cb9-2" aria-hidden="true" tabindex="-1"></a>      <span class="st">"GEOME_Datathon/Datathon_Working_Directory/BioProject_Tables/Marine_SRA_BioProjects"</span>)</span>
<span id="cb9-3"><a href="#cb9-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb9-4"><a href="#cb9-4" aria-hidden="true" tabindex="-1"></a>nonmarineSRA <span class="ot">&lt;-</span> <span class="fu">drive_get</span>(<span class="at">path =</span></span>
<span id="cb9-5"><a href="#cb9-5" aria-hidden="true" tabindex="-1"></a>    <span class="st">"GEOME_Datathon/Datathon_Working_Directory/BioProject_Tables/nonMarine_SRA_BioProjects"</span>)</span>
<span id="cb9-6"><a href="#cb9-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb9-7"><a href="#cb9-7" aria-hidden="true" tabindex="-1"></a>failed <span class="ot">&lt;-</span> <span class="fu">read.csv</span>(<span class="st">"failed.txt"</span>, <span class="at">header=</span>F, <span class="at">stringsAsFactors =</span> F)</span>
<span id="cb9-8"><a href="#cb9-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb9-9"><a href="#cb9-9" aria-hidden="true" tabindex="-1"></a>failed <span class="ot">&lt;-</span> failed[<span class="fu">which</span>(failed[,<span class="dv">2</span>]<span class="sc">==</span><span class="st">"attempt_2"</span>),]</span>
<span id="cb9-10"><a href="#cb9-10" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb9-11"><a href="#cb9-11" aria-hidden="true" tabindex="-1"></a><span class="fu">colnames</span>(failed) <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="st">"project_index"</span>,<span class="st">"write_result"</span>,<span class="st">"message"</span>)</span>
<span id="cb9-12"><a href="#cb9-12" aria-hidden="true" tabindex="-1"></a>failed<span class="sc">$</span>write_result[<span class="fu">which</span>(failed<span class="sc">$</span>write_result <span class="sc">==</span> <span class="st">"attempt_2"</span>)] <span class="ot">&lt;-</span> <span class="st">"Failure"</span></span>
<span id="cb9-13"><a href="#cb9-13" aria-hidden="true" tabindex="-1"></a><span class="co">#113 datasets failed after a second attempt</span></span>
<span id="cb9-14"><a href="#cb9-14" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb9-15"><a href="#cb9-15" aria-hidden="true" tabindex="-1"></a>all5_BioProjects <span class="ot">&lt;-</span> <span class="fu">bind_rows</span>(Marine_BioProjects[,<span class="dv">1</span><span class="sc">:</span><span class="dv">5</span>], nonMarine_BioProjects[,<span class="dv">1</span><span class="sc">:</span><span class="dv">5</span>])</span>
<span id="cb9-16"><a href="#cb9-16" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb9-17"><a href="#cb9-17" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb9-18"><a href="#cb9-18" aria-hidden="true" tabindex="-1"></a>failed_analysis <span class="ot">&lt;-</span> <span class="fu">left_join</span>(all5_BioProjects, failed, <span class="at">by =</span> <span class="st">"project_index"</span>) <span class="sc">%&gt;%</span></span>
<span id="cb9-19"><a href="#cb9-19" aria-hidden="true" tabindex="-1"></a>  <span class="fu">replace_na</span>(<span class="fu">list</span>(<span class="at">write_result =</span> <span class="st">"Success"</span>))</span>
<span id="cb9-20"><a href="#cb9-20" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb9-21"><a href="#cb9-21" aria-hidden="true" tabindex="-1"></a><span class="co">#failed writes seem to be for datasets with larger than average numbers of runs, </span></span>
<span id="cb9-22"><a href="#cb9-22" aria-hidden="true" tabindex="-1"></a><span class="co">#samples, but not species....</span></span>
<span id="cb9-23"><a href="#cb9-23" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>(failed_analysis) <span class="sc">+</span> <span class="fu">geom_boxplot</span>(<span class="at">mapping =</span> <span class="fu">aes</span>(<span class="at">x =</span> write_result, <span class="at">y =</span> Runs)) <span class="sc">+</span></span>
<span id="cb9-24"><a href="#cb9-24" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ylim</span>(<span class="fu">c</span>(<span class="dv">0</span>,<span class="dv">1000</span>))</span>
<span id="cb9-25"><a href="#cb9-25" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb9-26"><a href="#cb9-26" aria-hidden="true" tabindex="-1"></a>failed_analysis<span class="sc">$</span>write_result <span class="ot">&lt;-</span> <span class="fu">as.factor</span>(failed_analysis<span class="sc">$</span>write_result)</span>
<span id="cb9-27"><a href="#cb9-27" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb9-28"><a href="#cb9-28" aria-hidden="true" tabindex="-1"></a>test <span class="ot">&lt;-</span> <span class="fu">glm</span>(write_result <span class="sc">~</span> Runs  , <span class="at">data =</span> failed_analysis, <span class="at">family =</span> <span class="st">"binomial"</span>)</span>
<span id="cb9-29"><a href="#cb9-29" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb9-30"><a href="#cb9-30" aria-hidden="true" tabindex="-1"></a><span class="fu">summary</span>(test)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</section>
<section id="re-writing-difficult-bioprojects-as-excel-sheets" class="level2">
<h2 class="anchored" data-anchor-id="re-writing-difficult-bioprojects-as-excel-sheets">Re-Writing Difficult BioProjects as Excel Sheets</h2>
<p>I can’t figure out why it is failing to write 113 out of 1589 datasets into google sheets. Maybe there is a particular character that it doesn’t like? There is clearly a correlation (see above) between the number of rows (Runs) in the dataset and whether it failed, but that could be because datasets with more rows have a higher probability of including a bad character? [shrug]</p>
<p>So I’m just going to adapt my code above to write out Excel worksheets rather than Google Sheets. These can still be edited by the students within Google Sheets.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb10"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb10-1"><a href="#cb10-1" aria-hidden="true" tabindex="-1"></a><span class="co">#split up the failed dataset into marine and nonmarine</span></span>
<span id="cb10-2"><a href="#cb10-2" aria-hidden="true" tabindex="-1"></a>marineFailed <span class="ot">&lt;-</span> failed[<span class="fu">grep</span>(<span class="st">"M"</span>, <span class="at">x =</span> failed<span class="sc">$</span>project_index),]</span>
<span id="cb10-3"><a href="#cb10-3" aria-hidden="true" tabindex="-1"></a>nonmarineFailed <span class="ot">&lt;-</span> failed[<span class="fu">grep</span>(<span class="st">"E"</span>, <span class="at">x =</span> failed<span class="sc">$</span>project_index),]</span>
<span id="cb10-4"><a href="#cb10-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb10-5"><a href="#cb10-5" aria-hidden="true" tabindex="-1"></a><span class="co">#choose which dataset to work with</span></span>
<span id="cb10-6"><a href="#cb10-6" aria-hidden="true" tabindex="-1"></a>workingFailed <span class="ot">&lt;-</span> nonmarineFailed</span>
<span id="cb10-7"><a href="#cb10-7" aria-hidden="true" tabindex="-1"></a>workingList <span class="ot">&lt;-</span> nonmarinelist</span>
<span id="cb10-8"><a href="#cb10-8" aria-hidden="true" tabindex="-1"></a>workingBioProjects <span class="ot">&lt;-</span> nonMarine_BioProjects</span>
<span id="cb10-9"><a href="#cb10-9" aria-hidden="true" tabindex="-1"></a>path <span class="ot">&lt;-</span> <span class="st">"../Datathon_Working_Directory/BioProject_Tables/NonMarine_BioSample_Metadata/"</span></span>
<span id="cb10-10"><a href="#cb10-10" aria-hidden="true" tabindex="-1"></a>gdpath <span class="ot">&lt;-</span> <span class="st">"GEOME_Datathon/Datathon_Working_Directory/BioProject_Tables/NonMarine_BioSample_Metadata/"</span></span>
<span id="cb10-11"><a href="#cb10-11" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb10-12"><a href="#cb10-12" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb10-13"><a href="#cb10-13" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb10-14"><a href="#cb10-14" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb10-15"><a href="#cb10-15" aria-hidden="true" tabindex="-1"></a><span class="co">#c(310,318,348)</span></span>
<span id="cb10-16"><a href="#cb10-16" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb10-17"><a href="#cb10-17" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span>(index <span class="cf">in</span> workingFailed<span class="sc">$</span>project_index[<span class="dv">6</span><span class="sc">:</span><span class="dv">103</span>]){</span>
<span id="cb10-18"><a href="#cb10-18" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb10-19"><a href="#cb10-19" aria-hidden="true" tabindex="-1"></a>    <span class="co">#index&lt;-"M0003"</span></span>
<span id="cb10-20"><a href="#cb10-20" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb10-21"><a href="#cb10-21" aria-hidden="true" tabindex="-1"></a>    <span class="co">#grab the index</span></span>
<span id="cb10-22"><a href="#cb10-22" aria-hidden="true" tabindex="-1"></a>    prj <span class="ot">&lt;-</span> workingBioProjects<span class="sc">$</span>project_acc_bioprj[<span class="fu">which</span>(workingBioProjects<span class="sc">$</span>project_index<span class="sc">==</span>index)]</span>
<span id="cb10-23"><a href="#cb10-23" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb10-24"><a href="#cb10-24" aria-hidden="true" tabindex="-1"></a>    <span class="fu">print</span>(<span class="fu">paste</span>(<span class="st">"Now Starting"</span>,prj,index,<span class="at">sep=</span><span class="st">" "</span>))</span>
<span id="cb10-25"><a href="#cb10-25" aria-hidden="true" tabindex="-1"></a>    <span class="co">#copy the template to a new file name after the BioProject</span></span>
<span id="cb10-26"><a href="#cb10-26" aria-hidden="true" tabindex="-1"></a>    <span class="fu">print</span>(<span class="st">"Copying Excel Template"</span>)</span>
<span id="cb10-27"><a href="#cb10-27" aria-hidden="true" tabindex="-1"></a>    <span class="co">#file.copy(from="Datathon_BioSample_Template.xlsx", to = paste0(path, index,"_",prj,".xlsx") )</span></span>
<span id="cb10-28"><a href="#cb10-28" aria-hidden="true" tabindex="-1"></a>    xlprj <span class="ot">&lt;-</span> <span class="fu">loadWorkbook</span>(<span class="at">file =</span><span class="st">"Datathon_BioSample_Template.xlsx"</span>, </span>
<span id="cb10-29"><a href="#cb10-29" aria-hidden="true" tabindex="-1"></a>                          <span class="at">isUnzipped =</span> F)</span>
<span id="cb10-30"><a href="#cb10-30" aria-hidden="true" tabindex="-1"></a>    cpprj <span class="ot">&lt;-</span> <span class="fu">copyWorkbook</span>(xlprj)</span>
<span id="cb10-31"><a href="#cb10-31" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb10-32"><a href="#cb10-32" aria-hidden="true" tabindex="-1"></a>    <span class="co"># get the `Dribble` (google drive locator) for this new Google sheet, and delete the google sheet</span></span>
<span id="cb10-33"><a href="#cb10-33" aria-hidden="true" tabindex="-1"></a>    gdprj <span class="ot">&lt;-</span> <span class="fu">drive_get</span>(<span class="at">path =</span> <span class="fu">paste0</span>(gdpath, index,<span class="st">"_"</span>,prj))</span>
<span id="cb10-34"><a href="#cb10-34" aria-hidden="true" tabindex="-1"></a>    <span class="fu">drive_trash</span>(gdprj)</span>
<span id="cb10-35"><a href="#cb10-35" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb10-36"><a href="#cb10-36" aria-hidden="true" tabindex="-1"></a>    <span class="co"># grab the various SRA accession IDs </span></span>
<span id="cb10-37"><a href="#cb10-37" aria-hidden="true" tabindex="-1"></a>    prjIDs <span class="ot">&lt;-</span> workingList[<span class="fu">which</span>(workingList<span class="sc">$</span>project_acc_bioprj <span class="sc">==</span> prj), </span>
<span id="cb10-38"><a href="#cb10-38" aria-hidden="true" tabindex="-1"></a>                          <span class="fu">c</span>(<span class="st">"project_acc_bioprj"</span>,<span class="st">"biosample_acc_sra"</span>,<span class="st">"run_acc_sra"</span>)]</span>
<span id="cb10-39"><a href="#cb10-39" aria-hidden="true" tabindex="-1"></a>    prjIDs <span class="ot">&lt;-</span> <span class="fu">cbind</span>(<span class="at">project_index=</span>index,prjIDs)</span>
<span id="cb10-40"><a href="#cb10-40" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb10-41"><a href="#cb10-41" aria-hidden="true" tabindex="-1"></a>    <span class="co"># grab more metadata, collapse first and last names, split the genus and species names and </span></span>
<span id="cb10-42"><a href="#cb10-42" aria-hidden="true" tabindex="-1"></a>    <span class="co">#write into the sheet</span></span>
<span id="cb10-43"><a href="#cb10-43" aria-hidden="true" tabindex="-1"></a>    namestax <span class="ot">&lt;-</span> workingList[<span class="fu">which</span>(workingList<span class="sc">$</span>project_acc_bioprj <span class="sc">==</span> prj),</span>
<span id="cb10-44"><a href="#cb10-44" aria-hidden="true" tabindex="-1"></a>                            <span class="fu">c</span>(<span class="st">"contact_first_name_biosamp"</span>, </span>
<span id="cb10-45"><a href="#cb10-45" aria-hidden="true" tabindex="-1"></a>                              <span class="st">"contact_last_name_biosamp"</span>,</span>
<span id="cb10-46"><a href="#cb10-46" aria-hidden="true" tabindex="-1"></a>                              <span class="st">"samplename_identifiers_biosamp"</span>, </span>
<span id="cb10-47"><a href="#cb10-47" aria-hidden="true" tabindex="-1"></a>                              <span class="st">"organism_biosamp"</span>, </span>
<span id="cb10-48"><a href="#cb10-48" aria-hidden="true" tabindex="-1"></a>                              <span class="st">"taxonomy_biosamp"</span>,<span class="st">"infraspecies_biosamp"</span>)]  <span class="sc">%&gt;%</span> </span>
<span id="cb10-49"><a href="#cb10-49" aria-hidden="true" tabindex="-1"></a>                <span class="fu">unite</span>(<span class="st">"contact_first_name_biosamp"</span>, <span class="st">"contact_last_name_biosamp"</span>, </span>
<span id="cb10-50"><a href="#cb10-50" aria-hidden="true" tabindex="-1"></a>                                    <span class="at">sep =</span> <span class="st">" "</span>, <span class="at">col =</span> <span class="st">"collectorList"</span>, <span class="at">remove =</span> T) </span>
<span id="cb10-51"><a href="#cb10-51" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb10-52"><a href="#cb10-52" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb10-53"><a href="#cb10-53" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Taxize - Create a lookup table</span></span>
<span id="cb10-54"><a href="#cb10-54" aria-hidden="true" tabindex="-1"></a>    <span class="fu">print</span>(<span class="st">"Querying Taxonomy"</span>)</span>
<span id="cb10-55"><a href="#cb10-55" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb10-56"><a href="#cb10-56" aria-hidden="true" tabindex="-1"></a>    <span class="co"># my first try using tax_name() required a separate lookup for every sample!</span></span>
<span id="cb10-57"><a href="#cb10-57" aria-hidden="true" tabindex="-1"></a>    <span class="co">#taxonomy &lt;- tax_name(sci=namestax$organism_biosamp, get = c("Phylum","Class","Order","Family"))</span></span>
<span id="cb10-58"><a href="#cb10-58" aria-hidden="true" tabindex="-1"></a>    <span class="co">#common_name &lt;- sci2comm(sci = namestax$organism_biosamp)</span></span>
<span id="cb10-59"><a href="#cb10-59" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb10-60"><a href="#cb10-60" aria-hidden="true" tabindex="-1"></a>    <span class="co">#get all unique uids</span></span>
<span id="cb10-61"><a href="#cb10-61" aria-hidden="true" tabindex="-1"></a>    uids <span class="ot">&lt;-</span> <span class="fu">as.uid</span>(<span class="fu">unique</span>(namestax<span class="sc">$</span>taxonomy_biosamp), <span class="at">check =</span> F)</span>
<span id="cb10-62"><a href="#cb10-62" aria-hidden="true" tabindex="-1"></a>    <span class="co"># this produces a list of data frames, one df per uid</span></span>
<span id="cb10-63"><a href="#cb10-63" aria-hidden="true" tabindex="-1"></a>    taxonomy <span class="ot">&lt;-</span> <span class="fu">as.list</span>(<span class="fu">classification</span>(<span class="at">id =</span> uids, <span class="at">db=</span><span class="st">"ncbi"</span>))</span>
<span id="cb10-64"><a href="#cb10-64" aria-hidden="true" tabindex="-1"></a>    <span class="co"># this produces a list of common names. If it can't find a common name though, it assigns `character(0)`</span></span>
<span id="cb10-65"><a href="#cb10-65" aria-hidden="true" tabindex="-1"></a>    <span class="co"># so we overwrite these with NA</span></span>
<span id="cb10-66"><a href="#cb10-66" aria-hidden="true" tabindex="-1"></a>    common_name <span class="ot">&lt;-</span> <span class="fu">sci2comm</span>(<span class="at">id=</span>uids)</span>
<span id="cb10-67"><a href="#cb10-67" aria-hidden="true" tabindex="-1"></a>    common_name[<span class="fu">which</span>(common_name<span class="sc">==</span><span class="st">"character(0)"</span>)]<span class="ot">&lt;-</span><span class="cn">NA</span></span>
<span id="cb10-68"><a href="#cb10-68" aria-hidden="true" tabindex="-1"></a>    <span class="co"># classification gives a class called "classification", change it back to a list</span></span>
<span id="cb10-69"><a href="#cb10-69" aria-hidden="true" tabindex="-1"></a>    <span class="fu">class</span>(taxonomy) <span class="ot">&lt;-</span> <span class="st">"list"</span></span>
<span id="cb10-70"><a href="#cb10-70" aria-hidden="true" tabindex="-1"></a>    <span class="co"># this will write the common name into each table as a taxonomic rank</span></span>
<span id="cb10-71"><a href="#cb10-71" aria-hidden="true" tabindex="-1"></a>    taxonomy <span class="ot">&lt;-</span> <span class="fu">Map</span>(<span class="cf">function</span>(x,y) {<span class="fu">rbind</span>(x,<span class="fu">c</span>(y,<span class="st">"common_name"</span>,<span class="dv">0</span>))}, taxonomy, common_name)</span>
<span id="cb10-72"><a href="#cb10-72" aria-hidden="true" tabindex="-1"></a>    <span class="co"># put this into a tibble, then unnest it, so that the name of each list is now a column called `uid`</span></span>
<span id="cb10-73"><a href="#cb10-73" aria-hidden="true" tabindex="-1"></a>    <span class="co"># add some dummy rows so that we always have these particular ranks </span></span>
<span id="cb10-74"><a href="#cb10-74" aria-hidden="true" tabindex="-1"></a>    <span class="co">#in our taxonomy lookup</span></span>
<span id="cb10-75"><a href="#cb10-75" aria-hidden="true" tabindex="-1"></a>    <span class="co"># drop the id field, and spread it out (pivot_wider replaces spread) so we have the complete </span></span>
<span id="cb10-76"><a href="#cb10-76" aria-hidden="true" tabindex="-1"></a>    <span class="co"># taxonomy for each uid</span></span>
<span id="cb10-77"><a href="#cb10-77" aria-hidden="true" tabindex="-1"></a>    <span class="co"># now we have a lookup table!</span></span>
<span id="cb10-78"><a href="#cb10-78" aria-hidden="true" tabindex="-1"></a>    taxonomy_lookup <span class="ot">&lt;-</span> <span class="fu">tibble</span>(<span class="at">uid =</span> <span class="fu">as.numeric</span>(<span class="fu">names</span>(taxonomy)), <span class="at">taxonomy =</span> taxonomy) <span class="sc">%&gt;%</span></span>
<span id="cb10-79"><a href="#cb10-79" aria-hidden="true" tabindex="-1"></a>                              <span class="fu">unnest</span>(<span class="at">cols =</span> taxonomy) <span class="sc">%&gt;%</span> </span>
<span id="cb10-80"><a href="#cb10-80" aria-hidden="true" tabindex="-1"></a>                              <span class="fu">add_row</span>(<span class="at">uid=</span><span class="dv">0</span>,<span class="at">name =</span> <span class="cn">NA</span>, </span>
<span id="cb10-81"><a href="#cb10-81" aria-hidden="true" tabindex="-1"></a>                                      <span class="at">rank =</span> <span class="fu">c</span>(<span class="st">"phylum"</span>,<span class="st">"class"</span>,<span class="st">"order"</span>,<span class="st">"family"</span>, <span class="st">"genus"</span>,</span>
<span id="cb10-82"><a href="#cb10-82" aria-hidden="true" tabindex="-1"></a>                                                                <span class="st">"species"</span>, <span class="st">"subspecies"</span>), </span>
<span id="cb10-83"><a href="#cb10-83" aria-hidden="true" tabindex="-1"></a>                                          <span class="at">id =</span> <span class="st">"0"</span>) <span class="sc">%&gt;%</span></span>
<span id="cb10-84"><a href="#cb10-84" aria-hidden="true" tabindex="-1"></a>                              <span class="fu">select</span>(<span class="sc">-</span>id) <span class="sc">%&gt;%</span> </span>
<span id="cb10-85"><a href="#cb10-85" aria-hidden="true" tabindex="-1"></a>                              <span class="fu">pivot_wider</span>(<span class="at">names_from=</span>rank, <span class="at">values_from =</span> name, </span>
<span id="cb10-86"><a href="#cb10-86" aria-hidden="true" tabindex="-1"></a>                                          <span class="at">values_fn =</span> <span class="fu">list</span>(<span class="at">name =</span> list)) <span class="sc">%&gt;%</span></span>
<span id="cb10-87"><a href="#cb10-87" aria-hidden="true" tabindex="-1"></a>                              <span class="fu">unnest</span>(<span class="at">cols =</span> <span class="fu">c</span>(phylum, class,  order, family, genus, </span>
<span id="cb10-88"><a href="#cb10-88" aria-hidden="true" tabindex="-1"></a>                                              species, subspecies,</span>
<span id="cb10-89"><a href="#cb10-89" aria-hidden="true" tabindex="-1"></a>                                              common_name))</span>
<span id="cb10-90"><a href="#cb10-90" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb10-91"><a href="#cb10-91" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb10-92"><a href="#cb10-92" aria-hidden="true" tabindex="-1"></a>    taxonomized <span class="ot">&lt;-</span> <span class="fu">left_join</span>(<span class="fu">tibble</span>(<span class="at">uid=</span>namestax<span class="sc">$</span>taxonomy_biosamp), </span>
<span id="cb10-93"><a href="#cb10-93" aria-hidden="true" tabindex="-1"></a>                             taxonomy_lookup, <span class="at">by =</span> <span class="st">"uid"</span>) <span class="sc">%&gt;%</span></span>
<span id="cb10-94"><a href="#cb10-94" aria-hidden="true" tabindex="-1"></a>                    <span class="fu">select</span>(genus, species,subspecies,phylum,class,order,</span>
<span id="cb10-95"><a href="#cb10-95" aria-hidden="true" tabindex="-1"></a>                                        family,common_name) <span class="sc">%&gt;%</span> </span>
<span id="cb10-96"><a href="#cb10-96" aria-hidden="true" tabindex="-1"></a>                    <span class="fu">replace_na</span>(<span class="at">replace =</span> <span class="fu">list</span>(<span class="at">subspecies=</span><span class="st">""</span>))</span>
<span id="cb10-97"><a href="#cb10-97" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb10-98"><a href="#cb10-98" aria-hidden="true" tabindex="-1"></a>    <span class="co">#have to write and overwrite here so I can paste subspecies into infraspecies...</span></span>
<span id="cb10-99"><a href="#cb10-99" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb10-100"><a href="#cb10-100" aria-hidden="true" tabindex="-1"></a>    taxonomized <span class="ot">&lt;-</span>  <span class="fu">add_column</span>(taxonomized, </span>
<span id="cb10-101"><a href="#cb10-101" aria-hidden="true" tabindex="-1"></a>                               <span class="at">nomenclaturalCode =</span> <span class="fu">paste</span>(<span class="st">"NCBI queried:"</span>,<span class="fu">date</span>(), <span class="at">sep =</span> <span class="st">" "</span>), </span>
<span id="cb10-102"><a href="#cb10-102" aria-hidden="true" tabindex="-1"></a>                    <span class="at">scientificNameID =</span> namestax<span class="sc">$</span>taxonomy_biosamp, </span>
<span id="cb10-103"><a href="#cb10-103" aria-hidden="true" tabindex="-1"></a>                    <span class="at">infraspecies =</span> <span class="fu">paste</span>(taxonomized<span class="sc">$</span>subspecies,namestax<span class="sc">$</span>infraspecies_biosamp,</span>
<span id="cb10-104"><a href="#cb10-104" aria-hidden="true" tabindex="-1"></a>                                         <span class="at">sep =</span> <span class="st">" "</span>)) <span class="sc">%&gt;%</span></span>
<span id="cb10-105"><a href="#cb10-105" aria-hidden="true" tabindex="-1"></a>                    <span class="fu">mutate_all</span>(<span class="sc">~</span><span class="fu">na_if</span>(.,<span class="st">"character(0)"</span>)) <span class="sc">%&gt;%</span> <span class="fu">mutate_all</span>(<span class="sc">~</span><span class="fu">na_if</span>(.,<span class="st">"NULL"</span>)) <span class="sc">%&gt;%</span> </span>
<span id="cb10-106"><a href="#cb10-106" aria-hidden="true" tabindex="-1"></a>                    <span class="fu">mutate</span>(<span class="at">infraspecies =</span> <span class="fu">str_trim</span>(infraspecies,<span class="at">side =</span> <span class="st">"both"</span>)) <span class="sc">%&gt;%</span></span>
<span id="cb10-107"><a href="#cb10-107" aria-hidden="true" tabindex="-1"></a>                    <span class="fu">select</span>(<span class="sc">-</span>subspecies)</span>
<span id="cb10-108"><a href="#cb10-108" aria-hidden="true" tabindex="-1"></a>                    </span>
<span id="cb10-109"><a href="#cb10-109" aria-hidden="true" tabindex="-1"></a>    otherSRA <span class="ot">&lt;-</span> workingList[<span class="fu">which</span>(workingList<span class="sc">$</span>project_acc_bioprj <span class="sc">==</span> prj), </span>
<span id="cb10-110"><a href="#cb10-110" aria-hidden="true" tabindex="-1"></a>                           <span class="fu">c</span>(<span class="st">"library_selection_sra"</span>,   <span class="st">"library_strat_sra"</span>,<span class="st">"read_type_sra"</span>, </span>
<span id="cb10-111"><a href="#cb10-111" aria-hidden="true" tabindex="-1"></a>                             <span class="st">"platform"</span>, <span class="st">"instrument"</span>, <span class="st">"study_acc_sra"</span>, <span class="st">"experiment_acc_sra"</span>,</span>
<span id="cb10-112"><a href="#cb10-112" aria-hidden="true" tabindex="-1"></a>                             <span class="st">"package_biosamp"</span>,<span class="st">"link"</span>)]</span>
<span id="cb10-113"><a href="#cb10-113" aria-hidden="true" tabindex="-1"></a>   </span>
<span id="cb10-114"><a href="#cb10-114" aria-hidden="true" tabindex="-1"></a>   <span class="co"># Bind it all together to make a single data frame together with blank columns. </span></span>
<span id="cb10-115"><a href="#cb10-115" aria-hidden="true" tabindex="-1"></a>   <span class="co"># Going to try writing this all at once to reduce the calls to the API</span></span>
<span id="cb10-116"><a href="#cb10-116" aria-hidden="true" tabindex="-1"></a>   metadata<span class="ot">&lt;-</span> <span class="fu">bind_cols</span>(prjIDs, namestax[,<span class="dv">1</span><span class="sc">:</span><span class="dv">2</span>], taxonomized, otherSRA) <span class="sc">%&gt;%</span> </span>
<span id="cb10-117"><a href="#cb10-117" aria-hidden="true" tabindex="-1"></a>          <span class="fu">add_column</span>(<span class="at">.after =</span> <span class="dv">4</span>,<span class="at">sampleEnteredBy =</span> <span class="st">""</span>) <span class="sc">%&gt;%</span> </span>
<span id="cb10-118"><a href="#cb10-118" aria-hidden="true" tabindex="-1"></a>          <span class="fu">add_column</span>(<span class="at">.after =</span> <span class="dv">9</span>, <span class="at">locality =</span> <span class="st">""</span>, </span>
<span id="cb10-119"><a href="#cb10-119" aria-hidden="true" tabindex="-1"></a>                     <span class="at">decimalLatitude =</span> <span class="st">""</span>, <span class="at">decimalLongitude =</span> <span class="st">""</span>,                          </span>
<span id="cb10-120"><a href="#cb10-120" aria-hidden="true" tabindex="-1"></a>                    <span class="at">coordinateUncertaintyInMeters =</span> <span class="st">""</span>, <span class="at">country =</span> <span class="st">""</span>, </span>
<span id="cb10-121"><a href="#cb10-121" aria-hidden="true" tabindex="-1"></a>                    <span class="at">georeferenceProtocol =</span> <span class="st">""</span>,</span>
<span id="cb10-122"><a href="#cb10-122" aria-hidden="true" tabindex="-1"></a>                    <span class="at">habitat =</span> <span class="st">""</span>, <span class="at">microHabitat =</span> <span class="st">""</span>, <span class="at">environmental_medium =</span> <span class="st">""</span>,</span>
<span id="cb10-123"><a href="#cb10-123" aria-hidden="true" tabindex="-1"></a>                    <span class="at">yearCollected =</span> <span class="st">""</span>, <span class="at">monthCollected =</span> <span class="st">""</span>, <span class="at">dayCollected =</span> <span class="st">""</span>,</span>
<span id="cb10-124"><a href="#cb10-124" aria-hidden="true" tabindex="-1"></a>                    <span class="at">establishmentMeans =</span> <span class="st">""</span>,<span class="at">permitInformation =</span> <span class="st">""</span>, <span class="at">associatedReferences =</span> <span class="st">""</span>,</span>
<span id="cb10-125"><a href="#cb10-125" aria-hidden="true" tabindex="-1"></a>                    <span class="at">preservative =</span> <span class="st">""</span>, <span class="at">derivedGeneticDataType =</span> <span class="st">""</span>, <span class="at">derivedGeneticDataURI =</span> <span class="st">""</span>,</span>
<span id="cb10-126"><a href="#cb10-126" aria-hidden="true" tabindex="-1"></a>                    <span class="at">derivedDataGeneticDataFormat =</span> <span class="st">""</span>, </span>
<span id="cb10-127"><a href="#cb10-127" aria-hidden="true" tabindex="-1"></a>                    <span class="at">derivedDataGeneticFilename =</span> <span class="st">""</span>, <span class="at">derivedGeneticDataRemarks =</span> <span class="st">""</span>) <span class="sc">%&gt;%</span></span>
<span id="cb10-128"><a href="#cb10-128" aria-hidden="true" tabindex="-1"></a>                    <span class="fu">add_column</span>(<span class="at">.after =</span> <span class="dv">38</span>, <span class="at">lifeStage =</span> <span class="st">""</span>, <span class="at">sex =</span> <span class="st">""</span>, <span class="at">otherCatalogNumbers =</span> <span class="st">""</span>,</span>
<span id="cb10-129"><a href="#cb10-129" aria-hidden="true" tabindex="-1"></a>                      <span class="at">associatedMedia =</span> <span class="st">""</span>, <span class="at">samplingProtocol =</span> <span class="st">""</span>,  <span class="at">tissueType =</span> <span class="st">""</span>,</span>
<span id="cb10-130"><a href="#cb10-130" aria-hidden="true" tabindex="-1"></a>                      <span class="at">continentOcean =</span> <span class="st">""</span>, <span class="at">island =</span> <span class="st">""</span>, <span class="at">maximumDepthInMeters =</span> <span class="st">""</span>,</span>
<span id="cb10-131"><a href="#cb10-131" aria-hidden="true" tabindex="-1"></a>                      <span class="at">maximumElevationInMeters =</span> <span class="st">""</span>, <span class="at">minimumDepthInMeters =</span> <span class="st">""</span>, </span>
<span id="cb10-132"><a href="#cb10-132" aria-hidden="true" tabindex="-1"></a>                      <span class="at">minimumElevationInMeters =</span> <span class="st">""</span>,    <span class="at">stateProvince =</span> <span class="st">""</span>, <span class="at">landOwner =</span> <span class="st">""</span></span>
<span id="cb10-133"><a href="#cb10-133" aria-hidden="true" tabindex="-1"></a>                      )</span>
<span id="cb10-134"><a href="#cb10-134" aria-hidden="true" tabindex="-1"></a>     </span>
<span id="cb10-135"><a href="#cb10-135" aria-hidden="true" tabindex="-1"></a>          metadata <span class="ot">&lt;-</span> <span class="fu">add_column</span>(metadata,<span class="at">.before =</span> <span class="dv">1</span>,</span>
<span id="cb10-136"><a href="#cb10-136" aria-hidden="true" tabindex="-1"></a>                                 <span class="at">sheet_index =</span> <span class="fu">str_pad</span>(<span class="fu">row.names</span>(metadata),<span class="at">width=</span><span class="dv">4</span>,<span class="at">pad=</span><span class="st">"0"</span>))</span>
<span id="cb10-137"><a href="#cb10-137" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb10-138"><a href="#cb10-138" aria-hidden="true" tabindex="-1"></a>  skip_to_next <span class="ot">&lt;-</span> <span class="cn">FALSE</span></span>
<span id="cb10-139"><a href="#cb10-139" aria-hidden="true" tabindex="-1"></a>  try_try_again <span class="ot">&lt;-</span> <span class="cn">FALSE</span></span>
<span id="cb10-140"><a href="#cb10-140" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb10-141"><a href="#cb10-141" aria-hidden="true" tabindex="-1"></a>  <span class="fu">print</span>(<span class="st">"Writing Metadata"</span>)</span>
<span id="cb10-142"><a href="#cb10-142" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb10-143"><a href="#cb10-143" aria-hidden="true" tabindex="-1"></a>  <span class="fu">writeData</span>(<span class="at">wb =</span> cpprj, <span class="at">sheet =</span> <span class="st">"Samples"</span>, </span>
<span id="cb10-144"><a href="#cb10-144" aria-hidden="true" tabindex="-1"></a>            <span class="at">x =</span> metadata, <span class="at">startCol =</span> <span class="dv">1</span>, <span class="at">startRow =</span> <span class="dv">2</span>, <span class="at">colNames =</span> F )</span>
<span id="cb10-145"><a href="#cb10-145" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb10-146"><a href="#cb10-146" aria-hidden="true" tabindex="-1"></a>  <span class="fu">tryCatch</span>(</span>
<span id="cb10-147"><a href="#cb10-147" aria-hidden="true" tabindex="-1"></a>  <span class="fu">saveWorkbook</span>(<span class="at">wb =</span> cpprj, <span class="at">file =</span> <span class="fu">paste0</span>(path, index,<span class="st">"_"</span>,prj,<span class="st">".xlsx"</span>), <span class="at">overwrite =</span> <span class="cn">TRUE</span>), </span>
<span id="cb10-148"><a href="#cb10-148" aria-hidden="true" tabindex="-1"></a>            <span class="at">error =</span> <span class="cf">function</span>(e) { msg <span class="ot">&lt;-</span> <span class="fu">conditionMessage</span>(e)</span>
<span id="cb10-149"><a href="#cb10-149" aria-hidden="true" tabindex="-1"></a>                                  <span class="fu">write_csv</span>(<span class="fu">tibble</span>(index,<span class="st">"attempt_1"</span>,msg),</span>
<span id="cb10-150"><a href="#cb10-150" aria-hidden="true" tabindex="-1"></a>                                            <span class="st">"failed_excel.txt"</span>, <span class="at">append =</span> T)</span>
<span id="cb10-151"><a href="#cb10-151" aria-hidden="true" tabindex="-1"></a>                                  try_try_again <span class="ot">&lt;&lt;-</span> <span class="cn">TRUE</span></span>
<span id="cb10-152"><a href="#cb10-152" aria-hidden="true" tabindex="-1"></a>                                  }</span>
<span id="cb10-153"><a href="#cb10-153" aria-hidden="true" tabindex="-1"></a>            )</span>
<span id="cb10-154"><a href="#cb10-154" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb10-155"><a href="#cb10-155" aria-hidden="true" tabindex="-1"></a>  <span class="co">#apparently it works if you try it a second time....</span></span>
<span id="cb10-156"><a href="#cb10-156" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb10-157"><a href="#cb10-157" aria-hidden="true" tabindex="-1"></a>  <span class="cf">if</span>(try_try_again) {</span>
<span id="cb10-158"><a href="#cb10-158" aria-hidden="true" tabindex="-1"></a>                      <span class="fu">tryCatch</span>(</span>
<span id="cb10-159"><a href="#cb10-159" aria-hidden="true" tabindex="-1"></a>                        <span class="fu">saveWorkbook</span>(<span class="at">wb =</span> cpprj, <span class="at">file =</span> <span class="fu">paste0</span>(path, </span>
<span id="cb10-160"><a href="#cb10-160" aria-hidden="true" tabindex="-1"></a>                                                               index,<span class="st">"_"</span>,prj,<span class="st">".xlsx"</span>),</span>
<span id="cb10-161"><a href="#cb10-161" aria-hidden="true" tabindex="-1"></a>                                     <span class="at">overwrite =</span> <span class="cn">TRUE</span>), </span>
<span id="cb10-162"><a href="#cb10-162" aria-hidden="true" tabindex="-1"></a>                        </span>
<span id="cb10-163"><a href="#cb10-163" aria-hidden="true" tabindex="-1"></a>                                <span class="at">error =</span> <span class="cf">function</span>(e) { msg <span class="ot">&lt;-</span> <span class="fu">conditionMessage</span>(e)</span>
<span id="cb10-164"><a href="#cb10-164" aria-hidden="true" tabindex="-1"></a>                                  <span class="fu">write_csv</span>(<span class="fu">tibble</span>(index,<span class="st">"attempt_2"</span>,msg),</span>
<span id="cb10-165"><a href="#cb10-165" aria-hidden="true" tabindex="-1"></a>                                            <span class="st">"failed_excel.txt"</span>, <span class="at">append =</span> T)</span>
<span id="cb10-166"><a href="#cb10-166" aria-hidden="true" tabindex="-1"></a>                                  skip_to_next <span class="ot">&lt;&lt;-</span> <span class="cn">TRUE</span></span>
<span id="cb10-167"><a href="#cb10-167" aria-hidden="true" tabindex="-1"></a>                                  }</span>
<span id="cb10-168"><a href="#cb10-168" aria-hidden="true" tabindex="-1"></a>            ) </span>
<span id="cb10-169"><a href="#cb10-169" aria-hidden="true" tabindex="-1"></a>  }</span>
<span id="cb10-170"><a href="#cb10-170" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb10-171"><a href="#cb10-171" aria-hidden="true" tabindex="-1"></a>  <span class="cf">if</span>(skip_to_next) { <span class="cf">next</span> } </span>
<span id="cb10-172"><a href="#cb10-172" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb10-173"><a href="#cb10-173" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb10-174"><a href="#cb10-174" aria-hidden="true" tabindex="-1"></a>   </span>
<span id="cb10-175"><a href="#cb10-175" aria-hidden="true" tabindex="-1"></a>}</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</section>
</section>
<section id="change-ownership-of-drive-files" class="level1">
<h1>Change Ownership of Drive Files</h1>
<div class="cell">
<div class="sourceCode cell-code" id="cb11"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb11-1"><a href="#cb11-1" aria-hidden="true" tabindex="-1"></a>path <span class="ot">&lt;-</span> <span class="st">"GEOME_Datathon/Datathon_Working_Directory/BioProject_Tables/NonMarine_BioSample_Metadata/"</span></span>
<span id="cb11-2"><a href="#cb11-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb11-3"><a href="#cb11-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb11-4"><a href="#cb11-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb11-5"><a href="#cb11-5" aria-hidden="true" tabindex="-1"></a>nmls <span class="ot">&lt;-</span> <span class="fu">drive_ls</span>(path)</span>
<span id="cb11-6"><a href="#cb11-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb11-7"><a href="#cb11-7" aria-hidden="true" tabindex="-1"></a><span class="fu">drive_share</span>(<span class="at">file =</span> nmls, <span class="at">role =</span> <span class="st">"owner"</span>, <span class="at">type =</span> <span class="st">"user"</span>, <span class="at">emailAddress =</span> <span class="st">"eric.d.crandall@gmail.com"</span>, <span class="at">transferOwnership =</span> T )</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</section>
<section id="pull-out-author-lists-for-bioprojects-that-have-dois" class="level1">
<h1>Pull out Author lists for BioProjects that have DOI’s</h1>
<p>Cynthia and Rachel want to be able to see author lists for DivDiv projects to determine who is best to contact them.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb12"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb12-1"><a href="#cb12-1" aria-hidden="true" tabindex="-1"></a>marineSRA <span class="ot">&lt;-</span> <span class="fu">drive_get</span>(<span class="at">path =</span> <span class="st">"GEOME_Datathon/Datathon_Working_Directory/BioProject_Tables/Marine_SRA_BioProjects"</span>)</span>
<span id="cb12-2"><a href="#cb12-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb12-3"><a href="#cb12-3" aria-hidden="true" tabindex="-1"></a>dois <span class="ot">&lt;-</span> <span class="fu">range_read</span>(marineSRA, <span class="at">sheet =</span> <span class="st">"Marine_BioProjects"</span>, <span class="at">range =</span> <span class="st">"M:M"</span>)</span>
<span id="cb12-4"><a href="#cb12-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb12-5"><a href="#cb12-5" aria-hidden="true" tabindex="-1"></a><span class="co">#split each field on |, trim off whitespace and get the bib entry from the DOIs</span></span>
<span id="cb12-6"><a href="#cb12-6" aria-hidden="true" tabindex="-1"></a>refs <span class="ot">&lt;-</span> dois<span class="sc">$</span>Paper_Link <span class="sc">%&gt;%</span> <span class="fu">strsplit</span>(<span class="at">split  =</span> <span class="st">"</span><span class="sc">\\</span><span class="st">|"</span>) <span class="sc">%&gt;%</span> <span class="fu">map</span>(str_trim) <span class="sc">%&gt;%</span> <span class="fu">map</span>(GetBibEntryWithDOI) </span>
<span id="cb12-7"><a href="#cb12-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb12-8"><a href="#cb12-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb12-9"><a href="#cb12-9" aria-hidden="true" tabindex="-1"></a>authors <span class="ot">&lt;-</span> <span class="fu">map</span>(refs,<span class="cf">function</span>(x){<span class="fu">na.pass</span>(x<span class="sc">$</span>author)})</span>
<span id="cb12-10"><a href="#cb12-10" aria-hidden="true" tabindex="-1"></a>gs</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</section>
<section id="create-mail-merge" class="level1">
<h1>Create Mail Merge</h1>
<p>Just occurred to me that I can use a mail merge app with Google Sheets and Gmail to make this whole process easier! Going to modify the code above to pull down publication info for all papers with author contact flags.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb13"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb13-1"><a href="#cb13-1" aria-hidden="true" tabindex="-1"></a><span class="co">#authorize</span></span>
<span id="cb13-2"><a href="#cb13-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb13-3"><a href="#cb13-3" aria-hidden="true" tabindex="-1"></a><span class="co">#initialize an empty tibble</span></span>
<span id="cb13-4"><a href="#cb13-4" aria-hidden="true" tabindex="-1"></a>mailmerge <span class="ot">&lt;-</span> <span class="fu">tibble</span>(</span>
<span id="cb13-5"><a href="#cb13-5" aria-hidden="true" tabindex="-1"></a>  <span class="st">"ProjectIndex"</span><span class="ot">=</span> <span class="fu">character</span>(<span class="dv">0</span>),</span>
<span id="cb13-6"><a href="#cb13-6" aria-hidden="true" tabindex="-1"></a>  <span class="st">"BioProjectNumber"</span><span class="ot">=</span> <span class="fu">character</span>(<span class="dv">0</span>),</span>
<span id="cb13-7"><a href="#cb13-7" aria-hidden="true" tabindex="-1"></a>  <span class="st">"Email Address"</span><span class="ot">=</span> <span class="fu">character</span>(<span class="dv">0</span>),</span>
<span id="cb13-8"><a href="#cb13-8" aria-hidden="true" tabindex="-1"></a>  <span class="st">"AuthorHonorific"</span><span class="ot">=</span> <span class="fu">character</span>(<span class="dv">0</span>),</span>
<span id="cb13-9"><a href="#cb13-9" aria-hidden="true" tabindex="-1"></a>  <span class="st">"Author Names"</span> <span class="ot">=</span> <span class="fu">character</span>(<span class="dv">0</span>),</span>
<span id="cb13-10"><a href="#cb13-10" aria-hidden="true" tabindex="-1"></a>  <span class="st">"FirstAuthorName"</span><span class="ot">=</span> <span class="fu">character</span>(<span class="dv">0</span>),</span>
<span id="cb13-11"><a href="#cb13-11" aria-hidden="true" tabindex="-1"></a>  <span class="st">"Year"</span> <span class="ot">=</span> <span class="fu">character</span>(<span class="dv">0</span>),</span>
<span id="cb13-12"><a href="#cb13-12" aria-hidden="true" tabindex="-1"></a>  <span class="st">"ContactAuthorNames"</span><span class="ot">=</span> <span class="fu">character</span>(<span class="dv">0</span>),</span>
<span id="cb13-13"><a href="#cb13-13" aria-hidden="true" tabindex="-1"></a>  <span class="st">"References"</span> <span class="ot">=</span> <span class="fu">character</span>(<span class="dv">0</span>),</span>
<span id="cb13-14"><a href="#cb13-14" aria-hidden="true" tabindex="-1"></a>  <span class="st">"Paper_Comments"</span> <span class="ot">=</span> <span class="fu">character</span>(<span class="dv">0</span>),</span>
<span id="cb13-15"><a href="#cb13-15" aria-hidden="true" tabindex="-1"></a>  <span class="st">"AuthorContactComments"</span> <span class="ot">=</span> <span class="fu">character</span>(<span class="dv">0</span>),</span>
<span id="cb13-16"><a href="#cb13-16" aria-hidden="true" tabindex="-1"></a>  <span class="st">"Reason1"</span><span class="ot">=</span> <span class="fu">character</span>(<span class="dv">0</span>),</span>
<span id="cb13-17"><a href="#cb13-17" aria-hidden="true" tabindex="-1"></a>  <span class="st">"Reason2"</span><span class="ot">=</span> <span class="fu">character</span>(<span class="dv">0</span>),</span>
<span id="cb13-18"><a href="#cb13-18" aria-hidden="true" tabindex="-1"></a>  <span class="st">"GradStudent"</span><span class="ot">=</span> <span class="fu">character</span>(<span class="dv">0</span>),</span>
<span id="cb13-19"><a href="#cb13-19" aria-hidden="true" tabindex="-1"></a>  <span class="st">"GradStudentHonorific"</span><span class="ot">=</span> <span class="fu">character</span>(<span class="dv">0</span>),</span>
<span id="cb13-20"><a href="#cb13-20" aria-hidden="true" tabindex="-1"></a>  <span class="st">"GradStudentInstitution"</span><span class="ot">=</span> <span class="fu">character</span>(<span class="dv">0</span>),</span>
<span id="cb13-21"><a href="#cb13-21" aria-hidden="true" tabindex="-1"></a>  <span class="st">"GradStudentEmail"</span><span class="ot">=</span> <span class="fu">character</span>(<span class="dv">0</span>)</span>
<span id="cb13-22"><a href="#cb13-22" aria-hidden="true" tabindex="-1"></a>  )</span>
<span id="cb13-23"><a href="#cb13-23" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb13-24"><a href="#cb13-24" aria-hidden="true" tabindex="-1"></a>refs <span class="ot">&lt;-</span> <span class="fu">list</span>()</span>
<span id="cb13-25"><a href="#cb13-25" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb13-26"><a href="#cb13-26" aria-hidden="true" tabindex="-1"></a><span class="co">#get the object ids of the non-marine list and the participants list</span></span>
<span id="cb13-27"><a href="#cb13-27" aria-hidden="true" tabindex="-1"></a>nonmarineSRA_object <span class="ot">&lt;-</span> <span class="fu">drive_get</span>(<span class="at">path =</span></span>
<span id="cb13-28"><a href="#cb13-28" aria-hidden="true" tabindex="-1"></a>                                   <span class="st">"GEOME_Datathon/Datathon_Working_Directory/BioProject_Tables/nonMarine_SRA_BioProjects"</span>)</span>
<span id="cb13-29"><a href="#cb13-29" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb13-30"><a href="#cb13-30" aria-hidden="true" tabindex="-1"></a>participants_object <span class="ot">&lt;-</span> <span class="fu">drive_get</span>(<span class="at">path =</span></span>
<span id="cb13-31"><a href="#cb13-31" aria-hidden="true" tabindex="-1"></a>                                   <span class="st">"GEOME_Datathon/Participants/GEOME Datathon Application (Responses)"</span>)</span>
<span id="cb13-32"><a href="#cb13-32" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb13-33"><a href="#cb13-33" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb13-34"><a href="#cb13-34" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb13-35"><a href="#cb13-35" aria-hidden="true" tabindex="-1"></a><span class="co">#read in the data</span></span>
<span id="cb13-36"><a href="#cb13-36" aria-hidden="true" tabindex="-1"></a>nonmarineSRA <span class="ot">&lt;-</span> <span class="fu">range_read</span>(nonmarineSRA_object, <span class="at">sheet =</span> <span class="dv">1</span>, <span class="at">range =</span> <span class="st">"A:S"</span>)</span>
<span id="cb13-37"><a href="#cb13-37" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb13-38"><a href="#cb13-38" aria-hidden="true" tabindex="-1"></a>participants <span class="ot">&lt;-</span> <span class="fu">range_read</span>(participants_object, <span class="at">sheet =</span> <span class="dv">1</span>, <span class="at">range =</span> <span class="st">"A:F"</span>)</span>
<span id="cb13-39"><a href="#cb13-39" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb13-40"><a href="#cb13-40" aria-hidden="true" tabindex="-1"></a><span class="co">#winnow to just contact needed items that also have papers</span></span>
<span id="cb13-41"><a href="#cb13-41" aria-hidden="true" tabindex="-1"></a>nonmarineSRA_contacts <span class="ot">&lt;-</span> nonmarineSRA[<span class="fu">which</span>(nonmarineSRA<span class="sc">$</span>Authors_Contacted <span class="sc">==</span> <span class="st">"CONTACT NEEDED"</span> <span class="sc">&amp;</span> nonmarineSRA<span class="sc">$</span>Paper_Available <span class="sc">==</span> <span class="st">"FALSE"</span>),]</span>
<span id="cb13-42"><a href="#cb13-42" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb13-43"><a href="#cb13-43" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb13-44"><a href="#cb13-44" aria-hidden="true" tabindex="-1"></a><span class="co">#split each field on |, trim off whitespace and get the bib entry from the DOIs. If there are multiple DOIs, split again</span></span>
<span id="cb13-45"><a href="#cb13-45" aria-hidden="true" tabindex="-1"></a><span class="co"># for some reason it doesn't get some references the first time, so you need to run it again.</span></span>
<span id="cb13-46"><a href="#cb13-46" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb13-47"><a href="#cb13-47" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span>(p <span class="cf">in</span> nonmarineSRA_contacts<span class="sc">$</span>project_index)</span>
<span id="cb13-48"><a href="#cb13-48" aria-hidden="true" tabindex="-1"></a><span class="co">#for(p in names(refs)[which(refs=="NO RESULT")])</span></span>
<span id="cb13-49"><a href="#cb13-49" aria-hidden="true" tabindex="-1"></a>  {</span>
<span id="cb13-50"><a href="#cb13-50" aria-hidden="true" tabindex="-1"></a>  <span class="fu">print</span>(p)</span>
<span id="cb13-51"><a href="#cb13-51" aria-hidden="true" tabindex="-1"></a>  psplit <span class="ot">&lt;-</span>  nonmarineSRA_contacts<span class="sc">$</span>Paper_Link[<span class="fu">which</span>(nonmarineSRA_contacts<span class="sc">$</span>project_index <span class="sc">==</span> p)] <span class="sc">%&gt;%</span> </span>
<span id="cb13-52"><a href="#cb13-52" aria-hidden="true" tabindex="-1"></a>                <span class="fu">strsplit</span>(<span class="at">split  =</span> <span class="st">"</span><span class="sc">\\</span><span class="st">|"</span>)  <span class="sc">%&gt;%</span></span>
<span id="cb13-53"><a href="#cb13-53" aria-hidden="true" tabindex="-1"></a>                <span class="fu">map</span>(str_trim)</span>
<span id="cb13-54"><a href="#cb13-54" aria-hidden="true" tabindex="-1"></a>  <span class="fu">print</span>(psplit)</span>
<span id="cb13-55"><a href="#cb13-55" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb13-56"><a href="#cb13-56" aria-hidden="true" tabindex="-1"></a>  <span class="cf">if</span>(<span class="fu">length</span>(psplit[[<span class="dv">1</span>]]) <span class="sc">&gt;</span> <span class="dv">1</span>){</span>
<span id="cb13-57"><a href="#cb13-57" aria-hidden="true" tabindex="-1"></a>    multp <span class="ot">&lt;-</span> <span class="fu">map</span>(psplit, GetBibEntryWithDOI, <span class="at">temp.file =</span> <span class="st">"ref_temp.bib"</span>, <span class="at">delete.file =</span> F)</span>
<span id="cb13-58"><a href="#cb13-58" aria-hidden="true" tabindex="-1"></a>    pref <span class="ot">&lt;-</span> multp[[<span class="dv">1</span>]]</span>
<span id="cb13-59"><a href="#cb13-59" aria-hidden="true" tabindex="-1"></a>  }</span>
<span id="cb13-60"><a href="#cb13-60" aria-hidden="true" tabindex="-1"></a>  <span class="cf">else</span>{</span>
<span id="cb13-61"><a href="#cb13-61" aria-hidden="true" tabindex="-1"></a>    pref <span class="ot">&lt;-</span> <span class="fu">GetBibEntryWithDOI</span>(psplit,<span class="at">temp.file =</span> <span class="st">"ref_temp.bib"</span>, <span class="at">delete.file =</span> F)</span>
<span id="cb13-62"><a href="#cb13-62" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span>(<span class="fu">is.null</span>(pref<span class="sc">$</span>title)){</span>
<span id="cb13-63"><a href="#cb13-63" aria-hidden="true" tabindex="-1"></a>      pref <span class="ot">&lt;-</span> <span class="st">"NO RESULT"</span></span>
<span id="cb13-64"><a href="#cb13-64" aria-hidden="true" tabindex="-1"></a>    }</span>
<span id="cb13-65"><a href="#cb13-65" aria-hidden="true" tabindex="-1"></a>  }</span>
<span id="cb13-66"><a href="#cb13-66" aria-hidden="true" tabindex="-1"></a>  refs[[p]] <span class="ot">&lt;-</span> pref</span>
<span id="cb13-67"><a href="#cb13-67" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb13-68"><a href="#cb13-68" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb13-69"><a href="#cb13-69" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb13-70"><a href="#cb13-70" aria-hidden="true" tabindex="-1"></a><span class="co"># now to populate the data frame</span></span>
<span id="cb13-71"><a href="#cb13-71" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb13-72"><a href="#cb13-72" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span>(p <span class="cf">in</span> <span class="fu">names</span>(refs)){</span>
<span id="cb13-73"><a href="#cb13-73" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb13-74"><a href="#cb13-74" aria-hidden="true" tabindex="-1"></a>  <span class="fu">print</span>(p)</span>
<span id="cb13-75"><a href="#cb13-75" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb13-76"><a href="#cb13-76" aria-hidden="true" tabindex="-1"></a>  r <span class="ot">&lt;-</span> refs[p][[<span class="dv">1</span>]]</span>
<span id="cb13-77"><a href="#cb13-77" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb13-78"><a href="#cb13-78" aria-hidden="true" tabindex="-1"></a>   <span class="co">#look up the student</span></span>
<span id="cb13-79"><a href="#cb13-79" aria-hidden="true" tabindex="-1"></a>  student <span class="ot">&lt;-</span> nonmarineSRA_contacts<span class="sc">$</span>Metadata_Curator[<span class="fu">which</span>(nonmarineSRA_contacts<span class="sc">$</span>project_index <span class="sc">==</span> p)]</span>
<span id="cb13-80"><a href="#cb13-80" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb13-81"><a href="#cb13-81" aria-hidden="true" tabindex="-1"></a>  honorific <span class="ot">&lt;-</span> participants<span class="sc">$</span><span class="st">`</span><span class="at">Honorific</span><span class="st">`</span>[<span class="fu">which</span>(participants<span class="sc">$</span><span class="st">`</span><span class="at">Last Name</span><span class="st">`</span><span class="sc">==</span><span class="fu">str_split</span>(student,<span class="st">" "</span>)[[<span class="dv">1</span>]][<span class="dv">2</span>])]</span>
<span id="cb13-82"><a href="#cb13-82" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb13-83"><a href="#cb13-83" aria-hidden="true" tabindex="-1"></a>  student_institution <span class="ot">&lt;-</span> participants<span class="sc">$</span><span class="st">`</span><span class="at">University that will award your degree</span><span class="st">`</span>[<span class="fu">which</span>(participants<span class="sc">$</span><span class="st">`</span><span class="at">Last Name</span><span class="st">`</span><span class="sc">==</span><span class="fu">str_split</span>(student,<span class="st">" "</span>)[[<span class="dv">1</span>]][<span class="dv">2</span>])]</span>
<span id="cb13-84"><a href="#cb13-84" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb13-85"><a href="#cb13-85" aria-hidden="true" tabindex="-1"></a>  grad_student_email <span class="ot">&lt;-</span> participants<span class="sc">$</span><span class="st">`</span><span class="at">Email Address</span><span class="st">`</span>[<span class="fu">which</span>(participants<span class="sc">$</span><span class="st">`</span><span class="at">Last Name</span><span class="st">`</span><span class="sc">==</span><span class="fu">str_split</span>(student,<span class="st">" "</span>)[[<span class="dv">1</span>]][<span class="dv">2</span>])]</span>
<span id="cb13-86"><a href="#cb13-86" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb13-87"><a href="#cb13-87" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb13-88"><a href="#cb13-88" aria-hidden="true" tabindex="-1"></a>   <span class="co">#look up the project number and other items</span></span>
<span id="cb13-89"><a href="#cb13-89" aria-hidden="true" tabindex="-1"></a>   bioprj <span class="ot">&lt;-</span> nonmarineSRA_contacts<span class="sc">$</span>project_acc_bioprj[<span class="fu">which</span>(nonmarineSRA_contacts<span class="sc">$</span>project_index <span class="sc">==</span> p)]</span>
<span id="cb13-90"><a href="#cb13-90" aria-hidden="true" tabindex="-1"></a>   paperComments <span class="ot">&lt;-</span> nonmarineSRA_contacts<span class="sc">$</span>Paper_Comments[<span class="fu">which</span>(nonmarineSRA_contacts<span class="sc">$</span>project_index <span class="sc">==</span> p)]</span>
<span id="cb13-91"><a href="#cb13-91" aria-hidden="true" tabindex="-1"></a>   authorContactComments <span class="ot">&lt;-</span> nonmarineSRA_contacts<span class="sc">$</span>Author_Contact_Comments[<span class="fu">which</span>(nonmarineSRA_contacts<span class="sc">$</span>project_index <span class="sc">==</span> p)]</span>
<span id="cb13-92"><a href="#cb13-92" aria-hidden="true" tabindex="-1"></a>   </span>
<span id="cb13-93"><a href="#cb13-93" aria-hidden="true" tabindex="-1"></a>   <span class="cf">if</span>(refs[p] <span class="sc">==</span> <span class="st">"NO RESULT"</span>){</span>
<span id="cb13-94"><a href="#cb13-94" aria-hidden="true" tabindex="-1"></a>    mailinfo <span class="ot">&lt;-</span> <span class="fu">c</span>(</span>
<span id="cb13-95"><a href="#cb13-95" aria-hidden="true" tabindex="-1"></a>  <span class="st">"ProjectIndex"</span><span class="ot">=</span> p,</span>
<span id="cb13-96"><a href="#cb13-96" aria-hidden="true" tabindex="-1"></a>  <span class="st">"BioProjectNumber"</span><span class="ot">=</span> bioprj,</span>
<span id="cb13-97"><a href="#cb13-97" aria-hidden="true" tabindex="-1"></a>  <span class="st">"Email Address"</span><span class="ot">=</span> <span class="st">""</span>,</span>
<span id="cb13-98"><a href="#cb13-98" aria-hidden="true" tabindex="-1"></a>  <span class="st">"AuthorHonorific"</span><span class="ot">=</span> <span class="st">"Dr."</span>,</span>
<span id="cb13-99"><a href="#cb13-99" aria-hidden="true" tabindex="-1"></a>  <span class="st">"Author Names"</span> <span class="ot">=</span> <span class="st">""</span>,</span>
<span id="cb13-100"><a href="#cb13-100" aria-hidden="true" tabindex="-1"></a>  <span class="st">"FirstAuthorName"</span><span class="ot">=</span> <span class="st">""</span>,</span>
<span id="cb13-101"><a href="#cb13-101" aria-hidden="true" tabindex="-1"></a>  <span class="st">"Year"</span> <span class="ot">=</span> <span class="st">""</span>,</span>
<span id="cb13-102"><a href="#cb13-102" aria-hidden="true" tabindex="-1"></a>  <span class="st">"ContactAuthorNames"</span><span class="ot">=</span> <span class="st">""</span>,</span>
<span id="cb13-103"><a href="#cb13-103" aria-hidden="true" tabindex="-1"></a>  <span class="st">"References"</span> <span class="ot">=</span> <span class="st">""</span>,</span>
<span id="cb13-104"><a href="#cb13-104" aria-hidden="true" tabindex="-1"></a>  <span class="st">"Paper_Comments"</span> <span class="ot">=</span> paperComments,</span>
<span id="cb13-105"><a href="#cb13-105" aria-hidden="true" tabindex="-1"></a>  <span class="st">"AuthorContactComments"</span> <span class="ot">=</span> authorContactComments,</span>
<span id="cb13-106"><a href="#cb13-106" aria-hidden="true" tabindex="-1"></a>  <span class="st">"Reason1"</span><span class="ot">=</span> <span class="st">""</span>,</span>
<span id="cb13-107"><a href="#cb13-107" aria-hidden="true" tabindex="-1"></a>  <span class="st">"Reason2"</span><span class="ot">=</span> <span class="st">""</span>,</span>
<span id="cb13-108"><a href="#cb13-108" aria-hidden="true" tabindex="-1"></a>  <span class="st">"GradStudent"</span><span class="ot">=</span> student,</span>
<span id="cb13-109"><a href="#cb13-109" aria-hidden="true" tabindex="-1"></a>  <span class="st">"GradStudentHonorific"</span><span class="ot">=</span> honorific,</span>
<span id="cb13-110"><a href="#cb13-110" aria-hidden="true" tabindex="-1"></a>  <span class="st">"GradStudentInstitution"</span><span class="ot">=</span> student_institution,</span>
<span id="cb13-111"><a href="#cb13-111" aria-hidden="true" tabindex="-1"></a>  <span class="st">"GradStudentEmail"</span><span class="ot">=</span> participants<span class="sc">$</span><span class="st">`</span><span class="at">Email Address</span><span class="st">`</span>[<span class="fu">which</span>(participants<span class="sc">$</span><span class="st">`</span><span class="at">Last Name</span><span class="st">`</span><span class="sc">==</span><span class="fu">str_split</span>(student,<span class="st">" "</span>)[[<span class="dv">1</span>]][<span class="dv">2</span>])]</span>
<span id="cb13-112"><a href="#cb13-112" aria-hidden="true" tabindex="-1"></a>  )</span>
<span id="cb13-113"><a href="#cb13-113" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb13-114"><a href="#cb13-114" aria-hidden="true" tabindex="-1"></a>  mailmerge <span class="ot">&lt;-</span> <span class="fu">bind_rows</span>(mailmerge, mailinfo)</span>
<span id="cb13-115"><a href="#cb13-115" aria-hidden="true" tabindex="-1"></a>  <span class="cf">next</span></span>
<span id="cb13-116"><a href="#cb13-116" aria-hidden="true" tabindex="-1"></a>   }</span>
<span id="cb13-117"><a href="#cb13-117" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb13-118"><a href="#cb13-118" aria-hidden="true" tabindex="-1"></a> </span>
<span id="cb13-119"><a href="#cb13-119" aria-hidden="true" tabindex="-1"></a>  <span class="co">#look up the first author name</span></span>
<span id="cb13-120"><a href="#cb13-120" aria-hidden="true" tabindex="-1"></a>  firstauth <span class="ot">&lt;-</span> <span class="fu">str_split</span>(r<span class="sc">$</span>author[<span class="dv">1</span>], <span class="st">" "</span>)[[<span class="dv">1</span>]]</span>
<span id="cb13-121"><a href="#cb13-121" aria-hidden="true" tabindex="-1"></a>  firstauth_last <span class="ot">&lt;-</span> firstauth[<span class="fu">length</span>(firstauth)]</span>
<span id="cb13-122"><a href="#cb13-122" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb13-123"><a href="#cb13-123" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb13-124"><a href="#cb13-124" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb13-125"><a href="#cb13-125" aria-hidden="true" tabindex="-1"></a>  mailinfo <span class="ot">&lt;-</span> <span class="fu">c</span>(</span>
<span id="cb13-126"><a href="#cb13-126" aria-hidden="true" tabindex="-1"></a>  <span class="st">"ProjectIndex"</span><span class="ot">=</span> p,</span>
<span id="cb13-127"><a href="#cb13-127" aria-hidden="true" tabindex="-1"></a>  <span class="st">"BioProjectNumber"</span><span class="ot">=</span> bioprj,</span>
<span id="cb13-128"><a href="#cb13-128" aria-hidden="true" tabindex="-1"></a>  <span class="st">"Email Address"</span><span class="ot">=</span> <span class="st">""</span>,</span>
<span id="cb13-129"><a href="#cb13-129" aria-hidden="true" tabindex="-1"></a>  <span class="st">"AuthorHonorific"</span><span class="ot">=</span> <span class="st">"Dr."</span>,</span>
<span id="cb13-130"><a href="#cb13-130" aria-hidden="true" tabindex="-1"></a>  <span class="st">"Author Names"</span> <span class="ot">=</span> <span class="fu">str_flatten</span>(<span class="fu">capture.output</span>(r<span class="sc">$</span>author), <span class="at">collapse =</span> <span class="st">","</span>),</span>
<span id="cb13-131"><a href="#cb13-131" aria-hidden="true" tabindex="-1"></a>  <span class="st">"FirstAuthorName"</span><span class="ot">=</span> firstauth_last,</span>
<span id="cb13-132"><a href="#cb13-132" aria-hidden="true" tabindex="-1"></a>  <span class="st">"Year"</span> <span class="ot">=</span> r<span class="sc">$</span>year,</span>
<span id="cb13-133"><a href="#cb13-133" aria-hidden="true" tabindex="-1"></a>  <span class="st">"ContactAuthorNames"</span><span class="ot">=</span> <span class="st">""</span>,</span>
<span id="cb13-134"><a href="#cb13-134" aria-hidden="true" tabindex="-1"></a>  <span class="st">"References"</span> <span class="ot">=</span> <span class="fu">str_flatten</span>(<span class="fu">capture.output</span>(r)),</span>
<span id="cb13-135"><a href="#cb13-135" aria-hidden="true" tabindex="-1"></a>  <span class="st">"Paper_Comments"</span> <span class="ot">=</span> paperComments,</span>
<span id="cb13-136"><a href="#cb13-136" aria-hidden="true" tabindex="-1"></a>  <span class="st">"AuthorContactComments"</span> <span class="ot">=</span> authorContactComments,</span>
<span id="cb13-137"><a href="#cb13-137" aria-hidden="true" tabindex="-1"></a>  <span class="st">"Reason1"</span><span class="ot">=</span> <span class="st">""</span>,</span>
<span id="cb13-138"><a href="#cb13-138" aria-hidden="true" tabindex="-1"></a>  <span class="st">"Reason2"</span><span class="ot">=</span> <span class="st">""</span>,</span>
<span id="cb13-139"><a href="#cb13-139" aria-hidden="true" tabindex="-1"></a>  <span class="st">"GradStudent"</span><span class="ot">=</span> student,</span>
<span id="cb13-140"><a href="#cb13-140" aria-hidden="true" tabindex="-1"></a>  <span class="st">"GradStudentHonorific"</span><span class="ot">=</span> honorific,</span>
<span id="cb13-141"><a href="#cb13-141" aria-hidden="true" tabindex="-1"></a>  <span class="st">"GradStudentInstitution"</span><span class="ot">=</span> student_institution,</span>
<span id="cb13-142"><a href="#cb13-142" aria-hidden="true" tabindex="-1"></a>  <span class="st">"GradStudentEmail"</span><span class="ot">=</span> grad_student_email</span>
<span id="cb13-143"><a href="#cb13-143" aria-hidden="true" tabindex="-1"></a>  )</span>
<span id="cb13-144"><a href="#cb13-144" aria-hidden="true" tabindex="-1"></a>   </span>
<span id="cb13-145"><a href="#cb13-145" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb13-146"><a href="#cb13-146" aria-hidden="true" tabindex="-1"></a>  mailmerge <span class="ot">&lt;-</span> <span class="fu">bind_rows</span>(mailmerge, mailinfo)</span>
<span id="cb13-147"><a href="#cb13-147" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb13-148"><a href="#cb13-148" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb13-149"><a href="#cb13-149" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb13-150"><a href="#cb13-150" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb13-151"><a href="#cb13-151" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb13-152"><a href="#cb13-152" aria-hidden="true" tabindex="-1"></a>mailmerge_old<span class="ot">&lt;-</span><span class="fu">read.csv</span>(<span class="st">"/Users/eric/Google_Drive/GEOME_Datathon/Code/mailmerge_01082021.csv"</span>)</span>
<span id="cb13-153"><a href="#cb13-153" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb13-154"><a href="#cb13-154" aria-hidden="true" tabindex="-1"></a><span class="co">#mailmerge_new&lt;-mailmerge[mailmerge$ProjectIndex %in% setdiff(mailmerge$ProjectIndex,mailmerge_old$ProjectIndex),]</span></span>
<span id="cb13-155"><a href="#cb13-155" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb13-156"><a href="#cb13-156" aria-hidden="true" tabindex="-1"></a><span class="fu">write_excel_csv</span>(mailmerge,<span class="st">"/Users/eric/Google_Drive/GEOME_Datathon/Code/mailmerge_01032021.csv"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</section>
<section id="non-wild-species" class="level1">
<h1>Non-Wild Species</h1>
<p>Human Pathogens, Model organisms and Domesticated Species oh my!</p>
<p>After creating a preliminary figure of metadata available in the SRA , Rachel and I discussed that we definitely want to pull model organisms and lab stocks and might also want to pull domesticated species out, so I’m now trying to make a list of these species</p>
<section id="species-identified-by-students" class="level2">
<h2 class="anchored" data-anchor-id="species-identified-by-students">Species identified by students</h2>
<p>Students determined relevance for &gt;1500 projects and put the non-relevant ones into categories, so that provides a starting place.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb14"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb14-1"><a href="#cb14-1" aria-hidden="true" tabindex="-1"></a>droplists <span class="ot">&lt;-</span> <span class="fu">read.csv</span>(<span class="st">"NonWildSpecies/raw_student_generated_drop_lists.csv"</span>)</span>
<span id="cb14-2"><a href="#cb14-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb14-3"><a href="#cb14-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb14-4"><a href="#cb14-4" aria-hidden="true" tabindex="-1"></a>droplists<span class="sc">$</span>Student_HumPath <span class="sc">%&gt;%</span> <span class="fu">str_sort</span>() <span class="sc">%&gt;%</span> <span class="fu">unique</span>()</span>
<span id="cb14-5"><a href="#cb14-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb14-6"><a href="#cb14-6" aria-hidden="true" tabindex="-1"></a>dom <span class="ot">&lt;-</span> <span class="fu">sort</span>(<span class="fu">unique</span>(droplists<span class="sc">$</span>Student_Domesticated[droplists<span class="sc">$</span>Student_Domesticated <span class="sc">!=</span> <span class="st">""</span> ]))</span>
<span id="cb14-7"><a href="#cb14-7" aria-hidden="true" tabindex="-1"></a>dom_common <span class="ot">&lt;-</span> <span class="fu">sci2comm</span>(dom, <span class="at">db =</span> <span class="st">"itis"</span>)</span>
<span id="cb14-8"><a href="#cb14-8" aria-hidden="true" tabindex="-1"></a>dom_common <span class="ot">&lt;-</span>  <span class="fu">paste</span>(<span class="fu">lapply</span>(dom_common,<span class="cf">function</span>(x) <span class="cf">if</span>(<span class="fu">identical</span>(x, <span class="fu">character</span>(<span class="dv">0</span>))) <span class="cn">NA_character_</span> <span class="cf">else</span> x),<span class="at">sep=</span><span class="st">","</span>)</span>
<span id="cb14-9"><a href="#cb14-9" aria-hidden="true" tabindex="-1"></a>domesticated <span class="ot">&lt;-</span> <span class="fu">cbind</span>(dom,dom_common)</span>
<span id="cb14-10"><a href="#cb14-10" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb14-11"><a href="#cb14-11" aria-hidden="true" tabindex="-1"></a>humpath <span class="ot">&lt;-</span> <span class="fu">sort</span>(<span class="fu">unique</span>(droplists<span class="sc">$</span>Student_HumPath[droplists<span class="sc">$</span>Student_HumPath <span class="sc">!=</span> <span class="st">""</span> ]))</span>
<span id="cb14-12"><a href="#cb14-12" aria-hidden="true" tabindex="-1"></a>humpath_common <span class="ot">&lt;-</span> <span class="fu">sci2comm</span>(humpath, <span class="at">db =</span> <span class="st">"itis"</span>)</span>
<span id="cb14-13"><a href="#cb14-13" aria-hidden="true" tabindex="-1"></a>humpath_common <span class="ot">&lt;-</span>  <span class="fu">paste</span>(<span class="fu">lapply</span>(humpath_common,<span class="cf">function</span>(x) <span class="cf">if</span>(<span class="fu">identical</span>(x, <span class="fu">character</span>(<span class="dv">0</span>))) <span class="cn">NA_character_</span> <span class="cf">else</span> x),<span class="at">sep=</span><span class="st">","</span>)</span>
<span id="cb14-14"><a href="#cb14-14" aria-hidden="true" tabindex="-1"></a>humanPathogen <span class="ot">&lt;-</span> <span class="fu">cbind</span>(humpath,humpath_common)</span>
<span id="cb14-15"><a href="#cb14-15" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb14-16"><a href="#cb14-16" aria-hidden="true" tabindex="-1"></a>lab <span class="ot">&lt;-</span> <span class="fu">sort</span>(<span class="fu">unique</span>(droplists<span class="sc">$</span>Student_Lab[droplists<span class="sc">$</span>Student_Lab <span class="sc">!=</span> <span class="st">""</span> ]))</span>
<span id="cb14-17"><a href="#cb14-17" aria-hidden="true" tabindex="-1"></a>lab_common <span class="ot">&lt;-</span> <span class="fu">sci2comm</span>(lab, <span class="at">db =</span> <span class="st">"itis"</span>)</span>
<span id="cb14-18"><a href="#cb14-18" aria-hidden="true" tabindex="-1"></a>lab_common <span class="ot">&lt;-</span>  <span class="fu">paste</span>(<span class="fu">lapply</span>(lab_common,<span class="cf">function</span>(x) <span class="cf">if</span>(<span class="fu">identical</span>(x, <span class="fu">character</span>(<span class="dv">0</span>))) <span class="cn">NA_character_</span> <span class="cf">else</span> x),<span class="at">sep=</span><span class="st">","</span>)</span>
<span id="cb14-19"><a href="#cb14-19" aria-hidden="true" tabindex="-1"></a>labSpecies <span class="ot">&lt;-</span> <span class="fu">cbind</span>(lab,lab_common)</span>
<span id="cb14-20"><a href="#cb14-20" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb14-21"><a href="#cb14-21" aria-hidden="true" tabindex="-1"></a><span class="fu">write.csv</span>(domesticated,<span class="st">"NonWildSpecies/domesticated_students_taxized.csv"</span>, <span class="at">row.names =</span> F, <span class="at">quote =</span> F)</span>
<span id="cb14-22"><a href="#cb14-22" aria-hidden="true" tabindex="-1"></a><span class="fu">write.csv</span>(humanPathogen,<span class="st">"NonWildSpecies/humanPathogen_students_taxized.csv"</span>, <span class="at">row.names =</span> F, <span class="at">quote =</span> F)</span>
<span id="cb14-23"><a href="#cb14-23" aria-hidden="true" tabindex="-1"></a><span class="fu">write.csv</span>(labSpecies,<span class="st">"NonWildSpecies/labSpecies_students_taxized.csv"</span>, <span class="at">row.names =</span> F, <span class="at">quote =</span> F)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>Now I’m going to scrape some lists from the web. I pulled in data from:</p>
<ul>
<li><a href="http://www.fao.org/faostat/en/#data/QC">FAOSTAT</a> for crop plants, FAO Domesticated Animal Diversity Information System</li>
<li><a href="http://www.fao.org/dad-is/en/">DAD-IS</a> for animals.</li>
<li><a href="http://www.fao.org/es/faodef/fdef01e.htm">FAO List of Cereal</a> - Downloaded into domesticatedPlants_Wikipedia_Cereals_Other.csv</li>
<li><a href="https://en.wikipedia.org/wiki/List_of_infectious_diseases">Wikipedia List of Infectious Diseases</a> for human pathogens</li>
<li><a href="https://en.wikipedia.org/wiki/List_of_domesticated_animals">Wikipedia List of Domesticated Animals</a></li>
<li><a href="https://en.wikipedia.org/wiki/List_of_culinary_fruits">Wikipedia List of Fruits</a></li>
<li><a href="https://en.wikipedia.org/wiki/List_of_domesticated_plants">Wikipedia List of Domesticated Plants</a> Manually copied extras into domesticatedPlants_Wikipedia_Cereals_Other.csv</li>
<li><a href="https://en.wikipedia.org/wiki/List_of_model_organisms">Wikipedia List of Model Organisms</a></li>
</ul>
</section>
<section id="human-pathogens" class="level2">
<h2 class="anchored" data-anchor-id="human-pathogens">Human Pathogens</h2>
<div class="cell">
<div class="sourceCode cell-code" id="cb15"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb15-1"><a href="#cb15-1" aria-hidden="true" tabindex="-1"></a><span class="co">#nifty code from Hadley to read in htmls tables</span></span>
<span id="cb15-2"><a href="#cb15-2" aria-hidden="true" tabindex="-1"></a>disease_html <span class="ot">&lt;-</span> <span class="fu">read_html</span>(<span class="st">"https://en.wikipedia.org/wiki/List_of_infectious_diseases"</span>)</span>
<span id="cb15-3"><a href="#cb15-3" aria-hidden="true" tabindex="-1"></a>diseases <span class="ot">&lt;-</span> disease_html <span class="sc">%&gt;%</span> <span class="fu">html_node</span>(<span class="st">"table"</span>) <span class="sc">%&gt;%</span> <span class="fu">html_table</span>()</span>
<span id="cb15-4"><a href="#cb15-4" aria-hidden="true" tabindex="-1"></a>diseases<span class="sc">$</span><span class="st">`</span><span class="at">Infectious agent</span><span class="st">`</span> <span class="ot">&lt;-</span> <span class="fu">str_remove</span>(diseases<span class="sc">$</span><span class="st">`</span><span class="at">Infectious agent</span><span class="st">`</span>,<span class="st">"usually "</span>) <span class="sc">%&gt;%</span> </span>
<span id="cb15-5"><a href="#cb15-5" aria-hidden="true" tabindex="-1"></a>                                              <span class="fu">str_remove</span>(<span class="st">"most "</span>) <span class="sc">%&gt;%</span> </span>
<span id="cb15-6"><a href="#cb15-6" aria-hidden="true" tabindex="-1"></a>                                              <span class="fu">str_remove</span>(<span class="st">"commonly "</span>)  <span class="sc">%&gt;%</span> </span>
<span id="cb15-7"><a href="#cb15-7" aria-hidden="true" tabindex="-1"></a>                                              <span class="fu">str_remove</span>(<span class="st">"Group A "</span>)  <span class="sc">%&gt;%</span> </span>
<span id="cb15-8"><a href="#cb15-8" aria-hidden="true" tabindex="-1"></a>                                              <span class="fu">str_remove</span>(<span class="st">"multiple "</span>) <span class="sc">%&gt;%</span></span>
<span id="cb15-9"><a href="#cb15-9" aria-hidden="true" tabindex="-1"></a>                                              <span class="fu">str_remove</span>(<span class="fu">regex</span>(<span class="st">"</span><span class="sc">\\</span><span class="st">(.+</span><span class="sc">\\</span><span class="st">)"</span>))</span>
<span id="cb15-10"><a href="#cb15-10" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb15-11"><a href="#cb15-11" aria-hidden="true" tabindex="-1"></a><span class="co">#need to find the kingdom so we can weed out the bacteria</span></span>
<span id="cb15-12"><a href="#cb15-12" aria-hidden="true" tabindex="-1"></a>kingdoms <span class="ot">&lt;-</span> <span class="fu">tax_name</span>(diseases<span class="sc">$</span><span class="st">`</span><span class="at">Infectious agent</span><span class="st">`</span>, <span class="at">get =</span> <span class="st">"kingdom"</span>)</span>
<span id="cb15-13"><a href="#cb15-13" aria-hidden="true" tabindex="-1"></a>diseases <span class="ot">&lt;-</span> <span class="fu">cbind</span>(diseases,kingdoms)</span>
<span id="cb15-14"><a href="#cb15-14" aria-hidden="true" tabindex="-1"></a>diseases <span class="ot">&lt;-</span> diseases[<span class="sc">-</span><span class="fu">grep</span>(<span class="at">x =</span> diseases<span class="sc">$</span>kingdom,<span class="at">pattern =</span> <span class="st">"Bacteria"</span>),]</span>
<span id="cb15-15"><a href="#cb15-15" aria-hidden="true" tabindex="-1"></a><span class="co"># and viruses</span></span>
<span id="cb15-16"><a href="#cb15-16" aria-hidden="true" tabindex="-1"></a>diseases <span class="ot">&lt;-</span> diseases[<span class="sc">-</span><span class="fu">grep</span>(<span class="at">x =</span> diseases<span class="sc">$</span><span class="st">`</span><span class="at">Infectious agent</span><span class="st">`</span>,<span class="at">pattern =</span> <span class="st">"vir[iu]"</span>,<span class="at">ignore.case =</span> T, <span class="at">perl =</span> T),]</span>
<span id="cb15-17"><a href="#cb15-17" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb15-18"><a href="#cb15-18" aria-hidden="true" tabindex="-1"></a><span class="co">#write.csv(diseases, "humanPathogen_wikipedia_diseases_kingdoms.csv", row.names = F, quote = F)</span></span>
<span id="cb15-19"><a href="#cb15-19" aria-hidden="true" tabindex="-1"></a><span class="fu">write.table</span>(diseases, <span class="st">"NonWildSpecies/humanPathogen_wikipedia_diseases_eukaryotes.tsv"</span>, <span class="at">row.names =</span> F, <span class="at">quote =</span> F, <span class="at">sep =</span> <span class="st">"</span><span class="sc">\t</span><span class="st">"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</section>
<section id="domesticated-species" class="level2">
<h2 class="anchored" data-anchor-id="domesticated-species">Domesticated Species</h2>
<section id="animals" class="level3">
<h3 class="anchored" data-anchor-id="animals">Animals</h3>
<div class="cell">
<div class="sourceCode cell-code" id="cb16"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb16-1"><a href="#cb16-1" aria-hidden="true" tabindex="-1"></a><span class="co"># These FAO lists didn't work because its damn near impossible to go from common to Linnaean name programatically</span></span>
<span id="cb16-2"><a href="#cb16-2" aria-hidden="true" tabindex="-1"></a><span class="co">#animals &lt;- read.csv("FAO_DomesticAnimalDiversitySystem.csv", row.names = F)</span></span>
<span id="cb16-3"><a href="#cb16-3" aria-hidden="true" tabindex="-1"></a><span class="co">#animals_common &lt;- sort(unique(animals$ISO3))</span></span>
<span id="cb16-4"><a href="#cb16-4" aria-hidden="true" tabindex="-1"></a><span class="co">#animals_linnaean2 &lt;- comm2sci(animals_common, db = "itis")</span></span>
<span id="cb16-5"><a href="#cb16-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb16-6"><a href="#cb16-6" aria-hidden="true" tabindex="-1"></a><span class="co">#plants &lt;- read.csv("FAOSTAT_data_1-21-2021_crops.csv")</span></span>
<span id="cb16-7"><a href="#cb16-7" aria-hidden="true" tabindex="-1"></a><span class="co">#plants_common &lt;- sort(unique(plants$Item))</span></span>
<span id="cb16-8"><a href="#cb16-8" aria-hidden="true" tabindex="-1"></a><span class="co">#plants_linnaean &lt;- comm2sci(plants_common, db = "itis")</span></span>
<span id="cb16-9"><a href="#cb16-9" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb16-10"><a href="#cb16-10" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb16-11"><a href="#cb16-11" aria-hidden="true" tabindex="-1"></a>animal_html <span class="ot">&lt;-</span> <span class="fu">read_html</span>(<span class="st">"https://en.wikipedia.org/wiki/List_of_domesticated_animals"</span>)</span>
<span id="cb16-12"><a href="#cb16-12" aria-hidden="true" tabindex="-1"></a>animals <span class="ot">&lt;-</span> animal_html <span class="sc">%&gt;%</span> <span class="fu">html_node</span>(<span class="st">"table"</span>) <span class="sc">%&gt;%</span> <span class="fu">html_table</span>()</span>
<span id="cb16-13"><a href="#cb16-13" aria-hidden="true" tabindex="-1"></a>animals_linnaean <span class="ot">&lt;-</span> <span class="fu">str_extract</span>(animals<span class="sc">$</span><span class="st">`</span><span class="at">Species and subspecies</span><span class="st">`</span>, <span class="fu">regex</span>(<span class="st">"</span><span class="sc">\\</span><span class="st">((.+)</span><span class="sc">\\</span><span class="st">)"</span>)) <span class="sc">%&gt;%</span> <span class="fu">str_extract</span>(<span class="fu">regex</span>(<span class="st">"[:alpha:]+ [:alpha:]+"</span>))</span>
<span id="cb16-14"><a href="#cb16-14" aria-hidden="true" tabindex="-1"></a>animals<span class="ot">&lt;-</span><span class="fu">cbind</span>(animals_linnaean, animals)</span>
<span id="cb16-15"><a href="#cb16-15" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb16-16"><a href="#cb16-16" aria-hidden="true" tabindex="-1"></a><span class="fu">write.csv</span>(animals, <span class="st">"NonWildSpecies/domesticatedAnimals_wikipedia.csv"</span>, <span class="at">row.names =</span> F)</span>
<span id="cb16-17"><a href="#cb16-17" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb16-18"><a href="#cb16-18" aria-hidden="true" tabindex="-1"></a><span class="fu">read.csv</span>(<span class="st">"NonWildSpecies/FAO_aquaculture.csv"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</section>
<section id="plants" class="level3">
<h3 class="anchored" data-anchor-id="plants">Plants</h3>
<div class="cell">
<div class="sourceCode cell-code" id="cb17"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb17-1"><a href="#cb17-1" aria-hidden="true" tabindex="-1"></a>fruits_html <span class="ot">&lt;-</span> <span class="fu">read_html</span>(<span class="st">"https://en.wikipedia.org/wiki/List_of_culinary_fruits"</span>)</span>
<span id="cb17-2"><a href="#cb17-2" aria-hidden="true" tabindex="-1"></a><span class="co">#multiple tables in this page, but purrr comes to the rescue!</span></span>
<span id="cb17-3"><a href="#cb17-3" aria-hidden="true" tabindex="-1"></a>fruits_tables <span class="ot">&lt;-</span> fruits_html <span class="sc">%&gt;%</span> <span class="fu">html_nodes</span>(<span class="st">"table"</span>) <span class="sc">%&gt;%</span> <span class="fu">map</span>(html_table) <span class="sc">%&gt;%</span> <span class="fu">bind_rows</span>()</span>
<span id="cb17-4"><a href="#cb17-4" aria-hidden="true" tabindex="-1"></a>fruits_tables<span class="sc">$</span>Category<span class="ot">&lt;-</span><span class="st">"Domesticated Fruit"</span></span>
<span id="cb17-5"><a href="#cb17-5" aria-hidden="true" tabindex="-1"></a>fruits_tables<span class="ot">&lt;-</span>fruits_tables[,<span class="sc">-</span><span class="dv">3</span>]</span>
<span id="cb17-6"><a href="#cb17-6" aria-hidden="true" tabindex="-1"></a>fruits_tables <span class="ot">&lt;-</span> fruits_tables[,<span class="fu">c</span>(<span class="dv">2</span>,<span class="dv">1</span>,<span class="dv">3</span>)]</span>
<span id="cb17-7"><a href="#cb17-7" aria-hidden="true" tabindex="-1"></a><span class="fu">names</span>(fruits_tables) <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="st">"Species"</span>,<span class="st">"Common"</span>,<span class="st">"Category"</span>)</span>
<span id="cb17-8"><a href="#cb17-8" aria-hidden="true" tabindex="-1"></a><span class="fu">write.csv</span>(fruits_tables,<span class="st">"domesticatedPlants_Wikipedia_Fruits.csv"</span>, <span class="at">row.names =</span> F)</span>
<span id="cb17-9"><a href="#cb17-9" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb17-10"><a href="#cb17-10" aria-hidden="true" tabindex="-1"></a>vegetables_html <span class="ot">&lt;-</span> <span class="fu">read_html</span>(<span class="st">"https://en.wikipedia.org/wiki/List_of_vegetables"</span>)</span>
<span id="cb17-11"><a href="#cb17-11" aria-hidden="true" tabindex="-1"></a>vegetables_tables <span class="ot">&lt;-</span> vegetables_html <span class="sc">%&gt;%</span> <span class="fu">html_nodes</span>(<span class="st">"table"</span>) <span class="sc">%&gt;%</span> </span>
<span id="cb17-12"><a href="#cb17-12" aria-hidden="true" tabindex="-1"></a>                      <span class="fu">map</span>(html_table) <span class="sc">%&gt;%</span> <span class="fu">bind_rows</span>()</span>
<span id="cb17-13"><a href="#cb17-13" aria-hidden="true" tabindex="-1"></a><span class="co">#remove the column names that read in wrong</span></span>
<span id="cb17-14"><a href="#cb17-14" aria-hidden="true" tabindex="-1"></a>vegetables_tables <span class="ot">&lt;-</span> vegetables_tables[<span class="sc">-</span><span class="fu">grep</span>(<span class="st">"Species"</span>,vegetables_tables<span class="sc">$</span>X2),]</span>
<span id="cb17-15"><a href="#cb17-15" aria-hidden="true" tabindex="-1"></a><span class="fu">names</span>(vegetables_tables) <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="st">"Common name"</span>, <span class="st">"Species name"</span>)</span>
<span id="cb17-16"><a href="#cb17-16" aria-hidden="true" tabindex="-1"></a>vegetables_tables<span class="sc">$</span>Category<span class="ot">&lt;-</span><span class="st">"Domesticated Vegetable"</span></span>
<span id="cb17-17"><a href="#cb17-17" aria-hidden="true" tabindex="-1"></a>vegetables_tables<span class="sc">$</span><span class="st">`</span><span class="at">Species name</span><span class="st">`</span> <span class="ot">&lt;-</span> <span class="fu">str_remove</span>(vegetables_tables<span class="sc">$</span><span class="st">`</span><span class="at">Species name</span><span class="st">`</span>, </span>
<span id="cb17-18"><a href="#cb17-18" aria-hidden="true" tabindex="-1"></a>                                               <span class="st">"</span><span class="sc">\\</span><span class="st">(.+</span><span class="sc">\\</span><span class="st">)"</span>) <span class="sc">%&gt;%</span> </span>
<span id="cb17-19"><a href="#cb17-19" aria-hidden="true" tabindex="-1"></a>                                                          <span class="fu">str_remove</span>(<span class="st">"</span><span class="sc">\\</span><span class="st">[&gt;+</span><span class="sc">\\</span><span class="st">]"</span>)</span>
<span id="cb17-20"><a href="#cb17-20" aria-hidden="true" tabindex="-1"></a>vegetables_tables <span class="ot">&lt;-</span> vegetables_tables[,<span class="fu">c</span>(<span class="dv">2</span>,<span class="dv">1</span>,<span class="dv">3</span>)]</span>
<span id="cb17-21"><a href="#cb17-21" aria-hidden="true" tabindex="-1"></a><span class="fu">names</span>(vegetables_tables) <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="st">"Species"</span>,<span class="st">"Common"</span>,<span class="st">"Category"</span>)</span>
<span id="cb17-22"><a href="#cb17-22" aria-hidden="true" tabindex="-1"></a><span class="fu">write.csv</span>(vegetables_tables,<span class="st">"NonWildSpecies/domesticatedPlants_Wikipedia_Vegetables.csv"</span>,</span>
<span id="cb17-23"><a href="#cb17-23" aria-hidden="true" tabindex="-1"></a>          <span class="at">row.names =</span> F)</span>
<span id="cb17-24"><a href="#cb17-24" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb17-25"><a href="#cb17-25" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb17-26"><a href="#cb17-26" aria-hidden="true" tabindex="-1"></a>other_tables <span class="ot">&lt;-</span> <span class="fu">read.csv</span>(<span class="st">"NonWildSpecies/domesticatedPlants_Wikipedia_Cereals_Other.csv"</span>)</span>
<span id="cb17-27"><a href="#cb17-27" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb17-28"><a href="#cb17-28" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb17-29"><a href="#cb17-29" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb17-30"><a href="#cb17-30" aria-hidden="true" tabindex="-1"></a>domesticatedPlants <span class="ot">&lt;-</span> <span class="fu">rbind</span>(fruits_tables, vegetables_tables, other_tables)</span>
<span id="cb17-31"><a href="#cb17-31" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb17-32"><a href="#cb17-32" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb17-33"><a href="#cb17-33" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb17-34"><a href="#cb17-34" aria-hidden="true" tabindex="-1"></a><span class="fu">write.csv</span>(domesticatedPlants,<span class="st">"NonWildSpecies/domesticatedPlants_Wikipedia_all.csv"</span>,<span class="at">row.names=</span>F)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</section>
</section>
<section id="model-organisms" class="level2">
<h2 class="anchored" data-anchor-id="model-organisms">Model Organisms</h2>
<div class="cell">
<div class="sourceCode cell-code" id="cb18"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb18-1"><a href="#cb18-1" aria-hidden="true" tabindex="-1"></a>model_html <span class="ot">&lt;-</span> <span class="fu">read_html</span>(<span class="st">"https://en.wikipedia.org/wiki/List_of_model_organisms"</span>)</span>
<span id="cb18-2"><a href="#cb18-2" aria-hidden="true" tabindex="-1"></a><span class="co">#used selector gadget (https://selectorgadget.com) to pick out the scientific names, which were italicized. </span></span>
<span id="cb18-3"><a href="#cb18-3" aria-hidden="true" tabindex="-1"></a>model_list <span class="ot">&lt;-</span> model_html <span class="sc">%&gt;%</span> <span class="fu">html_nodes</span>(<span class="st">'.tright+ ul i a , i a+ a , ul a+ i , h3+ ul i a , #Protists , #Eukaryotes'</span>) <span class="sc">%&gt;%</span> <span class="fu">html_text</span>()</span>
<span id="cb18-4"><a href="#cb18-4" aria-hidden="true" tabindex="-1"></a><span class="co"># Then edited manually to remove a few other stray italics</span></span>
<span id="cb18-5"><a href="#cb18-5" aria-hidden="true" tabindex="-1"></a>model_list_edit <span class="ot">&lt;-</span> <span class="fu">edit</span>(model_list)</span>
<span id="cb18-6"><a href="#cb18-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb18-7"><a href="#cb18-7" aria-hidden="true" tabindex="-1"></a>model_list_clean <span class="ot">&lt;-</span> <span class="fu">sort</span>(<span class="fu">unique</span>(model_list_edit))</span>
<span id="cb18-8"><a href="#cb18-8" aria-hidden="true" tabindex="-1"></a>model_common <span class="ot">&lt;-</span> <span class="fu">sci2comm</span>(model_list_clean, <span class="at">db =</span> <span class="st">"itis"</span>)</span>
<span id="cb18-9"><a href="#cb18-9" aria-hidden="true" tabindex="-1"></a>model_common <span class="ot">&lt;-</span>  <span class="fu">paste</span>(<span class="fu">lapply</span>(model_common,<span class="cf">function</span>(x) <span class="cf">if</span>(<span class="fu">identical</span>(x, <span class="fu">character</span>(<span class="dv">0</span>))) <span class="cn">NA_character_</span> <span class="cf">else</span> x),<span class="at">sep=</span><span class="st">","</span>)</span>
<span id="cb18-10"><a href="#cb18-10" aria-hidden="true" tabindex="-1"></a>modelSpecies <span class="ot">&lt;-</span> <span class="fu">cbind</span>(model_list_clean,model_common)</span>
<span id="cb18-11"><a href="#cb18-11" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb18-12"><a href="#cb18-12" aria-hidden="true" tabindex="-1"></a><span class="fu">write.csv</span>(modelSpecies,<span class="st">"NonWildSpecies/labSpecies_wikipedia_taxized.csv"</span>, <span class="at">row.names =</span> F)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</section>
<section id="combining-lists" class="level2">
<h2 class="anchored" data-anchor-id="combining-lists">Combining Lists</h2>
<div class="cell">
<div class="sourceCode cell-code" id="cb19"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb19-1"><a href="#cb19-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Model Species</span></span>
<span id="cb19-2"><a href="#cb19-2" aria-hidden="true" tabindex="-1"></a>labStudents <span class="ot">&lt;-</span> <span class="fu">read.csv</span>(<span class="st">"NonWildSpecies/labSpecies_students_taxized.csv"</span>, <span class="at">row.names =</span> <span class="dv">1</span>)</span>
<span id="cb19-3"><a href="#cb19-3" aria-hidden="true" tabindex="-1"></a>labWiki <span class="ot">&lt;-</span> <span class="fu">read.csv</span>(<span class="st">"NonWildSpecies/labSpecies_wikipedia_taxized.csv"</span>)</span>
<span id="cb19-4"><a href="#cb19-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb19-5"><a href="#cb19-5" aria-hidden="true" tabindex="-1"></a>labSpecies <span class="ot">&lt;-</span> <span class="fu">left_join</span>(labStudents,labWiki,<span class="at">by=</span><span class="fu">c</span>(<span class="st">"lab"</span> <span class="ot">=</span> <span class="st">"model_list_clean"</span>))</span>
<span id="cb19-6"><a href="#cb19-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb19-7"><a href="#cb19-7" aria-hidden="true" tabindex="-1"></a>labSpecies <span class="ot">&lt;-</span> labSpecies[,<span class="sc">-</span><span class="dv">3</span>]</span>
<span id="cb19-8"><a href="#cb19-8" aria-hidden="true" tabindex="-1"></a>labSpecies<span class="sc">$</span>Category <span class="ot">&lt;-</span> <span class="st">"Model Species"</span></span>
<span id="cb19-9"><a href="#cb19-9" aria-hidden="true" tabindex="-1"></a><span class="fu">names</span>(labSpecies) <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="st">"Species"</span>,<span class="st">"Common"</span>,<span class="st">"Category"</span>)</span>
<span id="cb19-10"><a href="#cb19-10" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb19-11"><a href="#cb19-11" aria-hidden="true" tabindex="-1"></a><span class="fu">write.csv</span>(labSpecies,<span class="st">"labSpecies_joined.csv"</span>)</span>
<span id="cb19-12"><a href="#cb19-12" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb19-13"><a href="#cb19-13" aria-hidden="true" tabindex="-1"></a><span class="co"># Human Pathogens</span></span>
<span id="cb19-14"><a href="#cb19-14" aria-hidden="true" tabindex="-1"></a>humpathStudents <span class="ot">&lt;-</span> <span class="fu">read.table</span>(<span class="st">"NonWildSpecies/humanPathogen_students_taxized.csv"</span>, </span>
<span id="cb19-15"><a href="#cb19-15" aria-hidden="true" tabindex="-1"></a>                              <span class="at">sep =</span> <span class="st">","</span>, <span class="at">header =</span> T, <span class="at">stringsAsFactors =</span> F, <span class="at">row.names =</span> <span class="dv">1</span>)</span>
<span id="cb19-16"><a href="#cb19-16" aria-hidden="true" tabindex="-1"></a>humpathWiki <span class="ot">&lt;-</span> <span class="fu">read.table</span>(<span class="st">"NonWildSpecies/humanPathogen_wikipedia_diseases_eukaryotes.tsv"</span>, </span>
<span id="cb19-17"><a href="#cb19-17" aria-hidden="true" tabindex="-1"></a>                          <span class="at">sep =</span> <span class="st">"</span><span class="sc">\t</span><span class="st">"</span>, <span class="at">header =</span> T, <span class="at">stringsAsFactors =</span> F)</span>
<span id="cb19-18"><a href="#cb19-18" aria-hidden="true" tabindex="-1"></a>humpathSpecies <span class="ot">&lt;-</span> <span class="fu">left_join</span>(humpathWiki,humpathStudents,<span class="at">by =</span> <span class="fu">c</span>(<span class="st">"Infectious.agent"</span><span class="ot">=</span><span class="st">"humpath"</span>))</span>
<span id="cb19-19"><a href="#cb19-19" aria-hidden="true" tabindex="-1"></a>humpathSpecies <span class="ot">&lt;-</span> humpathSpecies[,<span class="dv">1</span><span class="sc">:</span><span class="dv">2</span>]</span>
<span id="cb19-20"><a href="#cb19-20" aria-hidden="true" tabindex="-1"></a>humpathSpecies<span class="sc">$</span>Category <span class="ot">&lt;-</span> <span class="st">"HumanPathogen Species"</span></span>
<span id="cb19-21"><a href="#cb19-21" aria-hidden="true" tabindex="-1"></a><span class="fu">names</span>(humpathSpecies) <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="st">"Species"</span>,<span class="st">"Common"</span>,<span class="st">"Category"</span>)</span>
<span id="cb19-22"><a href="#cb19-22" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb19-23"><a href="#cb19-23" aria-hidden="true" tabindex="-1"></a><span class="fu">write.csv</span>(humpathSpecies,<span class="st">"NonWildSpecies/humanpathogenSpecies_joined.csv"</span>, <span class="at">row.names=</span>F)</span>
<span id="cb19-24"><a href="#cb19-24" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb19-25"><a href="#cb19-25" aria-hidden="true" tabindex="-1"></a><span class="co"># Domesticated Species</span></span>
<span id="cb19-26"><a href="#cb19-26" aria-hidden="true" tabindex="-1"></a>domesticatedPlants <span class="ot">&lt;-</span> <span class="fu">read.csv</span>(<span class="st">"NonWildSpecies/domesticatedPlants_Wikipedia_all.csv"</span>)</span>
<span id="cb19-27"><a href="#cb19-27" aria-hidden="true" tabindex="-1"></a>domesticatedAnimals <span class="ot">&lt;-</span> <span class="fu">read.csv</span>(<span class="st">"NonWildSpecies/domesticatedAnimals_wikipedia.csv"</span>)</span>
<span id="cb19-28"><a href="#cb19-28" aria-hidden="true" tabindex="-1"></a>domesticatedAnimals <span class="ot">&lt;-</span> domesticatedAnimals[,<span class="dv">1</span><span class="sc">:</span><span class="dv">2</span>]</span>
<span id="cb19-29"><a href="#cb19-29" aria-hidden="true" tabindex="-1"></a>domesticatedAnimals<span class="sc">$</span>Category <span class="ot">=</span> <span class="st">"Domesticated Animal"</span></span>
<span id="cb19-30"><a href="#cb19-30" aria-hidden="true" tabindex="-1"></a><span class="fu">names</span>(domesticatedAnimals) <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="st">"Species"</span>,<span class="st">"Common"</span>,<span class="st">"Category"</span>)</span>
<span id="cb19-31"><a href="#cb19-31" aria-hidden="true" tabindex="-1"></a>domesticatedWiki <span class="ot">&lt;-</span> <span class="fu">rbind</span>(domesticatedAnimals, domesticatedPlants)</span>
<span id="cb19-32"><a href="#cb19-32" aria-hidden="true" tabindex="-1"></a>domesticatedStudents <span class="ot">&lt;-</span> <span class="fu">read.csv</span>(<span class="st">"NonWildSpecies/domesticated_students_taxized.csv"</span>, </span>
<span id="cb19-33"><a href="#cb19-33" aria-hidden="true" tabindex="-1"></a>                                 <span class="at">row.names =</span> <span class="dv">1</span>)</span>
<span id="cb19-34"><a href="#cb19-34" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb19-35"><a href="#cb19-35" aria-hidden="true" tabindex="-1"></a>domesticatedSpecies <span class="ot">&lt;-</span> <span class="fu">full_join</span>(domesticatedWiki, domesticatedStudents, </span>
<span id="cb19-36"><a href="#cb19-36" aria-hidden="true" tabindex="-1"></a>                                 <span class="at">by =</span> <span class="fu">c</span>(<span class="st">"Species"</span><span class="ot">=</span> <span class="st">"dom"</span>))</span>
<span id="cb19-37"><a href="#cb19-37" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb19-38"><a href="#cb19-38" aria-hidden="true" tabindex="-1"></a><span class="fu">write.csv</span>(domesticatedSpecies,<span class="st">"NonWildSpecies/domesticatedSpecies_joined.csv"</span>, <span class="at">row.names =</span> F)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>I took these joined lists and hand-edited them, deleting species which, based on a brief google search seemed to have significant natural populations. One example of this was deleting three-spined stickleback (<em>Gasterosteus aculeatus</em>), which is an evolutionary model organism, but still has significant natural populations that are frequently studied as well. This reasoning was in keeping with our use of the wording “potentially relevant” to genetic diversity of natural populations. For genera which I judged to be entirely or almost entirely non-natural, I generally only included the generic name. I left the × character for hybrids.</p>
</section>
<section id="improving-sources" class="level2">
<h2 class="anchored" data-anchor-id="improving-sources">Improving Sources</h2>
<p>Using just Wikipedia and species identified by students for each category is not exactly authoritative. I’ve scoured the literature, the web, and FAO reports for more authoritative lists of each of the three categories.</p>
<ul>
<li><a href="http://www.fao.org/3/CA3129EN/CA3129EN.pdf">FAO The state of the world’s biodiversity for food and agriculture 2019</a></li>
<li><a href="http://www.fao.org/3/i1500e/i1500e00.htm">FAO The state of the world’s plant genetic resources for food and agriculture 2011</a></li>
<li><a href="http://www.fao.org/3/a-i4787e.pdf">The second report on the state of the world’s animal genetic resources for food and agriculture</a> State of Livestock Diversity Table 1A1</li>
<li><a href="http://mansfeld.ipk-gatersleben.de/apex/f?p=185:5:">Masfeld’s World Database of Agricultural and Horticultural Crops (Cited in FAO)</a></li>
<li><a href="https://npgsweb.ars-grin.gov/gringlobal/taxon/taxonomysearcheco">ARS-GRIN (Germplasm Resources Information Network) World Economic Plants</a></li>
<li><a href="http://www.fao.org/documents/card/en/c/ca9229en/">FAO The state of the world’s fisheries and aquaculture 2018: Tables 7 &amp; 8</a></li>
<li><a href="https://veupathdb.org/veupathdb/app">VEuPathDB - Eukaryotic Pathogen, Vector &amp; Host Informatics Resource</a> - Organisms table.</li>
</ul>
<div class="cell">
<div class="sourceCode cell-code" id="cb20"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb20-1"><a href="#cb20-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Start by reading in the list of species that I created from Wikipedia and Students</span></span>
<span id="cb20-2"><a href="#cb20-2" aria-hidden="true" tabindex="-1"></a>allwikispecies <span class="ot">&lt;-</span> <span class="fu">read.csv</span>(<span class="st">"NonWildSpecies/nonNaturalSpecies_joined_preliminary.csv"</span>)</span>
<span id="cb20-3"><a href="#cb20-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb20-4"><a href="#cb20-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb20-5"><a href="#cb20-5" aria-hidden="true" tabindex="-1"></a><span class="co"># Got a solid list of eukaryotic pathogens from VEUpathDB</span></span>
<span id="cb20-6"><a href="#cb20-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb20-7"><a href="#cb20-7" aria-hidden="true" tabindex="-1"></a>veupathdb <span class="ot">&lt;-</span> <span class="fu">read.csv</span>(<span class="st">"NonWildSpecies/VEUpathDB_organisms.csv"</span>) <span class="sc">%&gt;%</span> <span class="fu">map</span>(str_trim)</span>
<span id="cb20-8"><a href="#cb20-8" aria-hidden="true" tabindex="-1"></a>veupathdb_common <span class="ot">&lt;-</span> <span class="fu">sci2comm</span>(veupathdb<span class="sc">$</span>Species)</span>
<span id="cb20-9"><a href="#cb20-9" aria-hidden="true" tabindex="-1"></a>veupathdb_common <span class="ot">&lt;-</span>  <span class="fu">paste</span>(<span class="fu">lapply</span>(veupathdb_common,<span class="cf">function</span>(x) <span class="cf">if</span>(<span class="fu">identical</span>(x, <span class="fu">character</span>(<span class="dv">0</span>))) <span class="cn">NA_character_</span> <span class="cf">else</span> x),<span class="at">sep=</span><span class="st">","</span>)</span>
<span id="cb20-10"><a href="#cb20-10" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb20-11"><a href="#cb20-11" aria-hidden="true" tabindex="-1"></a>veupathdb_final <span class="ot">&lt;-</span> <span class="fu">data.frame</span>(<span class="at">Species =</span> veupathdb<span class="sc">$</span>Species, <span class="at">Common =</span> veupathdb_common )</span>
<span id="cb20-12"><a href="#cb20-12" aria-hidden="true" tabindex="-1"></a>veupathdb_final<span class="sc">$</span>Category <span class="ot">&lt;-</span> <span class="st">"Human Pathogen VEuPathDB"</span></span>
<span id="cb20-13"><a href="#cb20-13" aria-hidden="true" tabindex="-1"></a>wikihumpath <span class="ot">&lt;-</span> allwikispecies[<span class="fu">grep</span>(<span class="st">"HumanPathogen"</span>,wikihumpath<span class="sc">$</span>Category),]</span>
<span id="cb20-14"><a href="#cb20-14" aria-hidden="true" tabindex="-1"></a>wikihumpath<span class="sc">$</span>Category <span class="ot">&lt;-</span> (<span class="st">"Human Pathogen Wikipedia"</span>)</span>
<span id="cb20-15"><a href="#cb20-15" aria-hidden="true" tabindex="-1"></a>allhumpath <span class="ot">&lt;-</span> <span class="fu">full_join</span>(wikihumpath, veupathdb_final)</span>
<span id="cb20-16"><a href="#cb20-16" aria-hidden="true" tabindex="-1"></a>allhumpath <span class="ot">&lt;-</span> <span class="fu">unique</span>(allhumpath)</span>
<span id="cb20-17"><a href="#cb20-17" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb20-18"><a href="#cb20-18" aria-hidden="true" tabindex="-1"></a><span class="fu">write.table</span>(allhumpath,<span class="at">file =</span> <span class="st">"NonWildSpecies/HumanPathogens_Final.tsv"</span>,<span class="at">sep =</span> <span class="st">"</span><span class="sc">\t</span><span class="st">"</span>, <span class="at">quote=</span>F)</span>
<span id="cb20-19"><a href="#cb20-19" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb20-20"><a href="#cb20-20" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb20-21"><a href="#cb20-21" aria-hidden="true" tabindex="-1"></a><span class="co"># Got top aquaculture species from FAO</span></span>
<span id="cb20-22"><a href="#cb20-22" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb20-23"><a href="#cb20-23" aria-hidden="true" tabindex="-1"></a>FAOaquaculture <span class="ot">&lt;-</span> <span class="fu">read.csv</span>(<span class="st">"NonWildSpecies/FAO_aquaculture.csv"</span>,<span class="at">comment.char =</span> <span class="st">"#"</span>) <span class="sc">%&gt;%</span> <span class="fu">map</span>(str_trim) <span class="sc">%&gt;%</span> <span class="fu">data.frame</span>()</span>
<span id="cb20-24"><a href="#cb20-24" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb20-25"><a href="#cb20-25" aria-hidden="true" tabindex="-1"></a><span class="co"># Got a partial list of domesticated animals from FAO</span></span>
<span id="cb20-26"><a href="#cb20-26" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb20-27"><a href="#cb20-27" aria-hidden="true" tabindex="-1"></a>FAOanimals <span class="ot">&lt;-</span> <span class="fu">read.csv</span>(<span class="st">"NonWildSpecies/FAO_Domesticated_Animals.csv"</span>,<span class="at">comment.char =</span> <span class="st">"#"</span>) <span class="sc">%&gt;%</span> <span class="fu">map</span>(str_trim) <span class="sc">%&gt;%</span> <span class="fu">data.frame</span>()</span>
<span id="cb20-28"><a href="#cb20-28" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb20-29"><a href="#cb20-29" aria-hidden="true" tabindex="-1"></a><span class="co">#Found World Economic Plants from the ARS-GRIN database and downloaded Human Food plants and lawn and turf plants</span></span>
<span id="cb20-30"><a href="#cb20-30" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb20-31"><a href="#cb20-31" aria-hidden="true" tabindex="-1"></a>GRIN_food <span class="ot">&lt;-</span> <span class="fu">read.table</span>(<span class="st">"./NonWildSpecies/ARS_GRIN_HumanFood.txt"</span>, <span class="at">header=</span>T, <span class="at">sep =</span> <span class="st">"</span><span class="sc">\t</span><span class="st">"</span>, <span class="at">comment.char =</span> <span class="st">"#"</span>)</span>
<span id="cb20-32"><a href="#cb20-32" aria-hidden="true" tabindex="-1"></a>GRIN_food_sp <span class="ot">&lt;-</span> <span class="fu">str_extract</span>(GRIN_food<span class="sc">$</span>Species, <span class="at">pattern=</span><span class="fu">regex</span>(<span class="st">"^[:alpha:]+ ×* *[:alpha:]+"</span>))</span>
<span id="cb20-33"><a href="#cb20-33" aria-hidden="true" tabindex="-1"></a>GRIN_food_sp <span class="ot">&lt;-</span> <span class="fu">sort</span>(<span class="fu">unique</span>(GRIN_human_sp))</span>
<span id="cb20-34"><a href="#cb20-34" aria-hidden="true" tabindex="-1"></a>GRIN_food_common <span class="ot">&lt;-</span> <span class="fu">sci2comm</span>(GRIN_food_sp, <span class="at">db =</span> <span class="st">"itis"</span>)</span>
<span id="cb20-35"><a href="#cb20-35" aria-hidden="true" tabindex="-1"></a>GRIN_food_common2 <span class="ot">&lt;-</span>  <span class="fu">paste</span>(<span class="fu">lapply</span>(GRIN_food_common,<span class="cf">function</span>(x) <span class="cf">if</span>(<span class="fu">identical</span>(x, <span class="fu">character</span>(<span class="dv">0</span>))) <span class="cn">NA_character_</span> <span class="cf">else</span> x),<span class="at">sep=</span><span class="st">","</span>)</span>
<span id="cb20-36"><a href="#cb20-36" aria-hidden="true" tabindex="-1"></a>GRIN_foodplants <span class="ot">&lt;-</span> <span class="fu">data.frame</span>(<span class="at">Species =</span> GRIN_food_sp, <span class="at">Common =</span> GRIN_food_common2 )</span>
<span id="cb20-37"><a href="#cb20-37" aria-hidden="true" tabindex="-1"></a>GRIN_foodplants<span class="sc">$</span>Category <span class="ot">&lt;-</span> <span class="st">"Domesticated Plant GRIN Food"</span></span>
<span id="cb20-38"><a href="#cb20-38" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb20-39"><a href="#cb20-39" aria-hidden="true" tabindex="-1"></a>GRIN_lawn <span class="ot">&lt;-</span> <span class="fu">read.table</span>(<span class="st">"./NonWildSpecies/ARS_GRIN_lawn.txt"</span>, <span class="at">header=</span>T, <span class="at">sep =</span> <span class="st">"</span><span class="sc">\t</span><span class="st">"</span>, <span class="at">comment.char =</span> <span class="st">"#"</span>)</span>
<span id="cb20-40"><a href="#cb20-40" aria-hidden="true" tabindex="-1"></a>GRIN_lawn_sp <span class="ot">&lt;-</span> <span class="fu">str_extract</span>(GRIN_lawn<span class="sc">$</span>Species, <span class="at">pattern=</span><span class="fu">regex</span>(<span class="st">"^[:alpha:]+ ×* *[:alpha:]+"</span>))</span>
<span id="cb20-41"><a href="#cb20-41" aria-hidden="true" tabindex="-1"></a>GRIN_lawn_sp <span class="ot">&lt;-</span> <span class="fu">sort</span>(<span class="fu">unique</span>(GRIN_lawn_sp))</span>
<span id="cb20-42"><a href="#cb20-42" aria-hidden="true" tabindex="-1"></a>GRIN_lawn_common <span class="ot">&lt;-</span> <span class="fu">sci2comm</span>(GRIN_lawn_sp, <span class="at">db =</span> <span class="st">"itis"</span>)</span>
<span id="cb20-43"><a href="#cb20-43" aria-hidden="true" tabindex="-1"></a>GRIN_lawn_common2 <span class="ot">&lt;-</span>  <span class="fu">paste</span>(<span class="fu">lapply</span>(GRIN_lawn_common,<span class="cf">function</span>(x) <span class="cf">if</span>(<span class="fu">identical</span>(x, <span class="fu">character</span>(<span class="dv">0</span>))) <span class="cn">NA_character_</span> <span class="cf">else</span> x),<span class="at">sep=</span><span class="st">","</span>)</span>
<span id="cb20-44"><a href="#cb20-44" aria-hidden="true" tabindex="-1"></a>GRIN_lawnplants <span class="ot">&lt;-</span> <span class="fu">data.frame</span>(<span class="at">Species =</span> GRIN_lawn_sp, <span class="at">Common =</span> GRIN_lawn_common2 )</span>
<span id="cb20-45"><a href="#cb20-45" aria-hidden="true" tabindex="-1"></a>GRIN_lawnplants<span class="sc">$</span>Category <span class="ot">&lt;-</span> <span class="st">"Domesticated Plant GRIN Lawn"</span></span>
<span id="cb20-46"><a href="#cb20-46" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb20-47"><a href="#cb20-47" aria-hidden="true" tabindex="-1"></a>GRIN_plants<span class="ot">&lt;-</span><span class="fu">rbind</span>(GRIN_foodplants, GRIN_lawnplants)</span>
<span id="cb20-48"><a href="#cb20-48" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb20-49"><a href="#cb20-49" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb20-50"><a href="#cb20-50" aria-hidden="true" tabindex="-1"></a>wikidomesticated <span class="ot">&lt;-</span> allwikispecies[<span class="fu">grep</span>(<span class="st">"Domesticated"</span>, allwikispecies<span class="sc">$</span>Category),]</span>
<span id="cb20-51"><a href="#cb20-51" aria-hidden="true" tabindex="-1"></a>wikidomesticated<span class="sc">$</span>Category[<span class="sc">-</span><span class="fu">grep</span>(<span class="st">"Student"</span>,wikidomesticated<span class="sc">$</span>Category)] <span class="ot">&lt;-</span> <span class="fu">paste</span>(wikidomesticated<span class="sc">$</span>Category[<span class="sc">-</span><span class="fu">grep</span>(<span class="st">"Student"</span>,wikidomesticated<span class="sc">$</span>Category)], <span class="st">"Wikipedia"</span>, <span class="at">sep =</span> <span class="st">" "</span>)</span>
<span id="cb20-52"><a href="#cb20-52" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb20-53"><a href="#cb20-53" aria-hidden="true" tabindex="-1"></a><span class="co"># Rachel found a list in Khoury et al. 2016 that takes the FAOstat categories (roughly) and gives latin binomials. I edited it into machine readable format</span></span>
<span id="cb20-54"><a href="#cb20-54" aria-hidden="true" tabindex="-1"></a>khouryplants <span class="ot">&lt;-</span> <span class="fu">read.csv</span>(<span class="st">"./NonWildSpecies/Khouri_etal_2016_EDC_edit.csv"</span>) <span class="sc">%&gt;%</span> <span class="fu">map</span>(str_trim) <span class="sc">%&gt;%</span> <span class="fu">data.frame</span>()</span>
<span id="cb20-55"><a href="#cb20-55" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb20-56"><a href="#cb20-56" aria-hidden="true" tabindex="-1"></a><span class="co">#joining these sources together in rough order of authoritativeness, dropping anything that doesn't have a common name in ITIS</span></span>
<span id="cb20-57"><a href="#cb20-57" aria-hidden="true" tabindex="-1"></a><span class="co"># or from one of the sources (many GRIN things)</span></span>
<span id="cb20-58"><a href="#cb20-58" aria-hidden="true" tabindex="-1"></a>alldomesticated <span class="ot">&lt;-</span> <span class="fu">full_join</span>(khouryplants, FAOaquaculture) <span class="sc">%&gt;%</span>  <span class="fu">full_join</span>(FAOanimals) <span class="sc">%&gt;%</span> <span class="fu">full_join</span>(GRIN_plants)  <span class="sc">%&gt;%</span> </span>
<span id="cb20-59"><a href="#cb20-59" aria-hidden="true" tabindex="-1"></a>                    <span class="fu">full_join</span>(wikidomesticated) <span class="sc">%&gt;%</span> <span class="fu">distinct</span>(Species, <span class="at">.keep_all=</span>T) <span class="sc">%&gt;%</span> <span class="fu">arrange</span>(Species) <span class="sc">%&gt;%</span> </span>
<span id="cb20-60"><a href="#cb20-60" aria-hidden="true" tabindex="-1"></a>                    <span class="fu">na_if</span>(<span class="st">""</span>) <span class="sc">%&gt;%</span> <span class="fu">na_if</span>(<span class="st">"NA"</span>) <span class="sc">%&gt;%</span>  <span class="fu">drop_na</span>(Common)</span>
<span id="cb20-61"><a href="#cb20-61" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb20-62"><a href="#cb20-62" aria-hidden="true" tabindex="-1"></a><span class="co"># Sort them in this order of authority</span></span>
<span id="cb20-63"><a href="#cb20-63" aria-hidden="true" tabindex="-1"></a>alldomesticated<span class="sc">$</span>Category <span class="ot">&lt;-</span> <span class="fu">factor</span>(alldomesticated<span class="sc">$</span>Category, </span>
<span id="cb20-64"><a href="#cb20-64" aria-hidden="true" tabindex="-1"></a>                                   <span class="at">levels =</span> <span class="fu">c</span>(<span class="st">"Domesticated Plant Khouri et al. 2016"</span>, </span>
<span id="cb20-65"><a href="#cb20-65" aria-hidden="true" tabindex="-1"></a>                                              <span class="st">"Domesticated Aquaculture FAO"</span>,  </span>
<span id="cb20-66"><a href="#cb20-66" aria-hidden="true" tabindex="-1"></a>                                              <span class="st">"Domesticated Animal FAO"</span>,</span>
<span id="cb20-67"><a href="#cb20-67" aria-hidden="true" tabindex="-1"></a>                                              <span class="st">"Domesticated Plant GRIN Food"</span>, </span>
<span id="cb20-68"><a href="#cb20-68" aria-hidden="true" tabindex="-1"></a>                                              <span class="st">"Domesticated Plant GRIN Lawn"</span>, </span>
<span id="cb20-69"><a href="#cb20-69" aria-hidden="true" tabindex="-1"></a>                                              <span class="st">"Domesticated Animal Wikipedia"</span>,</span>
<span id="cb20-70"><a href="#cb20-70" aria-hidden="true" tabindex="-1"></a>                                              <span class="st">"Domesticated Plant Cereal Wikipedia"</span>, </span>
<span id="cb20-71"><a href="#cb20-71" aria-hidden="true" tabindex="-1"></a>                                              <span class="st">"Domesticated Plant Vegetable Wikipedia"</span>,</span>
<span id="cb20-72"><a href="#cb20-72" aria-hidden="true" tabindex="-1"></a>                                              <span class="st">"Domesticated Plant Fruit Wikipedia"</span>,</span>
<span id="cb20-73"><a href="#cb20-73" aria-hidden="true" tabindex="-1"></a>                                              <span class="st">"Domesticated Plant Other Wikipedia"</span>,</span>
<span id="cb20-74"><a href="#cb20-74" aria-hidden="true" tabindex="-1"></a>                                              <span class="st">"Domesticated Fungus Wikipedia"</span>,</span>
<span id="cb20-75"><a href="#cb20-75" aria-hidden="true" tabindex="-1"></a>                                              <span class="st">"Domesticated Plant Student"</span>,</span>
<span id="cb20-76"><a href="#cb20-76" aria-hidden="true" tabindex="-1"></a>                                              <span class="st">"Domesticated Animal Student"</span>))      </span>
<span id="cb20-77"><a href="#cb20-77" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb20-78"><a href="#cb20-78" aria-hidden="true" tabindex="-1"></a>alldomesticated <span class="ot">&lt;-</span> alldomesticated[<span class="fu">order</span>(alldomesticated<span class="sc">$</span>Category),]</span>
<span id="cb20-79"><a href="#cb20-79" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb20-80"><a href="#cb20-80" aria-hidden="true" tabindex="-1"></a><span class="fu">write.table</span>(alldomesticated,<span class="st">"NonWildSpecies/Domesticated_AllSources.tsv"</span>,<span class="at">sep=</span><span class="st">"</span><span class="sc">\t</span><span class="st">"</span>,<span class="at">quote=</span>F, <span class="at">row.names =</span> F)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>I then went through this table and basically dropped things I had never heard of, for lack of a better criterion, with the idea being that the minor items I was dropping might have wild populations. I ensured that there weren’t duplicates within each of the three categories, but allowed duplicates such as <em>S. cerevisiae</em> across the three categories. For genera where I determined that the entire genus was cultivated (e.g.&nbsp;<em>Citrus</em>, <em>Triticum</em>) I kept only the genus name.</p>
<p>Then I went back and below separated out the source information into its own column so that we can sort by that, or filter on it later if necessary. Because of how I joined the data, each item is attributed to its highest source of authority. The final list is written to <code>NonWildSpecies/nonWildSpecies_final_sources.tsv</code></p>
<div class="cell">
<div class="sourceCode cell-code" id="cb21"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb21-1"><a href="#cb21-1" aria-hidden="true" tabindex="-1"></a>all <span class="ot">&lt;-</span> <span class="fu">read.csv</span>(<span class="at">file =</span> <span class="st">"NonWildSpecies/nonWildSpecies_final.tsv"</span>, <span class="at">header =</span> T, </span>
<span id="cb21-2"><a href="#cb21-2" aria-hidden="true" tabindex="-1"></a>                <span class="at">sep =</span> <span class="st">"</span><span class="sc">\t</span><span class="st">"</span>, <span class="at">stringsAsFactors =</span> F)</span>
<span id="cb21-3"><a href="#cb21-3" aria-hidden="true" tabindex="-1"></a><span class="fu">names</span>(all) <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="st">"Species"</span>, <span class="st">"Common"</span>, <span class="st">"Old"</span>)</span>
<span id="cb21-4"><a href="#cb21-4" aria-hidden="true" tabindex="-1"></a>all<span class="sc">$</span>Category <span class="ot">&lt;-</span> <span class="fu">str_extract</span>(all<span class="sc">$</span>Old, <span class="fu">regex</span>(<span class="st">"^[:alpha:]+ [:alpha:]+"</span>))</span>
<span id="cb21-5"><a href="#cb21-5" aria-hidden="true" tabindex="-1"></a>all<span class="sc">$</span>Source <span class="ot">&lt;-</span> <span class="fu">str_replace</span>(all<span class="sc">$</span>Old, <span class="fu">regex</span>(<span class="st">"^[:alpha:]+ [:alpha:]+ "</span>), <span class="st">""</span>)</span>
<span id="cb21-6"><a href="#cb21-6" aria-hidden="true" tabindex="-1"></a>all<span class="sc">$</span>Old <span class="ot">&lt;-</span> <span class="cn">NULL</span></span>
<span id="cb21-7"><a href="#cb21-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb21-8"><a href="#cb21-8" aria-hidden="true" tabindex="-1"></a><span class="fu">write.table</span>(all,<span class="at">file =</span> <span class="st">"NonWildSpecies/nonWildSpecies_final_sources.tsv"</span>, </span>
<span id="cb21-9"><a href="#cb21-9" aria-hidden="true" tabindex="-1"></a>            <span class="at">sep =</span> <span class="st">"</span><span class="sc">\t</span><span class="st">"</span>, <span class="at">quote=</span>F,<span class="at">row.names =</span> F)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</section>
</section>
<section id="discover-metadata-state-for-papers-that-didnt-need-author-contact" class="level1">
<h1>Discover metadata state for papers that didn’t need author contact</h1>
<p>When we switched to documenting this effort in a publication, I asked the students to record the state of metadata for BioProjects that they flagged for author contact in the field author_contact_comments. Rachel has written a script to parse these results, but I forgot to ask the students to document the state of metadata for BioProjects that didn’t need author contact (because they already had coordinates and dates). So now I need to write some code to go look inside each of these BioProjects for which Relevance = TRUE but Authors_Contacted = FALSE.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb22"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb22-1"><a href="#cb22-1" aria-hidden="true" tabindex="-1"></a><span class="co">#get the object id of the non-marine list </span></span>
<span id="cb22-2"><a href="#cb22-2" aria-hidden="true" tabindex="-1"></a>nonmarineSRA_dribble <span class="ot">&lt;-</span> <span class="fu">drive_get</span>(<span class="at">path =</span></span>
<span id="cb22-3"><a href="#cb22-3" aria-hidden="true" tabindex="-1"></a>        <span class="st">"GEOME_Datathon/Datathon_Working_Directory/BioProject_Tables/nonMarine_SRA_BioProjects"</span>)</span>
<span id="cb22-4"><a href="#cb22-4" aria-hidden="true" tabindex="-1"></a><span class="co">#get the object id of the marine list </span></span>
<span id="cb22-5"><a href="#cb22-5" aria-hidden="true" tabindex="-1"></a>marineSRA_dribble <span class="ot">&lt;-</span> <span class="fu">drive_get</span>(<span class="at">path =</span></span>
<span id="cb22-6"><a href="#cb22-6" aria-hidden="true" tabindex="-1"></a>        <span class="st">"GEOME_Datathon/Datathon_Working_Directory/BioProject_Tables/Marine_SRA_BioProjects"</span>)</span>
<span id="cb22-7"><a href="#cb22-7" aria-hidden="true" tabindex="-1"></a><span class="co">#read in the data</span></span>
<span id="cb22-8"><a href="#cb22-8" aria-hidden="true" tabindex="-1"></a>nonmarineSRA <span class="ot">&lt;-</span> <span class="fu">range_read</span>(nonmarineSRA_dribble, <span class="at">sheet =</span> <span class="dv">1</span>, <span class="at">range =</span> <span class="st">"A:AA"</span>)</span>
<span id="cb22-9"><a href="#cb22-9" aria-hidden="true" tabindex="-1"></a>marineSRA <span class="ot">&lt;-</span> <span class="fu">range_read</span>(marineSRA_dribble, <span class="at">sheet =</span> <span class="dv">1</span>, <span class="at">range =</span> <span class="st">"A:AA"</span>)</span>
<span id="cb22-10"><a href="#cb22-10" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb22-11"><a href="#cb22-11" aria-hidden="true" tabindex="-1"></a>dataset <span class="ot">&lt;-</span> <span class="st">"nonmarine"</span> <span class="co">#or "nonmarine"</span></span>
<span id="cb22-12"><a href="#cb22-12" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb22-13"><a href="#cb22-13" aria-hidden="true" tabindex="-1"></a><span class="cf">if</span>(dataset <span class="sc">==</span> <span class="st">"marine"</span>){</span>
<span id="cb22-14"><a href="#cb22-14" aria-hidden="true" tabindex="-1"></a>  SRA <span class="ot">&lt;-</span> marineSRA</span>
<span id="cb22-15"><a href="#cb22-15" aria-hidden="true" tabindex="-1"></a>} <span class="cf">else</span>{SRA <span class="ot">&lt;-</span> nonmarineSRA}</span>
<span id="cb22-16"><a href="#cb22-16" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb22-17"><a href="#cb22-17" aria-hidden="true" tabindex="-1"></a><span class="co">#filter for datasets that are relevant, but authors haven't been contacted</span></span>
<span id="cb22-18"><a href="#cb22-18" aria-hidden="true" tabindex="-1"></a>lookups <span class="ot">&lt;-</span> SRA <span class="sc">%&gt;%</span> <span class="fu">filter</span>(Relevant <span class="sc">==</span> <span class="cn">TRUE</span>) <span class="co"># &amp; Authors_Contacted == FALSE)</span></span>
<span id="cb22-19"><a href="#cb22-19" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb22-20"><a href="#cb22-20" aria-hidden="true" tabindex="-1"></a><span class="co">#function of nested ifs to check completeness of each metadata column</span></span>
<span id="cb22-21"><a href="#cb22-21" aria-hidden="true" tabindex="-1"></a>completeness_check <span class="ot">&lt;-</span> <span class="cf">function</span>(n,na_count){</span>
<span id="cb22-22"><a href="#cb22-22" aria-hidden="true" tabindex="-1"></a>  completeness <span class="ot">&lt;-</span> <span class="cn">NA</span></span>
<span id="cb22-23"><a href="#cb22-23" aria-hidden="true" tabindex="-1"></a>  incompleteness_prop <span class="ot">&lt;-</span> na_count<span class="sc">/</span>n</span>
<span id="cb22-24"><a href="#cb22-24" aria-hidden="true" tabindex="-1"></a>  <span class="cf">if</span>(incompleteness_prop <span class="sc">==</span> <span class="dv">0</span>){completeness <span class="ot">=</span> <span class="st">"TRUE"</span>}</span>
<span id="cb22-25"><a href="#cb22-25" aria-hidden="true" tabindex="-1"></a>    <span class="cf">else</span>(<span class="cf">if</span>(incompleteness_prop <span class="sc">&lt;</span> <span class="fl">0.5</span>){completeness <span class="ot">=</span> <span class="st">"MOST"</span>}</span>
<span id="cb22-26"><a href="#cb22-26" aria-hidden="true" tabindex="-1"></a>       <span class="cf">else</span>(<span class="cf">if</span>(incompleteness_prop <span class="sc">&lt;</span> <span class="dv">1</span>){completeness <span class="ot">=</span> <span class="st">"SOME"</span>}</span>
<span id="cb22-27"><a href="#cb22-27" aria-hidden="true" tabindex="-1"></a>            <span class="cf">else</span>(<span class="cf">if</span>(incompleteness_prop <span class="sc">==</span> <span class="dv">1</span>){completeness <span class="ot">=</span> <span class="st">"FALSE"</span>}</span>
<span id="cb22-28"><a href="#cb22-28" aria-hidden="true" tabindex="-1"></a>                 )))</span>
<span id="cb22-29"><a href="#cb22-29" aria-hidden="true" tabindex="-1"></a>  <span class="fu">return</span>(completeness)</span>
<span id="cb22-30"><a href="#cb22-30" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb22-31"><a href="#cb22-31" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb22-32"><a href="#cb22-32" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span>(index <span class="cf">in</span> lookups<span class="sc">$</span>project_index){</span>
<span id="cb22-33"><a href="#cb22-33" aria-hidden="true" tabindex="-1"></a>  project_acc <span class="ot">&lt;-</span> lookups<span class="sc">$</span>project_acc_bioprj[<span class="fu">which</span>(lookups<span class="sc">$</span>project_index <span class="sc">==</span> index)]</span>
<span id="cb22-34"><a href="#cb22-34" aria-hidden="true" tabindex="-1"></a>  <span class="fu">print</span>(<span class="fu">paste0</span>(index,<span class="st">"_"</span>,project_acc))</span>
<span id="cb22-35"><a href="#cb22-35" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb22-36"><a href="#cb22-36" aria-hidden="true" tabindex="-1"></a>  <span class="cf">if</span>(dataset <span class="sc">==</span> <span class="st">"marine"</span>){</span>
<span id="cb22-37"><a href="#cb22-37" aria-hidden="true" tabindex="-1"></a>    projectpath <span class="ot">&lt;-</span> <span class="st">"GEOME_Datathon/Datathon_Working_Directory/BioProject_Tables/Marine_BioSample_Metadata/"</span></span>
<span id="cb22-38"><a href="#cb22-38" aria-hidden="true" tabindex="-1"></a>  }<span class="cf">else</span>{ projectpath <span class="ot">&lt;-</span><span class="st">"GEOME_Datathon/Datathon_Working_Directory/BioProject_Tables/NonMarine_BioSample_Metadata/"</span>}</span>
<span id="cb22-39"><a href="#cb22-39" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb22-40"><a href="#cb22-40" aria-hidden="true" tabindex="-1"></a>  project_dribble <span class="ot">&lt;-</span> <span class="fu">drive_get</span>(<span class="at">path =</span>  </span>
<span id="cb22-41"><a href="#cb22-41" aria-hidden="true" tabindex="-1"></a>          <span class="fu">paste0</span>(projectpath, index,<span class="st">"_"</span>,project_acc))</span>
<span id="cb22-42"><a href="#cb22-42" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb22-43"><a href="#cb22-43" aria-hidden="true" tabindex="-1"></a>  <span class="cf">if</span>(<span class="fu">length</span>(project_dribble<span class="sc">$</span>name)<span class="sc">==</span><span class="dv">0</span>){</span>
<span id="cb22-44"><a href="#cb22-44" aria-hidden="true" tabindex="-1"></a>  metadata <span class="ot">&lt;-</span> <span class="fu">read.xlsx</span>(<span class="fu">paste0</span>(<span class="st">"/Users/eric/Google_Drive/"</span>,projectpath,index,<span class="st">"_"</span>,project_acc,<span class="st">".xlsx"</span>), <span class="at">sheet =</span> <span class="dv">2</span>)</span>
<span id="cb22-45"><a href="#cb22-45" aria-hidden="true" tabindex="-1"></a>  }<span class="cf">else</span>{metadata <span class="ot">&lt;-</span> <span class="fu">range_read</span>(project_dribble, <span class="at">sheet =</span> <span class="dv">2</span>)}</span>
<span id="cb22-46"><a href="#cb22-46" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb22-47"><a href="#cb22-47" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb22-48"><a href="#cb22-48" aria-hidden="true" tabindex="-1"></a>  n <span class="ot">&lt;-</span> <span class="fu">length</span>(metadata<span class="sc">$</span>sheet_index)</span>
<span id="cb22-49"><a href="#cb22-49" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb22-50"><a href="#cb22-50" aria-hidden="true" tabindex="-1"></a>  <span class="co"># count the na's and then measure completeness</span></span>
<span id="cb22-51"><a href="#cb22-51" aria-hidden="true" tabindex="-1"></a>  completeness <span class="ot">&lt;-</span> metadata <span class="sc">%&gt;%</span> <span class="fu">map</span>(<span class="cf">function</span>(x) <span class="fu">sum</span>(<span class="fu">is.na</span>(x))) <span class="sc">%&gt;%</span> <span class="fu">map</span>(completeness_check, <span class="at">n =</span> n)</span>
<span id="cb22-52"><a href="#cb22-52" aria-hidden="true" tabindex="-1"></a>  <span class="co">#pick out categories of interest</span></span>
<span id="cb22-53"><a href="#cb22-53" aria-hidden="true" tabindex="-1"></a>  compall <span class="ot">&lt;-</span> completeness[<span class="fu">c</span>(<span class="dv">8</span>,<span class="dv">11</span>,<span class="dv">12</span>,<span class="dv">13</span>,<span class="dv">15</span>,<span class="dv">17</span>,<span class="dv">19</span>,<span class="dv">20</span>,<span class="dv">24</span>,<span class="dv">25</span>,<span class="dv">26</span>,<span class="dv">28</span>)]</span>
<span id="cb22-54"><a href="#cb22-54" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb22-55"><a href="#cb22-55" aria-hidden="true" tabindex="-1"></a>  <span class="co">#compose a statement to write back to main sheet</span></span>
<span id="cb22-56"><a href="#cb22-56" aria-hidden="true" tabindex="-1"></a>  completeness_comment <span class="ot">&lt;-</span> <span class="fu">tibble</span>(<span class="fu">paste</span>(<span class="st">"materialSampleID = "</span>, compall[<span class="dv">1</span>],</span>
<span id="cb22-57"><a href="#cb22-57" aria-hidden="true" tabindex="-1"></a>                                <span class="st">"|locality = "</span>, compall[<span class="dv">2</span>],</span>
<span id="cb22-58"><a href="#cb22-58" aria-hidden="true" tabindex="-1"></a>                                <span class="st">"|coordinates = "</span>, <span class="fu">paste</span>(compall[<span class="dv">3</span>],compall[<span class="dv">4</span>], <span class="at">sep=</span><span class="st">"&amp;"</span>),</span>
<span id="cb22-59"><a href="#cb22-59" aria-hidden="true" tabindex="-1"></a>                                <span class="st">"|country = "</span>, compall[<span class="dv">5</span>],</span>
<span id="cb22-60"><a href="#cb22-60" aria-hidden="true" tabindex="-1"></a>                                <span class="st">"|habitat = "</span>, compall[<span class="dv">6</span>],</span>
<span id="cb22-61"><a href="#cb22-61" aria-hidden="true" tabindex="-1"></a>                                <span class="st">"|environmentalMedium = "</span>, compall[<span class="dv">7</span>],</span>
<span id="cb22-62"><a href="#cb22-62" aria-hidden="true" tabindex="-1"></a>                                <span class="st">"|yearCollected = "</span>, compall[<span class="dv">8</span>],</span>
<span id="cb22-63"><a href="#cb22-63" aria-hidden="true" tabindex="-1"></a>                                <span class="st">"|permitInformation = "</span>, compall[<span class="dv">9</span>],</span>
<span id="cb22-64"><a href="#cb22-64" aria-hidden="true" tabindex="-1"></a>                                <span class="st">"|preservative = "</span>, compall[<span class="dv">11</span>],</span>
<span id="cb22-65"><a href="#cb22-65" aria-hidden="true" tabindex="-1"></a>                                <span class="st">"|derivedGeneticDataX = "</span>, compall[<span class="dv">12</span>],</span>
<span id="cb22-66"><a href="#cb22-66" aria-hidden="true" tabindex="-1"></a>                                <span class="st">"|associatedReferences = "</span>, compall[<span class="dv">10</span>],<span class="at">sep =</span> <span class="st">""</span>))</span>
<span id="cb22-67"><a href="#cb22-67" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb22-68"><a href="#cb22-68" aria-hidden="true" tabindex="-1"></a>  rownum <span class="ot">&lt;-</span> <span class="fu">which</span>(SRA<span class="sc">$</span>project_index <span class="sc">==</span> index)<span class="sc">+</span><span class="dv">1</span></span>
<span id="cb22-69"><a href="#cb22-69" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb22-70"><a href="#cb22-70" aria-hidden="true" tabindex="-1"></a>  <span class="fu">print</span>(<span class="fu">paste</span>(<span class="st">"Writing To"</span>, <span class="st">"Author_Contact_Comments_Script"</span>,rownum))</span>
<span id="cb22-71"><a href="#cb22-71" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb22-72"><a href="#cb22-72" aria-hidden="true" tabindex="-1"></a>  <span class="cf">if</span>(dataset <span class="sc">==</span> <span class="st">"marine"</span>){</span>
<span id="cb22-73"><a href="#cb22-73" aria-hidden="true" tabindex="-1"></a>    <span class="fu">range_write</span>(marineSRA_dribble, completeness_comment, <span class="at">sheet=</span><span class="dv">1</span>, <span class="at">range =</span> <span class="fu">paste0</span>(<span class="st">"Q"</span>,rownum), </span>
<span id="cb22-74"><a href="#cb22-74" aria-hidden="true" tabindex="-1"></a>              <span class="at">col_names =</span> F, <span class="at">reformat =</span> F)</span>
<span id="cb22-75"><a href="#cb22-75" aria-hidden="true" tabindex="-1"></a>  }<span class="cf">else</span>{<span class="fu">range_write</span>(nonmarineSRA_dribble, completeness_comment, <span class="at">sheet=</span><span class="dv">1</span>, <span class="at">range =</span> <span class="fu">paste0</span>(<span class="st">"P"</span>,rownum), </span>
<span id="cb22-76"><a href="#cb22-76" aria-hidden="true" tabindex="-1"></a>              <span class="at">col_names =</span> F, <span class="at">reformat =</span> F)}</span>
<span id="cb22-77"><a href="#cb22-77" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb22-78"><a href="#cb22-78" aria-hidden="true" tabindex="-1"></a>  <span class="co"># slow things down so we don't go over reads/minute quota</span></span>
<span id="cb22-79"><a href="#cb22-79" aria-hidden="true" tabindex="-1"></a>  <span class="fu">Sys.sleep</span>(<span class="dv">10</span>)</span>
<span id="cb22-80"><a href="#cb22-80" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb22-81"><a href="#cb22-81" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb22-82"><a href="#cb22-82" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb22-83"><a href="#cb22-83" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb22-84"><a href="#cb22-84" aria-hidden="true" tabindex="-1"></a>a<span class="ot">&lt;-</span><span class="fu">read.table</span>(<span class="fu">pipe</span>(<span class="st">"pbpaste"</span>),<span class="at">header=</span>F)</span>
<span id="cb22-85"><a href="#cb22-85" aria-hidden="true" tabindex="-1"></a>b<span class="ot">&lt;-</span><span class="fu">sum</span>(nonmarineSRA<span class="sc">$</span>Total_Minutes_Spent, <span class="at">na.rm =</span> T)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>Now I’m going to borrow Rachel’s code for parsing these crazy structured comments into a more sane table.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb23"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb23-1"><a href="#cb23-1" aria-hidden="true" tabindex="-1"></a>df <span class="ot">&lt;-</span> nonmarineSRA</span>
<span id="cb23-2"><a href="#cb23-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb23-3"><a href="#cb23-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb23-4"><a href="#cb23-4" aria-hidden="true" tabindex="-1"></a><span class="co"># Ran this loop first on Author_Contact_Comments, and then on Author_Contact_Comments_Script</span></span>
<span id="cb23-5"><a href="#cb23-5" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> (field <span class="cf">in</span> <span class="fu">rev</span>(<span class="fu">c</span>(<span class="st">"materialSampleID"</span>,<span class="st">"locality"</span>,</span>
<span id="cb23-6"><a href="#cb23-6" aria-hidden="true" tabindex="-1"></a>                   <span class="st">"coordinates"</span>,<span class="st">"country"</span>,<span class="st">"habitat"</span>,</span>
<span id="cb23-7"><a href="#cb23-7" aria-hidden="true" tabindex="-1"></a>                   <span class="st">"environmentalMedium"</span>, <span class="st">"yearCollected"</span>, </span>
<span id="cb23-8"><a href="#cb23-8" aria-hidden="true" tabindex="-1"></a>                   <span class="st">"permitInformation"</span>, <span class="st">"preservative"</span>,</span>
<span id="cb23-9"><a href="#cb23-9" aria-hidden="true" tabindex="-1"></a>                   <span class="st">"derivedGeneticDataX"</span>))) {</span>
<span id="cb23-10"><a href="#cb23-10" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb23-11"><a href="#cb23-11" aria-hidden="true" tabindex="-1"></a>df <span class="ot">&lt;-</span> df <span class="sc">%&gt;%</span> </span>
<span id="cb23-12"><a href="#cb23-12" aria-hidden="true" tabindex="-1"></a>  <span class="fu">separate</span>(., Author_Contact_Comments_Script, <span class="at">into =</span> <span class="fu">c</span>(<span class="st">"garbage"</span>,<span class="st">"working"</span>), <span class="at">sep =</span> <span class="fu">paste</span>(field), <span class="at">remove =</span> F, <span class="at">extra =</span> <span class="st">"drop"</span>) <span class="sc">%&gt;%</span> </span>
<span id="cb23-13"><a href="#cb23-13" aria-hidden="true" tabindex="-1"></a>  dplyr<span class="sc">::</span><span class="fu">select</span>(<span class="sc">-</span>garbage) <span class="sc">%&gt;%</span> </span>
<span id="cb23-14"><a href="#cb23-14" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">working =</span> <span class="fu">gsub</span>(<span class="st">"^ "</span>,<span class="st">""</span>,working)) <span class="sc">%&gt;%</span></span>
<span id="cb23-15"><a href="#cb23-15" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">working =</span> <span class="fu">gsub</span>(<span class="st">"[“”]"</span>,<span class="st">"</span><span class="sc">\"</span><span class="st">"</span>, working)) <span class="sc">%&gt;%</span> </span>
<span id="cb23-16"><a href="#cb23-16" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">working =</span> <span class="fu">gsub</span>(<span class="st">"^="</span>,<span class="st">""</span>,working)) <span class="sc">%&gt;%</span> </span>
<span id="cb23-17"><a href="#cb23-17" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">working =</span> <span class="fu">gsub</span>(<span class="st">"^ "</span>,<span class="st">""</span>,working)) <span class="sc">%&gt;%</span> </span>
<span id="cb23-18"><a href="#cb23-18" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">working =</span> <span class="fu">gsub</span>(<span class="st">"^[[:punct:]]"</span>,<span class="st">""</span>,working)) <span class="sc">%&gt;%</span> </span>
<span id="cb23-19"><a href="#cb23-19" aria-hidden="true" tabindex="-1"></a>  <span class="fu">separate</span>(., working, <span class="at">into =</span> <span class="fu">c</span>(<span class="st">"working.1"</span>), <span class="at">sep =</span> <span class="st">"</span><span class="sc">\"</span><span class="st">"</span>, <span class="at">remove =</span> T, <span class="at">extra =</span> <span class="st">"drop"</span>) <span class="sc">%&gt;%</span> </span>
<span id="cb23-20"><a href="#cb23-20" aria-hidden="true" tabindex="-1"></a>  <span class="fu">separate</span>(., working<span class="fl">.1</span>, <span class="at">into =</span> <span class="fu">c</span>(<span class="st">"working"</span>), <span class="at">sep =</span> <span class="st">" </span><span class="sc">\\</span><span class="st">|"</span>, <span class="at">remove =</span> T, <span class="at">extra =</span> <span class="st">"drop"</span>) <span class="sc">%&gt;%</span> </span>
<span id="cb23-21"><a href="#cb23-21" aria-hidden="true" tabindex="-1"></a>  <span class="fu">separate</span>(., working, <span class="at">into =</span> <span class="fu">c</span>(<span class="st">"working.1"</span>), <span class="at">sep =</span> <span class="st">","</span>, <span class="at">remove =</span> T, <span class="at">extra =</span> <span class="st">"drop"</span>) <span class="sc">%&gt;%</span></span>
<span id="cb23-22"><a href="#cb23-22" aria-hidden="true" tabindex="-1"></a>  <span class="fu">separate</span>(., working<span class="fl">.1</span>, <span class="at">into =</span> <span class="fu">c</span>(<span class="st">"working"</span>), <span class="at">sep =</span> <span class="st">" "</span>, <span class="at">remove =</span> T, <span class="at">extra =</span> <span class="st">"drop"</span>) <span class="sc">%&gt;%</span></span>
<span id="cb23-23"><a href="#cb23-23" aria-hidden="true" tabindex="-1"></a>  <span class="fu">separate</span>(., working, <span class="at">into =</span> <span class="fu">c</span>(<span class="st">"working.1"</span>), <span class="at">sep =</span> <span class="st">"</span><span class="sc">\\</span><span class="st">|"</span>, <span class="at">remove =</span> T, <span class="at">extra =</span> <span class="st">"drop"</span>) <span class="sc">%&gt;%</span></span>
<span id="cb23-24"><a href="#cb23-24" aria-hidden="true" tabindex="-1"></a>  <span class="fu">separate</span>(., working<span class="fl">.1</span>, <span class="at">into =</span> <span class="fu">c</span>(<span class="st">"final"</span>), <span class="at">sep =</span> <span class="st">"-"</span>, <span class="at">remove =</span> T, <span class="at">extra =</span> <span class="st">"drop"</span>) <span class="sc">%&gt;%</span></span>
<span id="cb23-25"><a href="#cb23-25" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">final =</span> <span class="fu">gsub</span>(<span class="st">"True"</span>,<span class="st">"TRUE"</span>,final)) <span class="sc">%&gt;%</span></span>
<span id="cb23-26"><a href="#cb23-26" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">final =</span> <span class="fu">gsub</span>(<span class="st">"true"</span>,<span class="st">"TRUE"</span>,final)) <span class="sc">%&gt;%</span></span>
<span id="cb23-27"><a href="#cb23-27" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">final =</span> <span class="fu">gsub</span>(<span class="st">"most"</span>,<span class="st">"MOST"</span>,final)) <span class="sc">%&gt;%</span></span>
<span id="cb23-28"><a href="#cb23-28" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">final =</span> <span class="fu">gsub</span>(<span class="st">"Most"</span>,<span class="st">"MOST"</span>,final)) <span class="sc">%&gt;%</span></span>
<span id="cb23-29"><a href="#cb23-29" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">final =</span> <span class="fu">gsub</span>(<span class="st">"MOST;"</span>,<span class="st">"MOST"</span>,final)) <span class="sc">%&gt;%</span></span>
<span id="cb23-30"><a href="#cb23-30" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">final =</span> <span class="fu">gsub</span>(<span class="st">"MOSTsee"</span>,<span class="st">"MOST"</span>,final)) <span class="sc">%&gt;%</span></span>
<span id="cb23-31"><a href="#cb23-31" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">final =</span> <span class="fu">gsub</span>(<span class="st">"some"</span>,<span class="st">"SOME"</span>,final)) <span class="sc">%&gt;%</span></span>
<span id="cb23-32"><a href="#cb23-32" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">final =</span> <span class="fu">gsub</span>(<span class="st">"Some"</span>,<span class="st">"SOME"</span>,final)) <span class="sc">%&gt;%</span></span>
<span id="cb23-33"><a href="#cb23-33" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">final =</span> <span class="fu">gsub</span>(<span class="st">"false"</span>,<span class="st">"FALSE"</span>,final)) <span class="sc">%&gt;%</span></span>
<span id="cb23-34"><a href="#cb23-34" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">final =</span> <span class="fu">gsub</span>(<span class="st">"False"</span>,<span class="st">"FALSE"</span>,final)) <span class="sc">%&gt;%</span> </span>
<span id="cb23-35"><a href="#cb23-35" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">final =</span> <span class="fu">gsub</span>(<span class="st">"FALSEsee"</span>,<span class="st">"FALSE"</span>,final)) <span class="sc">%&gt;%</span></span>
<span id="cb23-36"><a href="#cb23-36" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">final =</span> <span class="fu">gsub</span>(<span class="st">"FALSE&amp;FALSE"</span>,<span class="st">"FALSE"</span>,final)) <span class="sc">%&gt;%</span></span>
<span id="cb23-37"><a href="#cb23-37" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">final =</span> <span class="fu">gsub</span>(<span class="st">"MOST&amp;MOST"</span>,<span class="st">"MOST"</span>,final)) <span class="sc">%&gt;%</span></span>
<span id="cb23-38"><a href="#cb23-38" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">final =</span> <span class="fu">gsub</span>(<span class="st">"SOME&amp;SOME"</span>,<span class="st">"SOME"</span>,final)) <span class="sc">%&gt;%</span></span>
<span id="cb23-39"><a href="#cb23-39" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">final =</span> <span class="fu">gsub</span>(<span class="st">"TRUE&amp;TRUE"</span>,<span class="st">"TRUE"</span>,final)) <span class="sc">%&gt;%</span></span>
<span id="cb23-40"><a href="#cb23-40" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">final =</span> <span class="fu">gsub</span>(<span class="st">"</span><span class="sc">\\</span><span class="st">|permitInformation="</span>,<span class="st">""</span>,final)) <span class="sc">%&gt;%</span> </span>
<span id="cb23-41"><a href="#cb23-41" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">final =</span> <span class="fu">gsub</span>(<span class="st">";"</span>,<span class="st">""</span>,final)) <span class="sc">%&gt;%</span></span>
<span id="cb23-42"><a href="#cb23-42" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">final =</span> <span class="fu">gsub</span>(<span class="st">"</span><span class="sc">\\</span><span class="st">."</span>,<span class="st">""</span>,final)) <span class="sc">%&gt;%</span></span>
<span id="cb23-43"><a href="#cb23-43" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">final =</span> <span class="fu">gsub</span>(<span class="st">":"</span>,<span class="st">""</span>,final)) <span class="sc">%&gt;%</span> </span>
<span id="cb23-44"><a href="#cb23-44" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">final =</span> <span class="fu">gsub</span>(<span class="st">"'"</span>,<span class="st">""</span>,final))</span>
<span id="cb23-45"><a href="#cb23-45" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb23-46"><a href="#cb23-46" aria-hidden="true" tabindex="-1"></a><span class="fu">names</span>(df)[<span class="fu">names</span>(df)<span class="sc">==</span><span class="st">"final"</span>] <span class="ot">&lt;-</span> <span class="fu">paste</span>(<span class="st">"enteredData_has_"</span>, field, <span class="at">sep =</span> <span class="st">""</span>)</span>
<span id="cb23-47"><a href="#cb23-47" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb23-48"><a href="#cb23-48" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb23-49"><a href="#cb23-49" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb23-50"><a href="#cb23-50" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb23-51"><a href="#cb23-51" aria-hidden="true" tabindex="-1"></a><span class="co">#with the resulting dataframe, pick out just a few relevant columns and drop any that didn't have author_contact_comments</span></span>
<span id="cb23-52"><a href="#cb23-52" aria-hidden="true" tabindex="-1"></a>compare <span class="ot">&lt;-</span> df <span class="sc">%&gt;%</span> <span class="fu">select</span>(<span class="fu">any_of</span>(<span class="fu">contains</span>(<span class="fu">c</span>(<span class="st">"index"</span>,<span class="st">"Curator"</span>,<span class="st">"Paper"</span>,<span class="st">"student"</span>,<span class="st">"entered"</span>)))) <span class="sc">%&gt;%</span></span>
<span id="cb23-53"><a href="#cb23-53" aria-hidden="true" tabindex="-1"></a>                  <span class="fu">drop_na</span>(<span class="fu">any_of</span>(<span class="fu">contains</span>(<span class="st">"student"</span>)))</span>
<span id="cb23-54"><a href="#cb23-54" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb23-55"><a href="#cb23-55" aria-hidden="true" tabindex="-1"></a><span class="co">#loop through field names, combining the student determined field with what the metadata script found</span></span>
<span id="cb23-56"><a href="#cb23-56" aria-hidden="true" tabindex="-1"></a><span class="co"># the !! undoes the quasi-quotation for fieldname, allowing the value contained therein to be used to name the column</span></span>
<span id="cb23-57"><a href="#cb23-57" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> (field <span class="cf">in</span> <span class="fu">c</span>(<span class="st">"materialSampleID"</span>,<span class="st">"locality"</span>,</span>
<span id="cb23-58"><a href="#cb23-58" aria-hidden="true" tabindex="-1"></a>                   <span class="st">"coordinates"</span>,<span class="st">"country"</span>,<span class="st">"habitat"</span>,</span>
<span id="cb23-59"><a href="#cb23-59" aria-hidden="true" tabindex="-1"></a>                   <span class="st">"environmentalMedium"</span>, <span class="st">"yearCollected"</span>, </span>
<span id="cb23-60"><a href="#cb23-60" aria-hidden="true" tabindex="-1"></a>                   <span class="st">"permitInformation"</span>, <span class="st">"preservative"</span>,</span>
<span id="cb23-61"><a href="#cb23-61" aria-hidden="true" tabindex="-1"></a>                   <span class="st">"derivedGeneticDataX"</span>)) {</span>
<span id="cb23-62"><a href="#cb23-62" aria-hidden="true" tabindex="-1"></a>  fieldname <span class="ot">=</span> <span class="fu">paste</span>(field,<span class="st">"student_V_entered"</span>,<span class="at">sep=</span><span class="st">"_"</span>)</span>
<span id="cb23-63"><a href="#cb23-63" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb23-64"><a href="#cb23-64" aria-hidden="true" tabindex="-1"></a>  compare <span class="ot">&lt;-</span> compare <span class="sc">%&gt;%</span> <span class="fu">unite</span>(<span class="at">col =</span> <span class="sc">!!</span>fieldname, <span class="fu">contains</span>(field), <span class="at">sep =</span> <span class="st">"_V_"</span>, <span class="at">remove =</span> T)</span>
<span id="cb23-65"><a href="#cb23-65" aria-hidden="true" tabindex="-1"></a>                         </span>
<span id="cb23-66"><a href="#cb23-66" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb23-67"><a href="#cb23-67" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb23-68"><a href="#cb23-68" aria-hidden="true" tabindex="-1"></a><span class="co"># this command converts all values that have a match between student and script results to NA</span></span>
<span id="cb23-69"><a href="#cb23-69" aria-hidden="true" tabindex="-1"></a><span class="co"># the last filter command took forever to write, and removes rows that don't have any NAs</span></span>
<span id="cb23-70"><a href="#cb23-70" aria-hidden="true" tabindex="-1"></a>mismatches <span class="ot">&lt;-</span> compare <span class="sc">%&gt;%</span> <span class="fu">mutate_all</span>(<span class="fu">list</span>(<span class="sc">~</span><span class="fu">na_if</span>(.,<span class="st">"TRUE_V_TRUE"</span>))) <span class="sc">%&gt;%</span></span>
<span id="cb23-71"><a href="#cb23-71" aria-hidden="true" tabindex="-1"></a>            <span class="fu">mutate_all</span>(<span class="fu">list</span>(<span class="sc">~</span><span class="fu">na_if</span>(.,<span class="st">"MOST_V_MOST"</span>))) <span class="sc">%&gt;%</span></span>
<span id="cb23-72"><a href="#cb23-72" aria-hidden="true" tabindex="-1"></a>            <span class="fu">mutate_all</span>(<span class="fu">list</span>(<span class="sc">~</span><span class="fu">na_if</span>(.,<span class="st">"SOME_V_SOME"</span>))) <span class="sc">%&gt;%</span></span>
<span id="cb23-73"><a href="#cb23-73" aria-hidden="true" tabindex="-1"></a>            <span class="fu">mutate_all</span>(<span class="fu">list</span>(<span class="sc">~</span><span class="fu">na_if</span>(.,<span class="st">"FALSE_V_FALSE"</span>))) <span class="sc">%&gt;%</span></span>
<span id="cb23-74"><a href="#cb23-74" aria-hidden="true" tabindex="-1"></a>            <span class="fu">filter</span>(<span class="fu">rowSums</span>(<span class="fu">across</span>(<span class="fu">contains</span>(<span class="st">"student"</span>), <span class="sc">~</span> <span class="fu">is.na</span>(.))) <span class="sc">&lt;</span> <span class="dv">10</span>)</span>
<span id="cb23-75"><a href="#cb23-75" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb23-76"><a href="#cb23-76" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb23-77"><a href="#cb23-77" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb23-78"><a href="#cb23-78" aria-hidden="true" tabindex="-1"></a><span class="fu">write_csv</span>(mismatches[,<span class="sc">-</span><span class="dv">3</span>], <span class="st">"Student_V_EnteredMetadata.csv"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</section>
<section id="create-a-list-of-all-qcd-biosamples" class="level1">
<h1>Create a list of all QCd biosamples</h1>
<div class="cell">
<div class="sourceCode cell-code" id="cb24"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb24-1"><a href="#cb24-1" aria-hidden="true" tabindex="-1"></a>nm.path <span class="ot">&lt;-</span> <span class="st">"/Users/eric/Library/CloudStorage/GoogleDrive-eric.d.crandall@gmail.com/My Drive/GEOME_Datathon/Datathon_Working_Directory/BioProject_Tables/NonMarine_BioSample_Metadata/Completed_nonMarine_BioSample_Metadata_Sheets/QCd"</span></span>
<span id="cb24-2"><a href="#cb24-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb24-3"><a href="#cb24-3" aria-hidden="true" tabindex="-1"></a>m.path <span class="ot">&lt;-</span> <span class="st">"/Users/eric/Library/CloudStorage/GoogleDrive-eric.d.crandall@gmail.com/My Drive/GEOME_Datathon/Datathon_Working_Directory/BioProject_Tables/Marine_BioSample_Metadata/Completed_Marine_BioSample_Metadata_Sheets/QCd"</span></span>
<span id="cb24-4"><a href="#cb24-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb24-5"><a href="#cb24-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb24-6"><a href="#cb24-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb24-7"><a href="#cb24-7" aria-hidden="true" tabindex="-1"></a>biosampsQC <span class="ot">&lt;-</span> <span class="fu">tibble</span>() </span>
<span id="cb24-8"><a href="#cb24-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb24-9"><a href="#cb24-9" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span>(file <span class="cf">in</span> <span class="fu">list.files</span>(nm.path, <span class="at">full.names =</span> T)){</span>
<span id="cb24-10"><a href="#cb24-10" aria-hidden="true" tabindex="-1"></a>  <span class="fu">print</span>(file)</span>
<span id="cb24-11"><a href="#cb24-11" aria-hidden="true" tabindex="-1"></a>  metadata <span class="ot">&lt;-</span> <span class="fu">read_excel</span>(<span class="at">path =</span> file, </span>
<span id="cb24-12"><a href="#cb24-12" aria-hidden="true" tabindex="-1"></a>                           <span class="at">sheet =</span> <span class="st">"Samples"</span>,<span class="at">col_types =</span> <span class="st">"text"</span>)</span>
<span id="cb24-13"><a href="#cb24-13" aria-hidden="true" tabindex="-1"></a>  biosampsQC <span class="ot">&lt;-</span> <span class="fu">bind_rows</span>(biosampsQC, metadata)</span>
<span id="cb24-14"><a href="#cb24-14" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb24-15"><a href="#cb24-15" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb24-16"><a href="#cb24-16" aria-hidden="true" tabindex="-1"></a>biosampsQC_nodups <span class="ot">&lt;-</span> biosampsQC  <span class="sc">%&gt;%</span> <span class="fu">distinct</span>(biosample_acc_sra, <span class="at">.keep_all =</span> T) <span class="sc">%&gt;%</span>    <span class="fu">drop_na</span>(project_index)</span>
<span id="cb24-17"><a href="#cb24-17" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb24-18"><a href="#cb24-18" aria-hidden="true" tabindex="-1"></a>biosampsQC_nodups <span class="sc">%&gt;%</span> <span class="fu">summarize</span>(<span class="at">bioprojects =</span> <span class="fu">length</span>(<span class="fu">unique</span>(project_index)),</span>
<span id="cb24-19"><a href="#cb24-19" aria-hidden="true" tabindex="-1"></a>                       <span class="at">biosamps =</span> <span class="fu">length</span>(project_index),</span>
<span id="cb24-20"><a href="#cb24-20" aria-hidden="true" tabindex="-1"></a>                       <span class="at">nSpecies=</span> <span class="fu">length</span>(<span class="fu">unique</span>(specificEpithet)),</span>
<span id="cb24-21"><a href="#cb24-21" aria-hidden="true" tabindex="-1"></a>                        <span class="at">phyla =</span> <span class="fu">length</span>(<span class="fu">unique</span>(phylum)))</span>
<span id="cb24-22"><a href="#cb24-22" aria-hidden="true" tabindex="-1"></a><span class="co">#write_tsv(biosampsQC_nodups, "datathon1_working_files/paper2_all_QCd_biosample_list.tsv")</span></span>
<span id="cb24-23"><a href="#cb24-23" aria-hidden="true" tabindex="-1"></a><span class="fu">setdiff</span>(biosampsQC_nodups<span class="sc">$</span>project_index, df<span class="sc">$</span>project_index)</span>
<span id="cb24-24"><a href="#cb24-24" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb24-25"><a href="#cb24-25" aria-hidden="true" tabindex="-1"></a>biosampsQC_nodups_gathered <span class="ot">&lt;-</span> <span class="fu">left_join</span>(biosampsQC_nodups,df[,<span class="fu">c</span>(<span class="st">"project_index"</span>,<span class="st">"Metadata_Gathered"</span>)],<span class="at">by =</span> <span class="st">"project_index"</span>)</span>
<span id="cb24-26"><a href="#cb24-26" aria-hidden="true" tabindex="-1"></a><span class="fu">count</span>(biosampsQC_nodups_gathered, Metadata_Gathered)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<section id="summarize" class="level2">
<h2 class="anchored" data-anchor-id="summarize">Summarize</h2>
<div class="cell">
<div class="sourceCode cell-code" id="cb25"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb25-1"><a href="#cb25-1" aria-hidden="true" tabindex="-1"></a>biosampsQC_nodups <span class="ot">&lt;-</span> <span class="fu">read_tsv</span>(<span class="st">"datathon1_working_files/paper2_all_QCd_biosample_list.tsv"</span>,</span>
<span id="cb25-2"><a href="#cb25-2" aria-hidden="true" tabindex="-1"></a>                              <span class="at">col_types =</span> <span class="fu">cols</span>(<span class="at">.default =</span>   <span class="fu">col_character</span>()))</span>
<span id="cb25-3"><a href="#cb25-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb25-4"><a href="#cb25-4" aria-hidden="true" tabindex="-1"></a>biosamps<span class="ot">&lt;-</span><span class="fu">read_tsv</span>(<span class="st">"datathon1_working_files/paper2_all_biosample_list.tsv"</span>,<span class="at">col_types =</span> <span class="fu">cols</span>(<span class="at">.default =</span> <span class="fu">col_character</span>()))</span>
<span id="cb25-5"><a href="#cb25-5" aria-hidden="true" tabindex="-1"></a>                                                                                                              </span>
<span id="cb25-6"><a href="#cb25-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb25-7"><a href="#cb25-7" aria-hidden="true" tabindex="-1"></a>Datathon_Species <span class="ot">&lt;-</span> biosampsQC_nodups <span class="sc">%&gt;%</span> <span class="fu">group_by</span>(project_acc_bioprj,specificEpithet) <span class="sc">%&gt;%</span> </span>
<span id="cb25-8"><a href="#cb25-8" aria-hidden="true" tabindex="-1"></a>                      <span class="fu">summarize</span>(</span>
<span id="cb25-9"><a href="#cb25-9" aria-hidden="true" tabindex="-1"></a>                              <span class="at">genus =</span> <span class="fu">first</span>(genus),</span>
<span id="cb25-10"><a href="#cb25-10" aria-hidden="true" tabindex="-1"></a>                              <span class="at">phylum =</span> <span class="fu">first</span>(phylum),</span>
<span id="cb25-11"><a href="#cb25-11" aria-hidden="true" tabindex="-1"></a>                              <span class="at">class =</span> <span class="fu">first</span>(class),</span>
<span id="cb25-12"><a href="#cb25-12" aria-hidden="true" tabindex="-1"></a>                              <span class="at">specificEpithet =</span> <span class="fu">first</span>(specificEpithet),</span>
<span id="cb25-13"><a href="#cb25-13" aria-hidden="true" tabindex="-1"></a>                              <span class="at">project_index =</span> <span class="fu">first</span>(project_index),</span>
<span id="cb25-14"><a href="#cb25-14" aria-hidden="true" tabindex="-1"></a>                              <span class="at">project_acc_bioprj =</span> <span class="fu">first</span>(project_acc_bioprj),</span>
<span id="cb25-15"><a href="#cb25-15" aria-hidden="true" tabindex="-1"></a>                              <span class="at">BioSamples =</span> <span class="fu">n_distinct</span>(biosample_acc_sra),</span>
<span id="cb25-16"><a href="#cb25-16" aria-hidden="true" tabindex="-1"></a>                              <span class="at">Localities =</span> <span class="fu">n_distinct</span>(locality),</span>
<span id="cb25-17"><a href="#cb25-17" aria-hidden="true" tabindex="-1"></a>                              <span class="at">Countries =</span> <span class="fu">n_distinct</span>(country),</span>
<span id="cb25-18"><a href="#cb25-18" aria-hidden="true" tabindex="-1"></a>                              <span class="at">sampleEnteredBy =</span> <span class="fu">first</span>(sampleEnteredBy),</span>
<span id="cb25-19"><a href="#cb25-19" aria-hidden="true" tabindex="-1"></a>                              <span class="at">collectorList =</span> <span class="fu">first</span>(collectorList),</span>
<span id="cb25-20"><a href="#cb25-20" aria-hidden="true" tabindex="-1"></a>                              <span class="at">associatedReferences =</span> <span class="fu">first</span>(associatedReferences),</span>
<span id="cb25-21"><a href="#cb25-21" aria-hidden="true" tabindex="-1"></a>                              <span class="at">establishmentMeans =</span> <span class="fu">paste</span>(<span class="fu">unique</span>(establishmentMeans),</span>
<span id="cb25-22"><a href="#cb25-22" aria-hidden="true" tabindex="-1"></a>                                                         <span class="at">collapse =</span> <span class="st">"|"</span>),</span>
<span id="cb25-23"><a href="#cb25-23" aria-hidden="true" tabindex="-1"></a>                              <span class="at">habitat =</span> <span class="fu">paste</span>(<span class="fu">unique</span>(habitat),</span>
<span id="cb25-24"><a href="#cb25-24" aria-hidden="true" tabindex="-1"></a>                                                         <span class="at">collapse =</span> <span class="st">"|"</span>),</span>
<span id="cb25-25"><a href="#cb25-25" aria-hidden="true" tabindex="-1"></a>                              <span class="at">library_selection_sra =</span> <span class="fu">paste</span>(<span class="fu">unique</span>(library_selection_sra),</span>
<span id="cb25-26"><a href="#cb25-26" aria-hidden="true" tabindex="-1"></a>                                                         <span class="at">collapse =</span> <span class="st">"|"</span>),</span>
<span id="cb25-27"><a href="#cb25-27" aria-hidden="true" tabindex="-1"></a>                              <span class="at">library_strat_sra =</span> <span class="fu">paste</span>(<span class="fu">unique</span>(library_strat_sra),</span>
<span id="cb25-28"><a href="#cb25-28" aria-hidden="true" tabindex="-1"></a>                                                         <span class="at">collapse =</span> <span class="st">"|"</span>),</span>
<span id="cb25-29"><a href="#cb25-29" aria-hidden="true" tabindex="-1"></a>                              <span class="at">sequencing_platform =</span> <span class="fu">paste</span>(<span class="fu">unique</span>(sequencing_platform),</span>
<span id="cb25-30"><a href="#cb25-30" aria-hidden="true" tabindex="-1"></a>                                                         <span class="at">collapse =</span> <span class="st">"|"</span>),</span>
<span id="cb25-31"><a href="#cb25-31" aria-hidden="true" tabindex="-1"></a>                              <span class="at">instrument_model =</span> <span class="fu">paste</span>(<span class="fu">unique</span>(instrument_model),</span>
<span id="cb25-32"><a href="#cb25-32" aria-hidden="true" tabindex="-1"></a>                                                         <span class="at">collapse =</span> <span class="st">"|"</span>)</span>
<span id="cb25-33"><a href="#cb25-33" aria-hidden="true" tabindex="-1"></a>                      )</span>
<span id="cb25-34"><a href="#cb25-34" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb25-35"><a href="#cb25-35" aria-hidden="true" tabindex="-1"></a>biosamps<span class="sc">$</span>QC <span class="ot">&lt;-</span> <span class="fu">as.logical</span>(biosamps<span class="sc">$</span>QC)</span>
<span id="cb25-36"><a href="#cb25-36" aria-hidden="true" tabindex="-1"></a>biosamps_old <span class="ot">&lt;-</span> biosamps <span class="sc">%&gt;%</span> <span class="fu">filter</span>(QC) </span>
<span id="cb25-37"><a href="#cb25-37" aria-hidden="true" tabindex="-1"></a>biosampsQC_nodups <span class="sc">%&gt;%</span>  <span class="fu">summarize</span>(<span class="at">bioprojects =</span> <span class="fu">length</span>(<span class="fu">unique</span>(project_acc_bioprj)),</span>
<span id="cb25-38"><a href="#cb25-38" aria-hidden="true" tabindex="-1"></a>                                      <span class="at">biosamps =</span> <span class="fu">length</span>(project_index), </span>
<span id="cb25-39"><a href="#cb25-39" aria-hidden="true" tabindex="-1"></a>                             <span class="at">nSpecies=</span> <span class="fu">length</span>(<span class="fu">unique</span>(specificEpithet)), </span>
<span id="cb25-40"><a href="#cb25-40" aria-hidden="true" tabindex="-1"></a>                             <span class="at">phyla =</span> <span class="fu">length</span>(<span class="fu">unique</span>(phylum)))</span>
<span id="cb25-41"><a href="#cb25-41" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb25-42"><a href="#cb25-42" aria-hidden="true" tabindex="-1"></a>newBioProjects <span class="ot">&lt;-</span> <span class="fu">setdiff</span>(biosampsQC_nodups<span class="sc">$</span>project_index,biosamps_old<span class="sc">$</span>project_index)</span>
<span id="cb25-43"><a href="#cb25-43" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb25-44"><a href="#cb25-44" aria-hidden="true" tabindex="-1"></a>newBioProjects <span class="ot">&lt;-</span> <span class="fu">setdiff</span>(biosampsQC_nodups<span class="sc">$</span>project_acc_bioprj,biosamps<span class="sc">$</span>project_acc_bioprj)</span>
<span id="cb25-45"><a href="#cb25-45" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb25-46"><a href="#cb25-46" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb25-47"><a href="#cb25-47" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb25-48"><a href="#cb25-48" aria-hidden="true" tabindex="-1"></a><span class="co">#write_tsv(Datathon_Species, "datathon1_working_files/GEOME_Datathon_Species_datasets.tsv")                          </span></span>
<span id="cb25-49"><a href="#cb25-49" aria-hidden="true" tabindex="-1"></a>                              </span>
<span id="cb25-50"><a href="#cb25-50" aria-hidden="true" tabindex="-1"></a>df<span class="sc">$</span>Metadata_Gathered[df<span class="sc">$</span>project_index <span class="sc">%in%</span> <span class="fu">unique</span>(biosampsQC_nodups<span class="sc">$</span>project_index)] </span>
<span id="cb25-51"><a href="#cb25-51" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb25-52"><a href="#cb25-52" aria-hidden="true" tabindex="-1"></a>test <span class="ot">&lt;-</span> df <span class="sc">%&gt;%</span> <span class="fu">filter</span>(df<span class="sc">$</span>project_index <span class="sc">%in%</span> <span class="fu">unique</span>(biosampsQC_nodups<span class="sc">$</span>project_index)) <span class="sc">%&gt;%</span> <span class="fu">summarize</span>()</span>
<span id="cb25-53"><a href="#cb25-53" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb25-54"><a href="#cb25-54" aria-hidden="true" tabindex="-1"></a>biosampsQC_nodup_gathered <span class="ot">&lt;-</span> <span class="fu">left_join</span>(biosampsQC_nodups,df[,<span class="fu">c</span>(<span class="st">"project_index"</span>,<span class="st">"Metadata_Gathered"</span>)],<span class="at">by =</span> <span class="st">"project_index"</span>) </span>
<span id="cb25-55"><a href="#cb25-55" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb25-56"><a href="#cb25-56" aria-hidden="true" tabindex="-1"></a> biosampsQC_nodup_gathered <span class="sc">%&gt;%</span> <span class="fu">filter</span>(project_acc_bioprj <span class="sc">%in%</span> newBioProjects) <span class="sc">%&gt;%</span> <span class="fu">count</span>(Metadata_Gathered)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</section>
</section>
<section id="interpreting-the-logistic-models" class="level1">
<h1>Interpreting the logistic models</h1>
<p>Gideon created Bayesian logistic models (in ./models) of the effect of BioProject age on the presence of various metadata categories.</p>
<section id="analysis-1" class="level2">
<h2 class="anchored" data-anchor-id="analysis-1">Analysis 1</h2>
<p>P(metadata in SRA or paper aka before author contact) ~ registration date of BioProject</p>
<p>must have year &amp; (locality OR coords) for spatiotemp to be counted as present; inclusion criteria - relevant = T plus a handful of other decisions to get to the N = 492 bioprjs</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb26"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb26-1"><a href="#cb26-1" aria-hidden="true" tabindex="-1"></a>m1Betas <span class="ot">&lt;-</span> <span class="fu">read_delim</span>(<span class="st">"figures_and_outputs/analysis1_betaTable.csv"</span>,</span>
<span id="cb26-2"><a href="#cb26-2" aria-hidden="true" tabindex="-1"></a>                      <span class="at">delim =</span> <span class="st">" "</span>) <span class="sc">%&gt;%</span> </span>
<span id="cb26-3"><a href="#cb26-3" aria-hidden="true" tabindex="-1"></a>          <span class="co">#split the CI column</span></span>
<span id="cb26-4"><a href="#cb26-4" aria-hidden="true" tabindex="-1"></a>          <span class="fu">mutate</span>(<span class="at">CI95 =</span> <span class="fu">str_extract_all</span>(<span class="st">`</span><span class="at">95% CI</span><span class="st">`</span>,<span class="st">"-*[0-9]</span><span class="sc">\\</span><span class="st">.[0-9]+"</span>)) <span class="sc">%&gt;%</span></span>
<span id="cb26-5"><a href="#cb26-5" aria-hidden="true" tabindex="-1"></a>          <span class="co"># move the resulting list column into two columns</span></span>
<span id="cb26-6"><a href="#cb26-6" aria-hidden="true" tabindex="-1"></a>          <span class="fu">unnest_wider</span>(CI95, <span class="at">names_sep =</span> <span class="st">"_"</span>) <span class="sc">%&gt;%</span> </span>
<span id="cb26-7"><a href="#cb26-7" aria-hidden="true" tabindex="-1"></a>          <span class="co">#change to numeric</span></span>
<span id="cb26-8"><a href="#cb26-8" aria-hidden="true" tabindex="-1"></a>          <span class="fu">mutate</span>(<span class="fu">across</span>(<span class="fu">starts_with</span>(<span class="st">"CI"</span>),as.numeric)) <span class="sc">%&gt;%</span> </span>
<span id="cb26-9"><a href="#cb26-9" aria-hidden="true" tabindex="-1"></a>          <span class="co">#exponentiate to get odds ratio</span></span>
<span id="cb26-10"><a href="#cb26-10" aria-hidden="true" tabindex="-1"></a>          <span class="fu">mutate</span>(<span class="at">OddsMean =</span> <span class="fu">exp</span>(mean), <span class="at">OddsLo95CI =</span> <span class="fu">exp</span>(CI95_1), </span>
<span id="cb26-11"><a href="#cb26-11" aria-hidden="true" tabindex="-1"></a>                 <span class="at">OddsHi95CI =</span> <span class="fu">exp</span>(CI95_2))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stderr">
<pre><code>Rows: 12 Columns: 5
── Column specification ────────────────────────────────────────────────────────
Delimiter: " "
chr (2): model, 95% CI
dbl (3): mean, median, p-value

ℹ Use `spec()` to retrieve the full column specification for this data.
ℹ Specify the column types or set `show_col_types = FALSE` to quiet this message.</code></pre>
</div>
<div class="sourceCode cell-code" id="cb28"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb28-1"><a href="#cb28-1" aria-hidden="true" tabindex="-1"></a><span class="fu">kable</span>(m1Betas[,<span class="fu">c</span>(<span class="dv">1</span>,<span class="dv">2</span>,<span class="dv">5</span>,<span class="dv">8</span><span class="sc">:</span><span class="dv">10</span>)], <span class="at">digits=</span><span class="dv">3</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<table class="table table-sm table-striped">
<colgroup>
<col style="width: 31%">
<col style="width: 10%">
<col style="width: 11%">
<col style="width: 13%">
<col style="width: 16%">
<col style="width: 16%">
</colgroup>
<thead>
<tr class="header">
<th style="text-align: left;">model</th>
<th style="text-align: right;">mean</th>
<th style="text-align: right;">p-value</th>
<th style="text-align: right;">OddsMean</th>
<th style="text-align: right;">OddsLo95CI</th>
<th style="text-align: right;">OddsHi95CI</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td style="text-align: left;">Publication DOI</td>
<td style="text-align: right;">0.775</td>
<td style="text-align: right;">0.000</td>
<td style="text-align: right;">2.171</td>
<td style="text-align: right;">1.351</td>
<td style="text-align: right;">3.789</td>
</tr>
<tr class="even">
<td style="text-align: left;">Derived genetic data</td>
<td style="text-align: right;">-0.029</td>
<td style="text-align: right;">0.556</td>
<td style="text-align: right;">0.971</td>
<td style="text-align: right;">0.875</td>
<td style="text-align: right;">1.090</td>
</tr>
<tr class="odd">
<td style="text-align: left;">Preservative used</td>
<td style="text-align: right;">-0.111</td>
<td style="text-align: right;">0.036</td>
<td style="text-align: right;">0.895</td>
<td style="text-align: right;">0.804</td>
<td style="text-align: right;">0.991</td>
</tr>
<tr class="even">
<td style="text-align: left;">Permit ID</td>
<td style="text-align: right;">-0.096</td>
<td style="text-align: right;">0.146</td>
<td style="text-align: right;">0.908</td>
<td style="text-align: right;">0.804</td>
<td style="text-align: right;">1.025</td>
</tr>
<tr class="odd">
<td style="text-align: left;">Collection year</td>
<td style="text-align: right;">-0.133</td>
<td style="text-align: right;">0.008</td>
<td style="text-align: right;">0.875</td>
<td style="text-align: right;">0.792</td>
<td style="text-align: right;">0.967</td>
</tr>
<tr class="even">
<td style="text-align: left;">Enviro. medium</td>
<td style="text-align: right;">0.176</td>
<td style="text-align: right;">0.032</td>
<td style="text-align: right;">1.192</td>
<td style="text-align: right;">1.016</td>
<td style="text-align: right;">1.426</td>
</tr>
<tr class="odd">
<td style="text-align: left;">Habitat</td>
<td style="text-align: right;">0.141</td>
<td style="text-align: right;">0.044</td>
<td style="text-align: right;">1.151</td>
<td style="text-align: right;">1.006</td>
<td style="text-align: right;">1.330</td>
</tr>
<tr class="even">
<td style="text-align: left;">Country</td>
<td style="text-align: right;">-0.012</td>
<td style="text-align: right;">0.884</td>
<td style="text-align: right;">0.988</td>
<td style="text-align: right;">0.820</td>
<td style="text-align: right;">1.210</td>
</tr>
<tr class="odd">
<td style="text-align: left;">Lat./long.</td>
<td style="text-align: right;">0.107</td>
<td style="text-align: right;">0.052</td>
<td style="text-align: right;">1.113</td>
<td style="text-align: right;">0.999</td>
<td style="text-align: right;">1.237</td>
</tr>
<tr class="even">
<td style="text-align: left;">Place name</td>
<td style="text-align: right;">-0.026</td>
<td style="text-align: right;">0.694</td>
<td style="text-align: right;">0.974</td>
<td style="text-align: right;">0.856</td>
<td style="text-align: right;">1.124</td>
</tr>
<tr class="odd">
<td style="text-align: left;">Sample ID</td>
<td style="text-align: right;">0.016</td>
<td style="text-align: right;">0.830</td>
<td style="text-align: right;">1.016</td>
<td style="text-align: right;">0.894</td>
<td style="text-align: right;">1.162</td>
</tr>
<tr class="even">
<td style="text-align: left;">Spatiotemporal</td>
<td style="text-align: right;">-0.145</td>
<td style="text-align: right;">0.006</td>
<td style="text-align: right;">0.865</td>
<td style="text-align: right;">0.775</td>
<td style="text-align: right;">0.964</td>
</tr>
</tbody>
</table>
</div>
</div>
</section>
<section id="analysis-2" class="level2">
<h2 class="anchored" data-anchor-id="analysis-2">Analysis 2</h2>
<p>P(author response|authors contacted = T) ~ registration date of BioProject</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb29"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb29-1"><a href="#cb29-1" aria-hidden="true" tabindex="-1"></a>m2Betas <span class="ot">&lt;-</span> <span class="fu">read_delim</span>(<span class="st">"figures_and_outputs/analysis2_betaTable.csv"</span>,</span>
<span id="cb29-2"><a href="#cb29-2" aria-hidden="true" tabindex="-1"></a>                      <span class="at">delim =</span> <span class="st">" "</span>) <span class="sc">%&gt;%</span> </span>
<span id="cb29-3"><a href="#cb29-3" aria-hidden="true" tabindex="-1"></a>          <span class="co">#split the CI column</span></span>
<span id="cb29-4"><a href="#cb29-4" aria-hidden="true" tabindex="-1"></a>          <span class="fu">mutate</span>(<span class="at">CI95 =</span> <span class="fu">str_extract_all</span>(<span class="st">`</span><span class="at">95% CI</span><span class="st">`</span>,<span class="st">"-*[0-9]</span><span class="sc">\\</span><span class="st">.[0-9]+"</span>)) <span class="sc">%&gt;%</span></span>
<span id="cb29-5"><a href="#cb29-5" aria-hidden="true" tabindex="-1"></a>          <span class="co"># move the resulting list column into two columns</span></span>
<span id="cb29-6"><a href="#cb29-6" aria-hidden="true" tabindex="-1"></a>          <span class="fu">unnest_wider</span>(CI95, <span class="at">names_sep =</span> <span class="st">"_"</span>) <span class="sc">%&gt;%</span> </span>
<span id="cb29-7"><a href="#cb29-7" aria-hidden="true" tabindex="-1"></a>          <span class="co">#change to numeric</span></span>
<span id="cb29-8"><a href="#cb29-8" aria-hidden="true" tabindex="-1"></a>          <span class="fu">mutate</span>(<span class="fu">across</span>(<span class="fu">starts_with</span>(<span class="st">"CI"</span>),as.numeric)) <span class="sc">%&gt;%</span> </span>
<span id="cb29-9"><a href="#cb29-9" aria-hidden="true" tabindex="-1"></a>          <span class="co">#exponentiate to get odds ratio</span></span>
<span id="cb29-10"><a href="#cb29-10" aria-hidden="true" tabindex="-1"></a>          <span class="fu">mutate</span>(<span class="at">OddsMean =</span> <span class="fu">exp</span>(mean), <span class="at">OddsLo95CI =</span> <span class="fu">exp</span>(CI95_1), </span>
<span id="cb29-11"><a href="#cb29-11" aria-hidden="true" tabindex="-1"></a>                 <span class="at">OddsHi95CI =</span> <span class="fu">exp</span>(CI95_2))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stderr">
<pre><code>Rows: 1 Columns: 5
── Column specification ────────────────────────────────────────────────────────
Delimiter: " "
chr (1): 95% CI
dbl (4): model, mean, median, p-value

ℹ Use `spec()` to retrieve the full column specification for this data.
ℹ Specify the column types or set `show_col_types = FALSE` to quiet this message.</code></pre>
</div>
<div class="sourceCode cell-code" id="cb31"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb31-1"><a href="#cb31-1" aria-hidden="true" tabindex="-1"></a><span class="fu">kable</span>(m2Betas[,<span class="fu">c</span>(<span class="dv">1</span>,<span class="dv">2</span>,<span class="dv">5</span>,<span class="dv">8</span><span class="sc">:</span><span class="dv">10</span>)], <span class="at">digits=</span><span class="dv">3</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<table class="table table-sm table-striped">
<thead>
<tr class="header">
<th style="text-align: right;">model</th>
<th style="text-align: right;">mean</th>
<th style="text-align: right;">p-value</th>
<th style="text-align: right;">OddsMean</th>
<th style="text-align: right;">OddsLo95CI</th>
<th style="text-align: right;">OddsHi95CI</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td style="text-align: right;">1</td>
<td style="text-align: right;">0.227</td>
<td style="text-align: right;">0.002</td>
<td style="text-align: right;">1.255</td>
<td style="text-align: right;">1.12</td>
<td style="text-align: right;">1.412</td>
</tr>
</tbody>
</table>
</div>
</div>
</section>
<section id="analysis-3" class="level2">
<h2 class="anchored" data-anchor-id="analysis-3">Analysis 3</h2>
<p>P(recovered partial data|author response = T) ~ registration date of BioProject Recovered metadata = T if spatiotemp (collection date AND (coords or locality)) increases from MID to POST</p>
<p>must have gained year OR (locality OR coords) metadata; any amount of gain counts (e.g.&nbsp;F -&gt; SOME, SOME -&gt; T, F -&gt; MOST, etc.); inclusion criteria - authors responded and dataset was missing any amount of data in locality or year or coords (after looking in papers)</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb32"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb32-1"><a href="#cb32-1" aria-hidden="true" tabindex="-1"></a>m3Betas <span class="ot">&lt;-</span> <span class="fu">read_delim</span>(<span class="st">"figures_and_outputs/analysis3_betaTable.csv"</span>,</span>
<span id="cb32-2"><a href="#cb32-2" aria-hidden="true" tabindex="-1"></a>                      <span class="at">delim =</span> <span class="st">" "</span>) <span class="sc">%&gt;%</span> </span>
<span id="cb32-3"><a href="#cb32-3" aria-hidden="true" tabindex="-1"></a>          <span class="co">#split the CI column</span></span>
<span id="cb32-4"><a href="#cb32-4" aria-hidden="true" tabindex="-1"></a>          <span class="fu">mutate</span>(<span class="at">CI95 =</span> <span class="fu">str_extract_all</span>(<span class="st">`</span><span class="at">95% CI</span><span class="st">`</span>,<span class="st">"-*[0-9]</span><span class="sc">\\</span><span class="st">.[0-9]+"</span>)) <span class="sc">%&gt;%</span></span>
<span id="cb32-5"><a href="#cb32-5" aria-hidden="true" tabindex="-1"></a>          <span class="co"># move the resulting list column into two columns</span></span>
<span id="cb32-6"><a href="#cb32-6" aria-hidden="true" tabindex="-1"></a>          <span class="fu">unnest_wider</span>(CI95, <span class="at">names_sep =</span> <span class="st">"_"</span>) <span class="sc">%&gt;%</span> </span>
<span id="cb32-7"><a href="#cb32-7" aria-hidden="true" tabindex="-1"></a>          <span class="co">#change to numeric</span></span>
<span id="cb32-8"><a href="#cb32-8" aria-hidden="true" tabindex="-1"></a>          <span class="fu">mutate</span>(<span class="fu">across</span>(<span class="fu">starts_with</span>(<span class="st">"CI"</span>),as.numeric)) <span class="sc">%&gt;%</span> </span>
<span id="cb32-9"><a href="#cb32-9" aria-hidden="true" tabindex="-1"></a>          <span class="co">#exponentiate to get odds ratio</span></span>
<span id="cb32-10"><a href="#cb32-10" aria-hidden="true" tabindex="-1"></a>          <span class="fu">mutate</span>(<span class="at">OddsMean =</span> <span class="fu">exp</span>(mean), <span class="at">OddsLo95CI =</span> <span class="fu">exp</span>(CI95_1), </span>
<span id="cb32-11"><a href="#cb32-11" aria-hidden="true" tabindex="-1"></a>                 <span class="at">OddsHi95CI =</span> <span class="fu">exp</span>(CI95_2))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stderr">
<pre><code>Rows: 12 Columns: 5
── Column specification ────────────────────────────────────────────────────────
Delimiter: " "
chr (2): model, 95% CI
dbl (3): mean, median, p-value

ℹ Use `spec()` to retrieve the full column specification for this data.
ℹ Specify the column types or set `show_col_types = FALSE` to quiet this message.</code></pre>
</div>
<div class="sourceCode cell-code" id="cb34"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb34-1"><a href="#cb34-1" aria-hidden="true" tabindex="-1"></a><span class="fu">kable</span>(m3Betas[,<span class="fu">c</span>(<span class="dv">1</span>,<span class="dv">2</span>,<span class="dv">5</span>,<span class="dv">8</span><span class="sc">:</span><span class="dv">10</span>)], <span class="at">digits=</span><span class="dv">3</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<table class="table table-sm table-striped">
<colgroup>
<col style="width: 37%">
<col style="width: 9%">
<col style="width: 10%">
<col style="width: 12%">
<col style="width: 14%">
<col style="width: 14%">
</colgroup>
<thead>
<tr class="header">
<th style="text-align: left;">model</th>
<th style="text-align: right;">mean</th>
<th style="text-align: right;">p-value</th>
<th style="text-align: right;">OddsMean</th>
<th style="text-align: right;">OddsLo95CI</th>
<th style="text-align: right;">OddsHi95CI</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td style="text-align: left;">datathonderivedGeneticDataX</td>
<td style="text-align: right;">-0.372</td>
<td style="text-align: right;">0.076</td>
<td style="text-align: right;">0.689</td>
<td style="text-align: right;">0.416</td>
<td style="text-align: right;">1.050</td>
</tr>
<tr class="even">
<td style="text-align: left;">datathonpermitInformation</td>
<td style="text-align: right;">-0.555</td>
<td style="text-align: right;">0.058</td>
<td style="text-align: right;">0.574</td>
<td style="text-align: right;">0.270</td>
<td style="text-align: right;">1.003</td>
</tr>
<tr class="odd">
<td style="text-align: left;">datathonyearCollected</td>
<td style="text-align: right;">-0.174</td>
<td style="text-align: right;">0.048</td>
<td style="text-align: right;">0.840</td>
<td style="text-align: right;">0.696</td>
<td style="text-align: right;">NA</td>
</tr>
<tr class="even">
<td style="text-align: left;">datathonmaterialSampleID</td>
<td style="text-align: right;">-0.259</td>
<td style="text-align: right;">0.204</td>
<td style="text-align: right;">0.772</td>
<td style="text-align: right;">0.528</td>
<td style="text-align: right;">1.138</td>
</tr>
<tr class="odd">
<td style="text-align: left;">datathonpreservative</td>
<td style="text-align: right;">-0.438</td>
<td style="text-align: right;">0.014</td>
<td style="text-align: right;">0.645</td>
<td style="text-align: right;">0.418</td>
<td style="text-align: right;">0.922</td>
</tr>
<tr class="even">
<td style="text-align: left;">datathoncoordinates</td>
<td style="text-align: right;">-0.151</td>
<td style="text-align: right;">0.190</td>
<td style="text-align: right;">0.860</td>
<td style="text-align: right;">0.680</td>
<td style="text-align: right;">1.051</td>
</tr>
<tr class="odd">
<td style="text-align: left;">datathonlocality</td>
<td style="text-align: right;">0.035</td>
<td style="text-align: right;">0.830</td>
<td style="text-align: right;">1.036</td>
<td style="text-align: right;">0.698</td>
<td style="text-align: right;">1.527</td>
</tr>
<tr class="even">
<td style="text-align: left;">datathoncountry</td>
<td style="text-align: right;">-0.187</td>
<td style="text-align: right;">0.450</td>
<td style="text-align: right;">0.829</td>
<td style="text-align: right;">0.500</td>
<td style="text-align: right;">1.281</td>
</tr>
<tr class="odd">
<td style="text-align: left;">datathonhabitat</td>
<td style="text-align: right;">-0.055</td>
<td style="text-align: right;">0.834</td>
<td style="text-align: right;">0.946</td>
<td style="text-align: right;">0.611</td>
<td style="text-align: right;">1.454</td>
</tr>
<tr class="even">
<td style="text-align: left;">datathonenvironmentalMedium</td>
<td style="text-align: right;">-0.533</td>
<td style="text-align: right;">0.096</td>
<td style="text-align: right;">0.587</td>
<td style="text-align: right;">0.276</td>
<td style="text-align: right;">1.081</td>
</tr>
<tr class="odd">
<td style="text-align: left;">datathonpublication</td>
<td style="text-align: right;">-6.054</td>
<td style="text-align: right;">0.382</td>
<td style="text-align: right;">0.002</td>
<td style="text-align: right;">2.713</td>
<td style="text-align: right;">466.380</td>
</tr>
<tr class="even">
<td style="text-align: left;">datathonspatiotemp</td>
<td style="text-align: right;">-0.211</td>
<td style="text-align: right;">0.008</td>
<td style="text-align: right;">0.810</td>
<td style="text-align: right;">0.680</td>
<td style="text-align: right;">0.949</td>
</tr>
</tbody>
</table>
</div>
</div>
</section>
<section id="analysis-4" class="level2">
<h2 class="anchored" data-anchor-id="analysis-4">Analysis 4</h2>
<p>gained enough metadata to have year &amp; (locality OR coords) for &gt;= 50% of samples; only gains that flip metadata from F/SOME to MOST/T count P(recovered all data|author response = T) ~ registration date of BioProject</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb35"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb35-1"><a href="#cb35-1" aria-hidden="true" tabindex="-1"></a>m4Betas <span class="ot">&lt;-</span> <span class="fu">read_delim</span>(<span class="st">"figures_and_outputs/analysis4_betaTable.csv"</span>,</span>
<span id="cb35-2"><a href="#cb35-2" aria-hidden="true" tabindex="-1"></a>                      <span class="at">delim =</span> <span class="st">" "</span>) <span class="sc">%&gt;%</span> </span>
<span id="cb35-3"><a href="#cb35-3" aria-hidden="true" tabindex="-1"></a>          <span class="co">#split the CI column</span></span>
<span id="cb35-4"><a href="#cb35-4" aria-hidden="true" tabindex="-1"></a>          <span class="fu">mutate</span>(<span class="at">CI95 =</span> <span class="fu">str_extract_all</span>(<span class="st">`</span><span class="at">95% CI</span><span class="st">`</span>,<span class="st">"-*[0-9]</span><span class="sc">\\</span><span class="st">.[0-9]+"</span>)) <span class="sc">%&gt;%</span></span>
<span id="cb35-5"><a href="#cb35-5" aria-hidden="true" tabindex="-1"></a>          <span class="co"># move the resulting list column into two columns</span></span>
<span id="cb35-6"><a href="#cb35-6" aria-hidden="true" tabindex="-1"></a>          <span class="fu">unnest_wider</span>(CI95, <span class="at">names_sep =</span> <span class="st">"_"</span>) <span class="sc">%&gt;%</span> </span>
<span id="cb35-7"><a href="#cb35-7" aria-hidden="true" tabindex="-1"></a>          <span class="co">#change to numeric</span></span>
<span id="cb35-8"><a href="#cb35-8" aria-hidden="true" tabindex="-1"></a>          <span class="fu">mutate</span>(<span class="fu">across</span>(<span class="fu">starts_with</span>(<span class="st">"CI"</span>),as.numeric)) <span class="sc">%&gt;%</span> </span>
<span id="cb35-9"><a href="#cb35-9" aria-hidden="true" tabindex="-1"></a>          <span class="co">#exponentiate to get odds ratio</span></span>
<span id="cb35-10"><a href="#cb35-10" aria-hidden="true" tabindex="-1"></a>          <span class="fu">mutate</span>(<span class="at">OddsMean =</span> <span class="fu">exp</span>(mean), <span class="at">OddsLo95CI =</span> <span class="fu">exp</span>(CI95_1), </span>
<span id="cb35-11"><a href="#cb35-11" aria-hidden="true" tabindex="-1"></a>                 <span class="at">OddsHi95CI =</span> <span class="fu">exp</span>(CI95_2))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stderr">
<pre><code>Rows: 12 Columns: 5
── Column specification ────────────────────────────────────────────────────────
Delimiter: " "
chr (2): model, 95% CI
dbl (3): mean, median, p-value

ℹ Use `spec()` to retrieve the full column specification for this data.
ℹ Specify the column types or set `show_col_types = FALSE` to quiet this message.</code></pre>
</div>
<div class="sourceCode cell-code" id="cb37"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb37-1"><a href="#cb37-1" aria-hidden="true" tabindex="-1"></a><span class="fu">kable</span>(m4Betas[,<span class="fu">c</span>(<span class="dv">1</span>,<span class="dv">2</span>,<span class="dv">5</span>,<span class="dv">8</span><span class="sc">:</span><span class="dv">10</span>)], <span class="at">digits=</span><span class="dv">3</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<table class="table table-sm table-striped">
<colgroup>
<col style="width: 37%">
<col style="width: 9%">
<col style="width: 10%">
<col style="width: 12%">
<col style="width: 14%">
<col style="width: 14%">
</colgroup>
<thead>
<tr class="header">
<th style="text-align: left;">model</th>
<th style="text-align: right;">mean</th>
<th style="text-align: right;">p-value</th>
<th style="text-align: right;">OddsMean</th>
<th style="text-align: right;">OddsLo95CI</th>
<th style="text-align: right;">OddsHi95CI</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td style="text-align: left;">datathonderivedGeneticDataX</td>
<td style="text-align: right;">-0.358</td>
<td style="text-align: right;">0.080</td>
<td style="text-align: right;">0.699</td>
<td style="text-align: right;">0.435</td>
<td style="text-align: right;">1.051</td>
</tr>
<tr class="even">
<td style="text-align: left;">datathonpermitInformation</td>
<td style="text-align: right;">-0.564</td>
<td style="text-align: right;">0.058</td>
<td style="text-align: right;">0.569</td>
<td style="text-align: right;">0.281</td>
<td style="text-align: right;">1.015</td>
</tr>
<tr class="odd">
<td style="text-align: left;">datathonyearCollected</td>
<td style="text-align: right;">-0.204</td>
<td style="text-align: right;">0.026</td>
<td style="text-align: right;">0.815</td>
<td style="text-align: right;">0.680</td>
<td style="text-align: right;">0.969</td>
</tr>
<tr class="even">
<td style="text-align: left;">datathonmaterialSampleID</td>
<td style="text-align: right;">-0.221</td>
<td style="text-align: right;">0.292</td>
<td style="text-align: right;">0.802</td>
<td style="text-align: right;">0.527</td>
<td style="text-align: right;">1.229</td>
</tr>
<tr class="odd">
<td style="text-align: left;">datathonspatiotemp</td>
<td style="text-align: right;">-0.200</td>
<td style="text-align: right;">0.046</td>
<td style="text-align: right;">0.819</td>
<td style="text-align: right;">0.671</td>
<td style="text-align: right;">0.994</td>
</tr>
<tr class="even">
<td style="text-align: left;">datathonpreservative</td>
<td style="text-align: right;">-0.389</td>
<td style="text-align: right;">0.038</td>
<td style="text-align: right;">0.678</td>
<td style="text-align: right;">0.460</td>
<td style="text-align: right;">0.978</td>
</tr>
<tr class="odd">
<td style="text-align: left;">datathoncoordinates</td>
<td style="text-align: right;">-0.234</td>
<td style="text-align: right;">0.094</td>
<td style="text-align: right;">0.791</td>
<td style="text-align: right;">0.598</td>
<td style="text-align: right;">1.034</td>
</tr>
<tr class="even">
<td style="text-align: left;">datathonlocality</td>
<td style="text-align: right;">0.251</td>
<td style="text-align: right;">0.312</td>
<td style="text-align: right;">1.285</td>
<td style="text-align: right;">0.808</td>
<td style="text-align: right;">2.201</td>
</tr>
<tr class="odd">
<td style="text-align: left;">datathonhabitat</td>
<td style="text-align: right;">-0.071</td>
<td style="text-align: right;">0.750</td>
<td style="text-align: right;">0.931</td>
<td style="text-align: right;">0.598</td>
<td style="text-align: right;">1.406</td>
</tr>
<tr class="even">
<td style="text-align: left;">datathoncountry</td>
<td style="text-align: right;">0.140</td>
<td style="text-align: right;">0.622</td>
<td style="text-align: right;">1.150</td>
<td style="text-align: right;">0.636</td>
<td style="text-align: right;">2.012</td>
</tr>
<tr class="odd">
<td style="text-align: left;">datathonenvironmentalMedium</td>
<td style="text-align: right;">-0.571</td>
<td style="text-align: right;">0.076</td>
<td style="text-align: right;">0.565</td>
<td style="text-align: right;">0.264</td>
<td style="text-align: right;">1.034</td>
</tr>
<tr class="even">
<td style="text-align: left;">datathonpublication</td>
<td style="text-align: right;">-6.009</td>
<td style="text-align: right;">0.458</td>
<td style="text-align: right;">0.002</td>
<td style="text-align: right;">5.053</td>
<td style="text-align: right;">237.460</td>
</tr>
</tbody>
</table>
</div>
</div>
</section>
</section>
<section id="how-many-bioprojects-included-publication-information-and-for-how-many-could-we-find-papers" class="level1">
<h1>How Many BioProjects included publication information, and for how many could we find papers?</h1>
<div class="cell">
<div class="sourceCode cell-code" id="cb38"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb38-1"><a href="#cb38-1" aria-hidden="true" tabindex="-1"></a><span class="co">#get path to spreadsheet in GDrive</span></span>
<span id="cb38-2"><a href="#cb38-2" aria-hidden="true" tabindex="-1"></a>nonmarineSRA <span class="ot">&lt;-</span> googledrive<span class="sc">::</span><span class="fu">drive_ls</span>(<span class="at">path =</span> <span class="st">"BioProject_Tables"</span>, <span class="at">pattern =</span></span>
<span id="cb38-3"><a href="#cb38-3" aria-hidden="true" tabindex="-1"></a><span class="st">"nonMarine_SRA_BioProjects"</span>)</span>
<span id="cb38-4"><a href="#cb38-4" aria-hidden="true" tabindex="-1"></a>marineSRA <span class="ot">&lt;-</span> <span class="fu">drive_get</span>(<span class="at">path =</span></span>
<span id="cb38-5"><a href="#cb38-5" aria-hidden="true" tabindex="-1"></a><span class="st">"GEOME_Datathon/Datathon_Working_Directory/BioProject_Tables/Marine_SRA_BioProjects"</span>)</span>
<span id="cb38-6"><a href="#cb38-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb38-7"><a href="#cb38-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb38-8"><a href="#cb38-8" aria-hidden="true" tabindex="-1"></a>df.nonmarine <span class="ot">&lt;-</span> googlesheets4<span class="sc">::</span><span class="fu">range_read</span>(nonmarineSRA, <span class="at">sheet =</span> <span class="dv">1</span>, <span class="at">range =</span> <span class="st">"A:BK"</span>, <span class="at">col_types =</span> <span class="st">"c"</span>, <span class="at">na =</span> <span class="st">"NA"</span>) <span class="sc">%&gt;%</span></span>
<span id="cb38-9"><a href="#cb38-9" aria-hidden="true" tabindex="-1"></a>  <span class="fu">select</span>(project_acc_bioprj, Paper_Available, publication_ID_bioprj) <span class="sc">%&gt;%</span> </span>
<span id="cb38-10"><a href="#cb38-10" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">datagroup =</span> <span class="st">"nonmarine"</span>)</span>
<span id="cb38-11"><a href="#cb38-11" aria-hidden="true" tabindex="-1"></a>df.marine <span class="ot">&lt;-</span> googlesheets4<span class="sc">::</span><span class="fu">range_read</span>(marineSRA, <span class="at">sheet =</span> <span class="dv">1</span>, <span class="at">range =</span> <span class="st">"A:BK"</span>, <span class="at">col_types =</span> <span class="st">"c"</span>, <span class="at">na =</span> <span class="st">"NA"</span>) <span class="sc">%&gt;%</span></span>
<span id="cb38-12"><a href="#cb38-12" aria-hidden="true" tabindex="-1"></a>  <span class="fu">select</span>(project_acc_bioprj, Paper_Available, publication_ID_bioprj) <span class="sc">%&gt;%</span> </span>
<span id="cb38-13"><a href="#cb38-13" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">datagroup =</span> <span class="st">"marine"</span>)</span>
<span id="cb38-14"><a href="#cb38-14" aria-hidden="true" tabindex="-1"></a><span class="co"># read in the 848 post-filter bioprojects addressed in the datathon</span></span>
<span id="cb38-15"><a href="#cb38-15" aria-hidden="true" tabindex="-1"></a>p848 <span class="ot">&lt;-</span> <span class="fu">read_csv</span>(<span class="st">"./datathon1_working_files/848_bioprjs_all_datathon.csv"</span>)</span>
<span id="cb38-16"><a href="#cb38-16" aria-hidden="true" tabindex="-1"></a>df <span class="ot">&lt;-</span> <span class="fu">bind_rows</span>(df.marine,df.nonmarine) <span class="sc">%&gt;%</span> <span class="fu">right_join</span>(p848) <span class="sc">%&gt;%</span> <span class="fu">distinct</span>(project_acc_bioprj, <span class="at">.keep_all =</span> T)</span>
<span id="cb38-17"><a href="#cb38-17" aria-hidden="true" tabindex="-1"></a>df<span class="sc">$</span>Paper_Available <span class="ot">&lt;-</span> <span class="fu">as.logical</span>(df<span class="sc">$</span>Paper_Available)</span>
<span id="cb38-18"><a href="#cb38-18" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb38-19"><a href="#cb38-19" aria-hidden="true" tabindex="-1"></a>bioprojects_with_pub_info <span class="ot">&lt;-</span> <span class="fu">length</span>(<span class="fu">which</span>(<span class="sc">!</span><span class="fu">is.na</span>(df<span class="sc">$</span>publication_ID_bioprj)))</span>
<span id="cb38-20"><a href="#cb38-20" aria-hidden="true" tabindex="-1"></a><span class="fu">length</span>(<span class="sc">!</span><span class="fu">which</span>(df<span class="sc">$</span>Paper_Available))</span>
<span id="cb38-21"><a href="#cb38-21" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb38-22"><a href="#cb38-22" aria-hidden="true" tabindex="-1"></a>bioprojects_with_pub_info<span class="sc">/</span><span class="dv">848</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</section>
<section id="data-loading" class="level1">
<h1>Data Loading</h1>
<p>Now it is time to get the data ready for upload to GEOME. We cannot have spaces or dashes in materialSampleIDs, as they will be part of URIs. So, a quick script to replace spaces with underscores and dashes with <code>.</code> Also, need to remove the genus part of the specificEpithet. Blank localities replaced with “unknown” and blank years replaced with “unknown”. Merge projects that appear in both marine and nonmarine sets. Rename biosample_acc_sra to biosampleAccession. Remove duplicates that have different run numbers.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb39"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb39-1"><a href="#cb39-1" aria-hidden="true" tabindex="-1"></a>nm.path <span class="ot">&lt;-</span> <span class="st">"/Users/eric/Library/CloudStorage/GoogleDrive-eric.d.crandall@gmail.com/My Drive/GEOME_Datathon/Datathon_Working_Directory/BioProject_Tables/NonMarine_BioSample_Metadata/Completed_nonMarine_BioSample_Metadata_Sheets/QCd"</span></span>
<span id="cb39-2"><a href="#cb39-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb39-3"><a href="#cb39-3" aria-hidden="true" tabindex="-1"></a>m.path <span class="ot">&lt;-</span> <span class="st">"/Users/eric/Library/CloudStorage/GoogleDrive-eric.d.crandall@gmail.com/My Drive/GEOME_Datathon/Datathon_Working_Directory/BioProject_Tables/Marine_BioSample_Metadata/Completed_Marine_BioSample_Metadata_Sheets/QCd"</span></span>
<span id="cb39-4"><a href="#cb39-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb39-5"><a href="#cb39-5" aria-hidden="true" tabindex="-1"></a>final_path <span class="ot">&lt;-</span> <span class="st">"/Users/eric/Library/CloudStorage/GoogleDrive-eric.d.crandall@gmail.com/My Drive/GEOME_Datathon/Datathon_Working_Directory/BioProject_Tables/Final_for_GEOME"</span></span>
<span id="cb39-6"><a href="#cb39-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb39-7"><a href="#cb39-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb39-8"><a href="#cb39-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb39-9"><a href="#cb39-9" aria-hidden="true" tabindex="-1"></a>biosampsQC <span class="ot">&lt;-</span> <span class="fu">tibble</span>() </span>
<span id="cb39-10"><a href="#cb39-10" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb39-11"><a href="#cb39-11" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span>(file <span class="cf">in</span> <span class="fu">list.files</span>(nm.path, <span class="at">full.names =</span> T)){</span>
<span id="cb39-12"><a href="#cb39-12" aria-hidden="true" tabindex="-1"></a>  <span class="fu">print</span>(file)</span>
<span id="cb39-13"><a href="#cb39-13" aria-hidden="true" tabindex="-1"></a>  metadata <span class="ot">&lt;-</span> <span class="fu">read_excel</span>(<span class="at">path =</span> file, </span>
<span id="cb39-14"><a href="#cb39-14" aria-hidden="true" tabindex="-1"></a>                           <span class="at">sheet =</span> <span class="st">"Samples"</span>,<span class="at">col_types =</span> <span class="st">"text"</span>)</span>
<span id="cb39-15"><a href="#cb39-15" aria-hidden="true" tabindex="-1"></a>  biosampsQC <span class="ot">&lt;-</span> <span class="fu">bind_rows</span>(biosampsQC, metadata)</span>
<span id="cb39-16"><a href="#cb39-16" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb39-17"><a href="#cb39-17" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb39-18"><a href="#cb39-18" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span>(file <span class="cf">in</span> <span class="fu">list.files</span>(m.path, <span class="at">full.names =</span> T)){</span>
<span id="cb39-19"><a href="#cb39-19" aria-hidden="true" tabindex="-1"></a>  <span class="fu">print</span>(file)</span>
<span id="cb39-20"><a href="#cb39-20" aria-hidden="true" tabindex="-1"></a>  metadata <span class="ot">&lt;-</span> <span class="fu">read_excel</span>(<span class="at">path =</span> file, </span>
<span id="cb39-21"><a href="#cb39-21" aria-hidden="true" tabindex="-1"></a>                           <span class="at">sheet =</span> <span class="st">"Samples"</span>,<span class="at">col_types =</span> <span class="st">"text"</span>)</span>
<span id="cb39-22"><a href="#cb39-22" aria-hidden="true" tabindex="-1"></a>  biosampsQC <span class="ot">&lt;-</span> <span class="fu">bind_rows</span>(biosampsQC, metadata)</span>
<span id="cb39-23"><a href="#cb39-23" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb39-24"><a href="#cb39-24" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb39-25"><a href="#cb39-25" aria-hidden="true" tabindex="-1"></a><span class="co"># remove biosample accessions that were duplicated because of multiple runs, but keep them if they are duplicated </span></span>
<span id="cb39-26"><a href="#cb39-26" aria-hidden="true" tabindex="-1"></a><span class="co"># because of multiple derivedGenetic entries. This removes 3,607 entries</span></span>
<span id="cb39-27"><a href="#cb39-27" aria-hidden="true" tabindex="-1"></a>biosampsQC_noruns <span class="ot">&lt;-</span> biosampsQC  <span class="sc">%&gt;%</span> <span class="fu">distinct</span>(biosample_acc_sra, derivedGeneticDataFilename, <span class="at">.keep_all =</span> T) <span class="sc">%&gt;%</span>   </span>
<span id="cb39-28"><a href="#cb39-28" aria-hidden="true" tabindex="-1"></a>  <span class="fu">drop_na</span>(project_index)</span>
<span id="cb39-29"><a href="#cb39-29" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb39-30"><a href="#cb39-30" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb39-31"><a href="#cb39-31" aria-hidden="true" tabindex="-1"></a>biosampsQC_noruns_reformat <span class="ot">&lt;-</span> biosampsQC_noruns <span class="sc">%&gt;%</span> </span>
<span id="cb39-32"><a href="#cb39-32" aria-hidden="true" tabindex="-1"></a>          <span class="co"># replace " " with "_" in materialSampleID</span></span>
<span id="cb39-33"><a href="#cb39-33" aria-hidden="true" tabindex="-1"></a>          <span class="fu">mutate</span>(<span class="at">materialSampleID =</span> <span class="fu">str_replace_all</span>(materialSampleID,<span class="st">" "</span>,<span class="st">"_"</span>)) <span class="sc">%&gt;%</span> </span>
<span id="cb39-34"><a href="#cb39-34" aria-hidden="true" tabindex="-1"></a>          <span class="co"># replace "-" with "." in materialSampleID</span></span>
<span id="cb39-35"><a href="#cb39-35" aria-hidden="true" tabindex="-1"></a>          <span class="fu">mutate</span>(<span class="at">materialSampleID =</span> <span class="fu">str_replace_all</span>(materialSampleID,<span class="st">"-"</span>,<span class="st">"."</span>)) <span class="sc">%&gt;%</span></span>
<span id="cb39-36"><a href="#cb39-36" aria-hidden="true" tabindex="-1"></a>          <span class="co"># remove genera (starting with a capital letter)</span></span>
<span id="cb39-37"><a href="#cb39-37" aria-hidden="true" tabindex="-1"></a>          <span class="fu">mutate</span>(<span class="at">specificEpithet =</span> <span class="fu">str_remove</span>(specificEpithet,<span class="st">"^[A-Z][a-z]+ "</span>)) <span class="sc">%&gt;%</span></span>
<span id="cb39-38"><a href="#cb39-38" aria-hidden="true" tabindex="-1"></a>          <span class="co"># remove "sp."</span></span>
<span id="cb39-39"><a href="#cb39-39" aria-hidden="true" tabindex="-1"></a>          <span class="fu">mutate</span>(<span class="at">specificEpithet =</span> <span class="fu">str_remove</span>(specificEpithet, <span class="st">"^sp[</span><span class="sc">\\</span><span class="st">.]* +"</span>)) <span class="sc">%&gt;%</span></span>
<span id="cb39-40"><a href="#cb39-40" aria-hidden="true" tabindex="-1"></a>          <span class="co"># remove Genera following x in a hybrid name</span></span>
<span id="cb39-41"><a href="#cb39-41" aria-hidden="true" tabindex="-1"></a>          <span class="fu">mutate</span>(<span class="at">specificEpithet =</span> <span class="fu">str_remove</span>(specificEpithet, <span class="st">" [A-Z][a-z]+"</span>)) <span class="sc">%&gt;%</span> </span>
<span id="cb39-42"><a href="#cb39-42" aria-hidden="true" tabindex="-1"></a>          <span class="co"># replace x with × in hybrid names</span></span>
<span id="cb39-43"><a href="#cb39-43" aria-hidden="true" tabindex="-1"></a>          <span class="fu">mutate</span>(<span class="at">specificEpithet =</span> <span class="fu">str_replace</span>(specificEpithet, <span class="fu">regex</span>(<span class="st">" X "</span>, <span class="at">ignore_case =</span> T), <span class="st">" × "</span>)) <span class="sc">%&gt;%</span> </span>
<span id="cb39-44"><a href="#cb39-44" aria-hidden="true" tabindex="-1"></a>          <span class="co"># replace blank yearCollected with "unknown"</span></span>
<span id="cb39-45"><a href="#cb39-45" aria-hidden="true" tabindex="-1"></a>          <span class="fu">mutate</span>(<span class="at">yearCollected =</span> <span class="fu">str_replace</span>(yearCollected,<span class="st">"^ *$"</span>, <span class="st">"unknown"</span>)) <span class="sc">%&gt;%</span></span>
<span id="cb39-46"><a href="#cb39-46" aria-hidden="true" tabindex="-1"></a>          <span class="co">#  replace NA yearCollected with "unknown"</span></span>
<span id="cb39-47"><a href="#cb39-47" aria-hidden="true" tabindex="-1"></a>          <span class="fu">mutate</span>(<span class="at">yearCollected =</span> <span class="fu">replace_na</span>(yearCollected, <span class="st">"unknown"</span>)) <span class="sc">%&gt;%</span></span>
<span id="cb39-48"><a href="#cb39-48" aria-hidden="true" tabindex="-1"></a>          <span class="co"># replace blank locality with "unknown"</span></span>
<span id="cb39-49"><a href="#cb39-49" aria-hidden="true" tabindex="-1"></a>          <span class="fu">mutate</span>(<span class="at">locality =</span> <span class="fu">str_replace</span>(locality,<span class="st">"^ *$"</span>, <span class="st">"unknown"</span>)) <span class="sc">%&gt;%</span> </span>
<span id="cb39-50"><a href="#cb39-50" aria-hidden="true" tabindex="-1"></a>          <span class="co"># replace NA locality with "unknown"</span></span>
<span id="cb39-51"><a href="#cb39-51" aria-hidden="true" tabindex="-1"></a>          <span class="fu">mutate</span>(<span class="at">locality =</span> <span class="fu">replace_na</span>(locality, <span class="st">"unknown"</span>)) <span class="sc">%&gt;%</span></span>
<span id="cb39-52"><a href="#cb39-52" aria-hidden="true" tabindex="-1"></a>          <span class="co"># rename biosample_acc_sra to biosampleAccession</span></span>
<span id="cb39-53"><a href="#cb39-53" aria-hidden="true" tabindex="-1"></a>          <span class="fu">rename</span>(<span class="at">biosampleAccession =</span> biosample_acc_sra) <span class="sc">%&gt;%</span> </span>
<span id="cb39-54"><a href="#cb39-54" aria-hidden="true" tabindex="-1"></a>          <span class="fu">rename</span>(<span class="at">bioprojectAccession =</span> project_acc_bioprj)</span>
<span id="cb39-55"><a href="#cb39-55" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb39-56"><a href="#cb39-56" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span>(bp <span class="cf">in</span> <span class="fu">unique</span>(biosampsQC_noruns_reformat<span class="sc">$</span>bioprojectAccession)){</span>
<span id="cb39-57"><a href="#cb39-57" aria-hidden="true" tabindex="-1"></a>  bioproject <span class="ot">&lt;-</span> biosampsQC_noruns_reformat <span class="sc">%&gt;%</span> <span class="fu">filter</span>(biosampsQC_noruns_reformat<span class="sc">$</span>bioprojectAccession <span class="sc">==</span> bp)</span>
<span id="cb39-58"><a href="#cb39-58" aria-hidden="true" tabindex="-1"></a>  filename <span class="ot">&lt;-</span> <span class="fu">paste</span>(<span class="fu">first</span>(biosampsQC_noruns_reformat<span class="sc">$</span>project_index[<span class="fu">which</span>(</span>
<span id="cb39-59"><a href="#cb39-59" aria-hidden="true" tabindex="-1"></a>                              biosampsQC_noruns_reformat<span class="sc">$</span>bioprojectAccession<span class="sc">==</span>bp)]), bp, <span class="st">"final.xlsx"</span>, <span class="at">sep =</span> <span class="st">"_"</span>)</span>
<span id="cb39-60"><a href="#cb39-60" aria-hidden="true" tabindex="-1"></a>  <span class="fu">write.xlsx</span>(bioproject, <span class="at">file =</span> <span class="fu">file.path</span>(final_path, filename), <span class="at">sheetName =</span> <span class="st">"Samples"</span>, <span class="at">firstActiveRow =</span> <span class="dv">1</span>)</span>
<span id="cb39-61"><a href="#cb39-61" aria-hidden="true" tabindex="-1"></a>}</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>


</section>

</main> <!-- /main -->
<script id="quarto-html-after-body" type="application/javascript">
window.document.addEventListener("DOMContentLoaded", function (event) {
  const toggleBodyColorMode = (bsSheetEl) => {
    const mode = bsSheetEl.getAttribute("data-mode");
    const bodyEl = window.document.querySelector("body");
    if (mode === "dark") {
      bodyEl.classList.add("quarto-dark");
      bodyEl.classList.remove("quarto-light");
    } else {
      bodyEl.classList.add("quarto-light");
      bodyEl.classList.remove("quarto-dark");
    }
  }
  const toggleBodyColorPrimary = () => {
    const bsSheetEl = window.document.querySelector("link#quarto-bootstrap");
    if (bsSheetEl) {
      toggleBodyColorMode(bsSheetEl);
    }
  }
  toggleBodyColorPrimary();  
  const icon = "";
  const anchorJS = new window.AnchorJS();
  anchorJS.options = {
    placement: 'right',
    icon: icon
  };
  anchorJS.add('.anchored');
  const clipboard = new window.ClipboardJS('.code-copy-button', {
    target: function(trigger) {
      return trigger.previousElementSibling;
    }
  });
  clipboard.on('success', function(e) {
    // button target
    const button = e.trigger;
    // don't keep focus
    button.blur();
    // flash "checked"
    button.classList.add('code-copy-button-checked');
    var currentTitle = button.getAttribute("title");
    button.setAttribute("title", "Copied!");
    setTimeout(function() {
      button.setAttribute("title", currentTitle);
      button.classList.remove('code-copy-button-checked');
    }, 1000);
    // clear code selection
    e.clearSelection();
  });
  function tippyHover(el, contentFn) {
    const config = {
      allowHTML: true,
      content: contentFn,
      maxWidth: 500,
      delay: 100,
      arrow: false,
      appendTo: function(el) {
          return el.parentElement;
      },
      interactive: true,
      interactiveBorder: 10,
      theme: 'quarto',
      placement: 'bottom-start'
    };
    window.tippy(el, config); 
  }
  const noterefs = window.document.querySelectorAll('a[role="doc-noteref"]');
  for (var i=0; i<noterefs.length; i++) {
    const ref = noterefs[i];
    tippyHover(ref, function() {
      // use id or data attribute instead here
      let href = ref.getAttribute('data-footnote-href') || ref.getAttribute('href');
      try { href = new URL(href).hash; } catch {}
      const id = href.replace(/^#\/?/, "");
      const note = window.document.getElementById(id);
      return note.innerHTML;
    });
  }
  var bibliorefs = window.document.querySelectorAll('a[role="doc-biblioref"]');
  for (var i=0; i<bibliorefs.length; i++) {
    const ref = bibliorefs[i];
    const cites = ref.parentNode.getAttribute('data-cites').split(' ');
    tippyHover(ref, function() {
      var popup = window.document.createElement('div');
      cites.forEach(function(cite) {
        var citeDiv = window.document.createElement('div');
        citeDiv.classList.add('hanging-indent');
        citeDiv.classList.add('csl-entry');
        var biblioDiv = window.document.getElementById('ref-' + cite);
        if (biblioDiv) {
          citeDiv.innerHTML = biblioDiv.innerHTML;
        }
        popup.appendChild(citeDiv);
      });
      return popup.innerHTML;
    });
  }
});
</script>
</div> <!-- /content -->



</body></html>